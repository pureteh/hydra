<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | A /Model/ of the Hydra head Protocol.</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- This model integrates in a single state-machine like abstraction the whole behaviour of</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- a Hydra Head, taking into account both on-chain state and contracts, and off-chain</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- interactions. It is written from the point of view of a pre-defined set of Hydra node</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- /operators/ that want to create a channel between them.</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- It's a &quot;happy path&quot; model that does not implement any kind of adversarial behaviour and</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- whose transactions are very simple: Each tx is a payment of one Ada-only UTxO transferred</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- to another party in full, without any change.</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- More intricate and specialised models shall be developed once we get a firmer grasp of</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- the whole framework, injecting faults, taking into account more parts of the stack,</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- modelling more complex transactions schemes...</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Model</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Any</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-keyword">label</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pairs</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Class.MonadSTM</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadLabelledSTM</span></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-identifier">labelTQueueIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">labelTVarIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-identifier">modifyTVar</span></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-identifier">newTQueue</span></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-identifier">newTVarIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-identifier">readTVarIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadAsync</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Async</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">async</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cancel</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">link</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadFork</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">labelThisThread</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadTimer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">timeout</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">nub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Natural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">wordToNatural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.API.ClientInput</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ClientInput</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.API.ClientInput</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Input</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.API.ServerOutput</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ServerOutput</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.BehaviorSpec.html"><span class="hs-identifier">Hydra.BehaviorSpec</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier">SimulatedChainNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier">TestHydraClient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#createHydraNode"><span class="hs-identifier">createHydraNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#createTestHydraClient"><span class="hs-identifier">createTestHydraClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier">shortLabel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#waitMatch"><span class="hs-identifier">waitMatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier">waitUntilMatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api.Prelude</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromShelleyPaymentCredential</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeadParameters</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">initialChainState</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.Fixture</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">defaultGlobals</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultLedgerEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">testNetworkId</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UnsafeContestationPeriod</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Crypto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HydraKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.HeadLogic</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><span class="hs-identifier">Committed</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="hs-identifier">IdleState</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="hs-identifier">PendingCommits</span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.HeadLogic</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HeadState</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsTx</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger.Cardano</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">cardanoLedger</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genSigningKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkSimpleTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Logging</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tracer</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Logging.Messages</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HydraLog</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DirectChain</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Node</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Model.MockChain.html"><span class="hs-identifier">Hydra.Model.MockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.MockChain.html#mkMockTxIn"><span class="hs-identifier">mkMockTxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.MockChain.html#mockChainAndNetwork"><span class="hs-identifier">mockChainAndNetwork</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html"><span class="hs-identifier">Hydra.Model.Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier">CardanoSigningKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier">Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#applyTx"><span class="hs-identifier">applyTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#genAdaValue"><span class="hs-identifier">genAdaValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">createNodeState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runHydraNode</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Options</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">maximumNumberOfParties</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Party</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">deriveParty</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Snapshot</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Snapshot</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Consensus.Cardano.Generators</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">choose</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">counterexample</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elements</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">frequency</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">resize</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sized</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tabulate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">vectorOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.DynamicLogic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DynLogicModel</span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.StateModel</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HasVariables</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Realized</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RunModel</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateModel</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">VarContext</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.StateModel.Variables</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasVariables</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- * The Model</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-comment">-- | State maintained by the model.</span><span>
</span><span id="line-88"></span><span class="hs-keyword">data</span><span> </span><span id="WorldState"><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-var">WorldState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorldState"><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-var">WorldState</span></a></span></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AhydraParties%3AWorldState"><span class="annot"><span class="annottext">WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- ^ List of parties identified by both signing keys required to run protocol.</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-comment">-- This list must not contain any duplicated key.</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AhydraState%3AWorldState"><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- ^ Expected consensus state</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">-- All nodes should be in the same state.</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412507"><span id="local-6989586621679412509"><span class="annot"><span class="annottext">WorldState -&gt; WorldState -&gt; Bool
(WorldState -&gt; WorldState -&gt; Bool)
-&gt; (WorldState -&gt; WorldState -&gt; Bool) -&gt; Eq WorldState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: WorldState -&gt; WorldState -&gt; Bool
$c/= :: WorldState -&gt; WorldState -&gt; Bool
== :: WorldState -&gt; WorldState -&gt; Bool
$c== :: WorldState -&gt; WorldState -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412500"><span id="local-6989586621679412502"><span id="local-6989586621679412504"><span class="annot"><span class="annottext">Int -&gt; WorldState -&gt; ShowS
[WorldState] -&gt; ShowS
WorldState -&gt; String
(Int -&gt; WorldState -&gt; ShowS)
-&gt; (WorldState -&gt; String)
-&gt; ([WorldState] -&gt; ShowS)
-&gt; Show WorldState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [WorldState] -&gt; ShowS
$cshowList :: [WorldState] -&gt; ShowS
show :: WorldState -&gt; String
$cshow :: WorldState -&gt; String
showsPrec :: Int -&gt; WorldState -&gt; ShowS
$cshowsPrec :: Int -&gt; WorldState -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Global state of the Head protocol.</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- While each participant in the Hydra Head protocol has its own private</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- view of the state, we model the expected global state whose properties</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- stem from the consensus built into the Head protocol. In other words, this</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- state is what each node's local state should be /eventually/.</span><span>
</span><span id="line-103"></span><span class="hs-keyword">data</span><span> </span><span id="GlobalState"><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-var">GlobalState</span></a></span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- |Start of the &quot;world&quot;.</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- This state is left implicit in the node's logic as it</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- represents that state where the node does not even</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- exist.</span><span>
</span><span id="line-108"></span><span>    </span><span id="Start"><span class="annot"><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Idle"><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-var">Idle</span></a></span></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AidleParties%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; [Party]
</span><a href="Hydra.Model.html#%24sel%3AidleParties%3AStart"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcardanoKeys%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; [VerificationKey PaymentKey]
</span><a href="Hydra.Model.html#%24sel%3AcardanoKeys%3AStart"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AidleContestationPeriod%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AidleContestationPeriod%3AStart"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Initial"><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-var">Initial</span></a></span></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AheadParameters%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acommits%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; Committed Payment
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Committed</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3ApendingCommits%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; PendingCommits
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PendingCommits</span></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Open"><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-var">Open</span></a></span></span><span>
</span><span id="line-120"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AheadParameters%3AStart"><span class="annot"><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var">headParameters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AoffChainState%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var hs-var">offChainState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Final"><span class="annot"><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-var">Final</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AfinalUTxO%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AfinalUTxO%3AStart"><span class="hs-identifier hs-var hs-var">finalUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412482"><span id="local-6989586621679412484"><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState -&gt; Bool
(GlobalState -&gt; GlobalState -&gt; Bool)
-&gt; (GlobalState -&gt; GlobalState -&gt; Bool) -&gt; Eq GlobalState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: GlobalState -&gt; GlobalState -&gt; Bool
$c/= :: GlobalState -&gt; GlobalState -&gt; Bool
== :: GlobalState -&gt; GlobalState -&gt; Bool
$c== :: GlobalState -&gt; GlobalState -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412476"><span id="local-6989586621679412478"><span id="local-6989586621679412480"><span class="annot"><span class="annottext">Int -&gt; GlobalState -&gt; ShowS
[GlobalState] -&gt; ShowS
GlobalState -&gt; String
(Int -&gt; GlobalState -&gt; ShowS)
-&gt; (GlobalState -&gt; String)
-&gt; ([GlobalState] -&gt; ShowS)
-&gt; Show GlobalState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [GlobalState] -&gt; ShowS
$cshowList :: [GlobalState] -&gt; ShowS
show :: GlobalState -&gt; String
$cshow :: GlobalState -&gt; String
showsPrec :: Int -&gt; GlobalState -&gt; ShowS
$cshowsPrec :: Int -&gt; GlobalState -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Hydra.Model.html#isInitialState"><span class="hs-identifier hs-type">isInitialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-127"></span><span id="isInitialState"><span class="annot"><span class="annottext">isInitialState :: GlobalState -&gt; Bool
</span><a href="Hydra.Model.html#isInitialState"><span class="hs-identifier hs-var hs-var">isInitialState</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Hydra.Model.html#isInitialState"><span class="hs-identifier hs-var">isInitialState</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="annot"><a href="Hydra.Model.html#isOpenState"><span class="hs-identifier hs-type">isOpenState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-131"></span><span id="isOpenState"><span class="annot"><span class="annottext">isOpenState :: GlobalState -&gt; Bool
</span><a href="Hydra.Model.html#isOpenState"><span class="hs-identifier hs-var hs-var">isOpenState</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-132"></span><span class="annot"><a href="Hydra.Model.html#isOpenState"><span class="hs-identifier hs-var">isOpenState</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="annot"><a href="Hydra.Model.html#isFinalState"><span class="hs-identifier hs-type">isFinalState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-135"></span><span id="isFinalState"><span class="annot"><span class="annottext">isFinalState :: GlobalState -&gt; Bool
</span><a href="Hydra.Model.html#isFinalState"><span class="hs-identifier hs-var hs-var">isFinalState</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-type">Final</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-136"></span><span class="annot"><a href="Hydra.Model.html#isFinalState"><span class="hs-identifier hs-var">isFinalState</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Hydra.Model.html#isIdleState"><span class="hs-identifier hs-type">isIdleState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-139"></span><span id="isIdleState"><span class="annot"><span class="annottext">isIdleState :: GlobalState -&gt; Bool
</span><a href="Hydra.Model.html#isIdleState"><span class="hs-identifier hs-var hs-var">isIdleState</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-140"></span><span class="annot"><a href="Hydra.Model.html#isIdleState"><span class="hs-identifier hs-var">isIdleState</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><a href="Hydra.Model.html#isPendingCommitFrom"><span class="hs-identifier hs-type">isPendingCommitFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-143"></span><span id="isPendingCommitFrom"><span class="annot"><span class="annottext">isPendingCommitFrom :: Party -&gt; GlobalState -&gt; Bool
</span><a href="Hydra.Model.html#isPendingCommitFrom"><span class="hs-identifier hs-var hs-var">isPendingCommitFrom</span></a></span></span><span> </span><span id="local-6989586621679412470"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412470"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412469"><span class="annot"><span class="annottext">PendingCommits
pendingCommits :: PendingCommits
$sel:pendingCommits:Start :: GlobalState -&gt; PendingCommits
</span><a href="#local-6989586621679412469"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412470"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; PendingCommits -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">PendingCommits
</span><a href="#local-6989586621679412469"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span>
</span><span id="line-145"></span><span class="annot"><a href="Hydra.Model.html#isPendingCommitFrom"><span class="hs-identifier hs-var">isPendingCommitFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-keyword">data</span><span> </span><span id="OffChainState"><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-var">OffChainState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OffChainState"><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-var">OffChainState</span></a></span></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AconfirmedUTxO%3AOffChainState"><span class="annot"><span class="annottext">OffChainState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AseenTransactions%3AOffChainState"><span class="annot"><span class="annottext">OffChainState -&gt; [Payment]
</span><a href="Hydra.Model.html#%24sel%3AseenTransactions%3AOffChainState"><span class="hs-identifier hs-var hs-var">seenTransactions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412461"><span id="local-6989586621679412463"><span class="annot"><span class="annottext">OffChainState -&gt; OffChainState -&gt; Bool
(OffChainState -&gt; OffChainState -&gt; Bool)
-&gt; (OffChainState -&gt; OffChainState -&gt; Bool) -&gt; Eq OffChainState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: OffChainState -&gt; OffChainState -&gt; Bool
$c/= :: OffChainState -&gt; OffChainState -&gt; Bool
== :: OffChainState -&gt; OffChainState -&gt; Bool
$c== :: OffChainState -&gt; OffChainState -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412455"><span id="local-6989586621679412457"><span id="local-6989586621679412459"><span class="annot"><span class="annottext">Int -&gt; OffChainState -&gt; ShowS
[OffChainState] -&gt; ShowS
OffChainState -&gt; String
(Int -&gt; OffChainState -&gt; ShowS)
-&gt; (OffChainState -&gt; String)
-&gt; ([OffChainState] -&gt; ShowS)
-&gt; Show OffChainState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [OffChainState] -&gt; ShowS
$cshowList :: [OffChainState] -&gt; ShowS
show :: OffChainState -&gt; String
$cshow :: OffChainState -&gt; String
showsPrec :: Int -&gt; OffChainState -&gt; ShowS
$cshowsPrec :: Int -&gt; OffChainState -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-comment">-- This is needed to be able to use `WorldState` inside DL formulae</span><span>
</span><span id="line-154"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679412452"><span class="annot"><span class="hs-identifier hs-type">DynLogicModel</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">type</span><span> </span><span id="ActualCommitted"><span class="annot"><a href="Hydra.Model.html#ActualCommitted"><span class="hs-identifier hs-var">ActualCommitted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">-- | Basic instantiation of `StateModel` for our `WorldState` state.</span><span>
</span><span id="line-159"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679412441"><span id="local-6989586621679412444"><span class="annot"><span class="hs-identifier hs-type">StateModel</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-comment">-- The list of possible &quot;Actions&quot; within our `Model`</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-comment">-- Not all of them need to actually represent an actual user `Action`, but they</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-comment">-- can represent _observations_ which are useful when defining properties in</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-comment">-- DL. Those observations would usually not be generated.</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-keyword">data</span><span> </span><span id="Action"><span class="annot"><span class="hs-identifier hs-var">Action</span></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span id="local-6989586621679412436"><span class="annot"><a href="#local-6989586621679412436"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>    </span><span id="Seed"><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-var">Seed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">{</span><span id="%24sel%3AseedKeys%3ASeed"><span class="annot"><span class="annottext">Action WorldState () -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AseedKeys%3ASeed"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="%24sel%3AseedContestationPeriod%3ASeed"><span class="annot"><span class="annottext">Action WorldState () -&gt; ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AseedContestationPeriod%3ASeed"><span class="hs-identifier hs-var hs-var">seedContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- NOTE: No records possible here as we would duplicate 'Party' fields with</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- different return values.</span><span>
</span><span id="line-168"></span><span>    </span><span id="Init"><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-var">Init</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>    </span><span id="Commit"><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#ActualCommitted"><span class="hs-identifier hs-type">ActualCommitted</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span id="Abort"><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>    </span><span id="NewTx"><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-var">NewTx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>    </span><span id="Wait"><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-var">Wait</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>    </span><span id="ObserveConfirmedTx"><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-var">ObserveConfirmedTx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- Check that all parties have observed the head as open</span><span>
</span><span id="line-175"></span><span>    </span><span id="ObserveHeadIsOpen"><span class="annot"><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>    </span><span id="StopTheWorld"><span class="annot"><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621679412424"><span class="annot"><span class="annottext">initialState :: WorldState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">initialState</span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; GlobalState -&gt; WorldState
</span><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var">hydraParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">arbitraryAction</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VarContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621679412421"><span class="annot"><span class="annottext">arbitraryAction :: VarContext -&gt; WorldState -&gt; Gen (Any (Action WorldState))
</span><a href="#local-6989586621679412421"><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitraryAction</span></a></span></span><span> </span><span class="annot"><span class="annottext">VarContext
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679412420"><span class="annot"><span class="annottext">st :: WorldState
</span><a href="#local-6989586621679412420"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412419"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412419"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412418"><span class="annot"><span class="annottext">GlobalState
hydraState :: GlobalState
$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="#local-6989586621679412418"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412418"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><span class="annottext">GlobalState
</span><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-var">genSeed</span></a></span><span>
</span><span id="line-188"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState)))
-&gt; Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (Action WorldState ())
forall b. [(SigningKey HydraKey, b)] -&gt; Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genInit"><span class="hs-identifier hs-var">genInit</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412419"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412414"><span class="annot"><span class="annottext">PendingCommits
pendingCommits :: PendingCommits
$sel:pendingCommits:Start :: GlobalState -&gt; PendingCommits
</span><a href="#local-6989586621679412414"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><span class="annottext">[(Int, Gen (Any (Action WorldState)))]
-&gt; Gen (Any (Action WorldState))
forall a. [(Int, Gen a)] -&gt; Gen a
</span><span class="hs-identifier hs-var">frequency</span></span><span>
</span><span id="line-191"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PendingCommits -&gt; Gen (Any (Action WorldState))
</span><a href="#local-6989586621679412413"><span class="hs-identifier hs-var">genCommit</span></a></span><span> </span><span class="annot"><span class="annottext">PendingCommits
</span><a href="#local-6989586621679412414"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679412412"><span class="hs-identifier hs-var">genAbort</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679412411"><span class="hs-identifier hs-var">genNewTx</span></a></span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-var">genSeed</span></a></span><span>
</span><span id="line-197"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679412413"><span class="annot"><span class="annottext">genCommit :: PendingCommits -&gt; Gen (Any (Action WorldState))
</span><a href="#local-6989586621679412413"><span class="hs-identifier hs-var hs-var">genCommit</span></a></span></span><span> </span><span id="local-6989586621679412410"><span class="annot"><span class="annottext">PendingCommits
</span><a href="#local-6989586621679412410"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>      </span><span id="local-6989586621679412409"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412409"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Party] -&gt; Gen Party
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">([Party] -&gt; Gen Party) -&gt; [Party] -&gt; Gen Party
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PendingCommits -&gt; [Party]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">PendingCommits
</span><a href="#local-6989586621679412410"><span class="hs-identifier hs-var">pending</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412407"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412407"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (SigningKey HydraKey, CardanoSigningKey)
 -&gt; (SigningKey HydraKey, CardanoSigningKey))
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Bool)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party -&gt; Party -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412409"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Bool)
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412419"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span id="local-6989586621679412404"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412404"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen Value
</span><a href="Hydra.Model.Payment.html#genAdaValue"><span class="hs-identifier hs-var">genAdaValue</span></a></span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412403"><span class="annot"><span class="annottext">utxo :: [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412403"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412407"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412404"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span>      </span><span class="annot"><span class="annottext">Any (Action WorldState) -&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action WorldState) -&gt; Gen (Any (Action WorldState)))
-&gt; (Action WorldState [(CardanoSigningKey, Value)]
    -&gt; Any (Action WorldState))
-&gt; Action WorldState [(CardanoSigningKey, Value)]
-&gt; Gen (Any (Action WorldState))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState [(CardanoSigningKey, Value)]
-&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState [(CardanoSigningKey, Value)]
 -&gt; Gen (Any (Action WorldState)))
-&gt; Action WorldState [(CardanoSigningKey, Value)]
-&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; UTxOType Payment -&gt; Action WorldState (UTxOType Payment)
</span><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412409"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679412403"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621679412412"><span class="annot"><span class="annottext">genAbort :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679412412"><span class="hs-identifier hs-var hs-var">genAbort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679412402"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412402"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412419"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412401"><span class="annot"><span class="annottext">party :: Party
</span><a href="#local-6989586621679412401"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412402"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">Any (Action WorldState) -&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action WorldState) -&gt; Gen (Any (Action WorldState)))
-&gt; (Action WorldState () -&gt; Any (Action WorldState))
-&gt; Action WorldState ()
-&gt; Gen (Any (Action WorldState))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Gen (Any (Action WorldState)))
-&gt; Action WorldState () -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412401"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679412411"><span class="annot"><span class="annottext">genNewTx :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679412411"><span class="hs-identifier hs-var hs-var">genNewTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; Gen (Party, Payment)
</span><a href="Hydra.Model.html#genPayment"><span class="hs-identifier hs-var">genPayment</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412420"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (Party, Payment)
-&gt; ((Party, Payment) -&gt; Gen (Any (Action WorldState)))
-&gt; Gen (Any (Action WorldState))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679412399"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412399"><span class="hs-identifier hs-var">party</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412398"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412398"><span class="hs-identifier hs-var">transaction</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Any (Action WorldState) -&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action WorldState) -&gt; Gen (Any (Action WorldState)))
-&gt; (Action WorldState () -&gt; Any (Action WorldState))
-&gt; Action WorldState ()
-&gt; Gen (Any (Action WorldState))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Gen (Any (Action WorldState)))
-&gt; Action WorldState () -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Payment -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-var">NewTx</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412399"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412398"><span class="hs-identifier hs-var">transaction</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621679412397"><span class="annot"><span class="annottext">precondition :: WorldState -&gt; Action WorldState a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">precondition</span></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679412395"><span class="annot"><span class="annottext">hydraState :: GlobalState
</span><a href="#local-6989586621679412395"><span class="hs-identifier hs-var">hydraState</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679412394"><span class="annot"><a href="#local-6989586621679412394"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="annottext">Party -&gt; GlobalState -&gt; Bool
</span><a href="Hydra.Model.html#isPendingCommitFrom"><span class="hs-identifier hs-var">isPendingCommitFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412394"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412395"><span class="hs-identifier hs-var">hydraState</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412393"><span class="annot"><span class="annottext">OffChainState
offChainState :: OffChainState
$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="#local-6989586621679412393"><span class="hs-identifier hs-var hs-var">offChainState</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679412392"><span class="annot"><a href="#local-6989586621679412392"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#from"><span class="hs-identifier hs-var hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412392"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#value"><span class="hs-identifier hs-var hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412392"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey, Value) -&gt; [(CardanoSigningKey, Value)] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`List.elem`</span></a></span><span> </span><span class="annot"><span class="annottext">OffChainState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">OffChainState
</span><a href="#local-6989586621679412393"><span class="hs-identifier hs-var">offChainState</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621679412388"><span class="annot"><span class="annottext">nextState :: WorldState -&gt; Action WorldState a -&gt; Var a -&gt; WorldState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">nextState</span></span></span><span> </span><span id="local-6989586621679412386"><span class="annot"><span class="annottext">s :: WorldState
</span><a href="#local-6989586621679412386"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412385"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412385"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412384"><span class="annot"><span class="annottext">GlobalState
hydraState :: GlobalState
$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="#local-6989586621679412384"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679412383"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412383"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Var a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412383"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412382"><span class="annot"><a href="#local-6989586621679412382"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412381"><span class="annot"><a href="#local-6989586621679412381"><span class="hs-identifier hs-var hs-var">seedContestationPeriod</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; GlobalState -&gt; WorldState
</span><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var">hydraParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412382"><span class="hs-identifier hs-var">seedKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Idle :: [Party]
-&gt; [VerificationKey PaymentKey]
-&gt; ContestationPeriod
-&gt; GlobalState
</span><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[Party]
idleParties :: [Party]
$sel:idleParties:Start :: [Party]
</span><a href="#local-6989586621679412380"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
cardanoKeys :: [VerificationKey PaymentKey]
$sel:cardanoKeys:Start :: [VerificationKey PaymentKey]
</span><a href="#local-6989586621679412379"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
idleContestationPeriod :: ContestationPeriod
$sel:idleContestationPeriod:Start :: ContestationPeriod
</span><a href="#local-6989586621679412378"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-236"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>        </span><span id="local-6989586621679412380"><span class="annot"><span class="annottext">idleParties :: [Party]
</span><a href="#local-6989586621679412380"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)] -&gt; [Party]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412382"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-238"></span><span>        </span><span id="local-6989586621679412379"><span class="annot"><span class="annottext">cardanoKeys :: [VerificationKey PaymentKey]
</span><a href="#local-6989586621679412379"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey)
 -&gt; VerificationKey PaymentKey)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; [VerificationKey PaymentKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
Key keyrole =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; VerificationKey PaymentKey)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey PaymentKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; VerificationKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#signingKey"><span class="hs-identifier hs-var hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; SigningKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412382"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span id="local-6989586621679412378"><span class="annot"><span class="annottext">idleContestationPeriod :: ContestationPeriod
</span><a href="#local-6989586621679412378"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679412381"><span class="hs-identifier hs-var">seedContestationPeriod</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-242"></span><span>        </span><span class="annot"><span class="annottext">WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; GlobalState -&gt; WorldState
</span><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412385"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412375"><span class="hs-identifier hs-var">mkInitialState</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412384"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-244"></span><span>        </span><span id="local-6989586621679412375"><span class="annot"><span class="annottext">mkInitialState :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412375"><span class="hs-identifier hs-var hs-var">mkInitialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412374"><span class="annot"><span class="annottext">[Party]
idleParties :: [Party]
$sel:idleParties:Start :: GlobalState -&gt; [Party]
</span><a href="#local-6989586621679412374"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412373"><span class="annot"><span class="annottext">ContestationPeriod
idleContestationPeriod :: ContestationPeriod
$sel:idleContestationPeriod:Start :: GlobalState -&gt; ContestationPeriod
</span><a href="#local-6989586621679412373"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-246"></span><span>            </span><span class="annot"><span class="annottext">Initial :: HeadParameters
-&gt; Committed Payment -&gt; PendingCommits -&gt; GlobalState
</span><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span>
</span><span id="line-247"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:headParameters:Start :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var">headParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>                  </span><span class="annot"><span class="annottext">HeadParameters :: ContestationPeriod -&gt; [Party] -&gt; HeadParameters
</span><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-249"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:parties:HeadParameters :: [Party]
</span><a href="#local-6989586621679412371"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679412374"><span class="hs-identifier hs-var">idleParties</span></a></span><span>
</span><span id="line-250"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:HeadParameters :: ContestationPeriod
</span><a href="#local-6989586621679412370"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679412373"><span class="hs-identifier hs-var">idleContestationPeriod</span></a></span><span>
</span><span id="line-251"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-252"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:commits:Start :: Committed Payment
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var">commits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Committed Payment
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-253"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:pendingCommits:Start :: PendingCommits
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party] -&gt; PendingCommits
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679412374"><span class="hs-identifier hs-var">idleParties</span></a></span><span>
</span><span id="line-254"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-255"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679412367"><span class="annot"><a href="#local-6989586621679412367"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679412366"><span class="annot"><a href="#local-6989586621679412366"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; GlobalState -&gt; WorldState
</span><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412385"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412365"><span class="hs-identifier hs-var">updateWithCommit</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412384"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-259"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621679412365"><span class="annot"><span class="annottext">updateWithCommit :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412365"><span class="hs-identifier hs-var hs-var">updateWithCommit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-261"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412364"><span class="annot"><span class="annottext">HeadParameters
headParameters :: HeadParameters
$sel:headParameters:Start :: GlobalState -&gt; HeadParameters
</span><a href="#local-6989586621679412364"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412363"><span class="annot"><span class="annottext">Committed Payment
commits :: Committed Payment
$sel:commits:Start :: GlobalState -&gt; Committed Payment
</span><a href="#local-6989586621679412363"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412362"><span class="annot"><span class="annottext">PendingCommits
pendingCommits :: PendingCommits
$sel:pendingCommits:Start :: GlobalState -&gt; PendingCommits
</span><a href="#local-6989586621679412362"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412361"><span class="hs-identifier hs-var">updatedState</span></a></span><span>
</span><span id="line-262"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>            </span><span id="local-6989586621679412360"><span class="annot"><span class="annottext">commits' :: Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412360"><span class="hs-identifier hs-var hs-var">commits'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; Map Party [(CardanoSigningKey, Value)]
-&gt; Map Party [(CardanoSigningKey, Value)]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412367"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679412366"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Committed Payment
</span><a href="#local-6989586621679412363"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-264"></span><span>            </span><span id="local-6989586621679412358"><span class="annot"><span class="annottext">pendingCommits' :: PendingCommits
</span><a href="#local-6989586621679412358"><span class="hs-identifier hs-var hs-var">pendingCommits'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412367"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; PendingCommits -&gt; PendingCommits
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.delete`</span></span><span> </span><span class="annot"><span class="annottext">PendingCommits
</span><a href="#local-6989586621679412362"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span>
</span><span id="line-265"></span><span>            </span><span id="local-6989586621679412361"><span class="annot"><span class="annottext">updatedState :: GlobalState
</span><a href="#local-6989586621679412361"><span class="hs-identifier hs-var hs-var">updatedState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PendingCommits -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">PendingCommits
</span><a href="#local-6989586621679412358"><span class="hs-identifier hs-var">pendingCommits'</span></a></span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-268"></span><span>                  </span><span class="annot"><span class="annottext">Open :: HeadParameters -&gt; OffChainState -&gt; GlobalState
</span><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span>
</span><span id="line-269"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadParameters
headParameters :: HeadParameters
$sel:headParameters:Start :: HeadParameters
</span><a href="#local-6989586621679412364"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span>
</span><span id="line-270"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>                        </span><span class="annot"><span class="annottext">OffChainState :: UTxOType Payment -&gt; [Payment] -&gt; OffChainState
</span><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span>
</span><span id="line-272"></span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:confirmedUTxO:OffChainState :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)]
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; [[(CardanoSigningKey, Value)]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412360"><span class="hs-identifier hs-var">commits'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:seenTransactions:OffChainState :: [Payment]
</span><a href="Hydra.Model.html#%24sel%3AseenTransactions%3AOffChainState"><span class="hs-identifier hs-var">seenTransactions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-276"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-277"></span><span>                  </span><span class="annot"><span class="annottext">Initial :: HeadParameters
-&gt; Committed Payment -&gt; PendingCommits -&gt; GlobalState
</span><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span>
</span><span id="line-278"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadParameters
headParameters :: HeadParameters
$sel:headParameters:Start :: HeadParameters
</span><a href="#local-6989586621679412364"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span>
</span><span id="line-279"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:commits:Start :: Committed Payment
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var">commits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Committed Payment
</span><a href="#local-6989586621679412360"><span class="hs-identifier hs-var">commits'</span></a></span><span>
</span><span id="line-280"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:pendingCommits:Start :: PendingCommits
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PendingCommits
</span><a href="#local-6989586621679412358"><span class="hs-identifier hs-var">pendingCommits'</span></a></span><span>
</span><span id="line-281"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="annottext">WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; GlobalState -&gt; WorldState
</span><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412385"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412354"><span class="hs-identifier hs-var">updateWithAbort</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412384"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-287"></span><span>        </span><span id="local-6989586621679412354"><span class="annot"><span class="annottext">updateWithAbort :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412354"><span class="hs-identifier hs-var hs-var">updateWithAbort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412353"><span class="annot"><span class="annottext">Committed Payment
commits :: Committed Payment
$sel:commits:Start :: GlobalState -&gt; Committed Payment
</span><a href="#local-6989586621679412353"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; GlobalState
</span><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-var">Final</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679412352"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-289"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>            </span><span id="local-6989586621679412352"><span class="annot"><span class="annottext">committedUTxO :: [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412352"><span class="hs-identifier hs-var hs-var">committedUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)]
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)])
-&gt; [[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; [[(CardanoSigningKey, Value)]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Committed Payment
</span><a href="#local-6989586621679412353"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-291"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; GlobalState
</span><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-var">Final</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-293"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679412351"><span class="annot"><a href="#local-6989586621679412351"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; GlobalState -&gt; WorldState
</span><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412385"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412350"><span class="hs-identifier hs-var">updateWithNewTx</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412384"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>        </span><span id="local-6989586621679412350"><span class="annot"><span class="annottext">updateWithNewTx :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679412350"><span class="hs-identifier hs-var hs-var">updateWithNewTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-297"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412349"><span class="annot"><span class="annottext">HeadParameters
headParameters :: HeadParameters
$sel:headParameters:Start :: GlobalState -&gt; HeadParameters
</span><a href="#local-6989586621679412349"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412348"><span class="annot"><span class="annottext">UTxOType Payment
confirmedUTxO :: UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
</span><a href="#local-6989586621679412348"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412347"><span class="annot"><span class="annottext">[Payment]
seenTransactions :: [Payment]
$sel:seenTransactions:OffChainState :: OffChainState -&gt; [Payment]
</span><a href="#local-6989586621679412347"><span class="hs-identifier hs-var hs-var">seenTransactions</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-298"></span><span>            </span><span class="annot"><span class="annottext">Open :: HeadParameters -&gt; OffChainState -&gt; GlobalState
</span><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span>
</span><span id="line-299"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadParameters
headParameters :: HeadParameters
$sel:headParameters:Start :: HeadParameters
</span><a href="#local-6989586621679412349"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span>
</span><span id="line-300"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>                  </span><span class="annot"><span class="annottext">OffChainState :: UTxOType Payment -&gt; [Payment] -&gt; OffChainState
</span><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span>
</span><span id="line-302"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:confirmedUTxO:OffChainState :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679412348"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; Payment -&gt; UTxOType Payment
</span><a href="Hydra.Model.Payment.html#applyTx"><span class="hs-operator hs-var">`applyTx`</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412351"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-303"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:seenTransactions:OffChainState :: [Payment]
</span><a href="Hydra.Model.html#%24sel%3AseenTransactions%3AOffChainState"><span class="hs-identifier hs-var">seenTransactions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412351"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; [Payment] -&gt; [Payment]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Payment]
</span><a href="#local-6989586621679412347"><span class="hs-identifier hs-var">seenTransactions</span></a></span><span>
</span><span id="line-304"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-305"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-307"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412386"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-308"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412386"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-309"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412386"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412386"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasVariables</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-313"></span><span>  </span><span id="local-6989586621679412344"><span class="annot"><span class="annottext">getAllVariables :: WorldState -&gt; Set (Any Var)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getAllVariables</span></span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (Any Var)
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">-- XXX: This is a bit annoying and non-obviously needed. It's coming from the</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- default implementation of HasVariables on the associated Action type. The</span><span>
</span><span id="line-317"></span><span class="hs-comment">-- default implementation required 'Generic', which is not available if we use</span><span>
</span><span id="line-318"></span><span class="hs-comment">-- GADTs for actions (as in the examples).</span><span>
</span><span id="line-319"></span><span id="local-6989586621679412342"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasVariables</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412342"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-320"></span><span>  </span><span id="local-6989586621679412340"><span class="annot"><span class="annottext">getAllVariables :: Action WorldState a -&gt; Set (Any Var)
</span><a href="#local-6989586621679412340"><span class="hs-identifier hs-var hs-var hs-var hs-var">getAllVariables</span></a></span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (Any Var)
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span id="local-6989586621679412333"><span id="local-6989586621679412335"><span id="local-6989586621679412337"><span id="local-6989586621679412339"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412339"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-323"></span><span id="local-6989586621679412328"><span id="local-6989586621679412330"><span id="local-6989586621679412332"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- ** Generator Helper</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-type">genSeed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span id="genSeed"><span class="annot"><span class="annottext">genSeed :: Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-var hs-var">genSeed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-var">Seed</span></a></span><span> </span><span class="annot"><span class="annottext">([(SigningKey HydraKey, CardanoSigningKey)]
 -&gt; ContestationPeriod -&gt; Action WorldState ())
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (ContestationPeriod -&gt; Action WorldState ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a. Int -&gt; Gen a -&gt; Gen a
</span><span class="hs-identifier hs-var">resize</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">maximumNumberOfParties</span></span><span> </span><span class="annot"><span class="annottext">Gen [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#partyKeys"><span class="hs-identifier hs-var">partyKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (ContestationPeriod -&gt; Action WorldState ())
-&gt; Gen ContestationPeriod -&gt; Gen (Action WorldState ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Gen ContestationPeriod
</span><a href="Hydra.Model.html#genContestationPeriod"><span class="hs-identifier hs-var">genContestationPeriod</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="annot"><a href="Hydra.Model.html#genContestationPeriod"><span class="hs-identifier hs-type">genContestationPeriod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span>
</span><span id="line-331"></span><span id="genContestationPeriod"><span class="annot"><span class="annottext">genContestationPeriod :: Gen ContestationPeriod
</span><a href="Hydra.Model.html#genContestationPeriod"><span class="hs-identifier hs-var hs-var">genContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>  </span><span id="local-6989586621679412324"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679412324"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Word, Word) -&gt; Gen Word
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">200</span></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; Gen ContestationPeriod
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ContestationPeriod -&gt; Gen ContestationPeriod)
-&gt; ContestationPeriod -&gt; Gen ContestationPeriod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ContestationPeriod
</span><span class="hs-identifier hs-var">UnsafeContestationPeriod</span></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ContestationPeriod) -&gt; Natural -&gt; ContestationPeriod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679412324"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span id="local-6989586621679412948"><span class="annot"><a href="Hydra.Model.html#genInit"><span class="hs-identifier hs-type">genInit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679412948"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-336"></span><span id="genInit"><span class="annot"><span class="annottext">genInit :: [(SigningKey HydraKey, b)] -&gt; Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genInit"><span class="hs-identifier hs-var hs-var">genInit</span></a></span></span><span> </span><span id="local-6989586621679412323"><span class="annot"><span class="annottext">[(SigningKey HydraKey, b)]
</span><a href="#local-6989586621679412323"><span class="hs-identifier hs-var">hydraParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621679412322"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412322"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, b) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, b) -&gt; SigningKey HydraKey)
-&gt; Gen (SigningKey HydraKey, b) -&gt; Gen (SigningKey HydraKey)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, b)] -&gt; Gen (SigningKey HydraKey, b)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, b)]
</span><a href="#local-6989586621679412323"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412321"><span class="annot"><span class="annottext">party :: Party
</span><a href="#local-6989586621679412321"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412322"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-339"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Gen (Action WorldState ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Gen (Action WorldState ()))
-&gt; Action WorldState () -&gt; Gen (Action WorldState ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-var">Init</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412321"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="Hydra.Model.html#genCommit%27"><span class="hs-identifier hs-type">genCommit'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span id="genCommit%27"><span class="annot"><span class="annottext">genCommit' :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Gen (Action WorldState [(CardanoSigningKey, Value)])
</span><a href="Hydra.Model.html#genCommit%27"><span class="hs-identifier hs-var hs-var">genCommit'</span></a></span></span><span> </span><span id="local-6989586621679412319"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412319"><span class="hs-identifier hs-var">hydraParties</span></a></span></span><span> </span><span id="local-6989586621679412318"><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey)
</span><a href="#local-6989586621679412318"><span class="hs-identifier hs-var">hydraParty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412317"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412317"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (SigningKey HydraKey, CardanoSigningKey)
 -&gt; (SigningKey HydraKey, CardanoSigningKey))
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Bool)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey)
</span><a href="#local-6989586621679412318"><span class="hs-identifier hs-var">hydraParty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412319"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span id="local-6989586621679412316"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412316"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen Value
</span><a href="Hydra.Model.Payment.html#genAdaValue"><span class="hs-identifier hs-var">genAdaValue</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412315"><span class="annot"><span class="annottext">utxo :: [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412315"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412317"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412316"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState [(CardanoSigningKey, Value)]
-&gt; Gen (Action WorldState [(CardanoSigningKey, Value)])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Action WorldState [(CardanoSigningKey, Value)]
 -&gt; Gen (Action WorldState [(CardanoSigningKey, Value)]))
-&gt; Action WorldState [(CardanoSigningKey, Value)]
-&gt; Gen (Action WorldState [(CardanoSigningKey, Value)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; UTxOType Payment -&gt; Action WorldState (UTxOType Payment)
</span><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; (SigningKey HydraKey, CardanoSigningKey) -&gt; Party
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey)
</span><a href="#local-6989586621679412318"><span class="hs-identifier hs-var">hydraParty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679412315"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="Hydra.Model.html#genPayment"><span class="hs-identifier hs-type">genPayment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span id="genPayment"><span class="annot"><span class="annottext">genPayment :: WorldState -&gt; Gen (Party, Payment)
</span><a href="Hydra.Model.html#genPayment"><span class="hs-identifier hs-var hs-var">genPayment</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412314"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412314"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412313"><span class="annot"><span class="annottext">GlobalState
hydraState :: GlobalState
$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="#local-6989586621679412313"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412313"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412312"><span class="annot"><span class="annottext">UTxOType Payment
confirmedUTxO :: UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
</span><a href="#local-6989586621679412312"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679412311"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412311"><span class="hs-identifier hs-var">from</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412310"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412310"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-356"></span><span>        </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)] -&gt; Gen (CardanoSigningKey, Value)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CardanoSigningKey, Value) -&gt; Bool)
-&gt; [(CardanoSigningKey, Value)] -&gt; [(CardanoSigningKey, Value)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((CardanoSigningKey, Value) -&gt; Bool)
-&gt; (CardanoSigningKey, Value)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, Quantity)] -&gt; Bool)
-&gt; ((CardanoSigningKey, Value) -&gt; [(AssetId, Quantity)])
-&gt; (CardanoSigningKey, Value)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">valueToList</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetId, Quantity)])
-&gt; ((CardanoSigningKey, Value) -&gt; Value)
-&gt; (CardanoSigningKey, Value)
-&gt; [(AssetId, Quantity)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey, Value) -&gt; Value
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679412312"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412307"><span class="annot"><span class="annottext">party :: Party
</span><a href="#local-6989586621679412307"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party) -&gt; SigningKey HydraKey -&gt; Party
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (SigningKey HydraKey, CardanoSigningKey)
 -&gt; (SigningKey HydraKey, CardanoSigningKey))
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Bool)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">List.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; CardanoSigningKey -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412311"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; Bool)
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412314"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-comment">-- NOTE: It's perfectly possible this yields a payment to self and it</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-comment">-- assumes hydraParties is not empty else `elements` will crash</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412306"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412306"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412314"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">(Party, Payment) -&gt; Gen (Party, Payment)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412307"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment :: CardanoSigningKey -&gt; CardanoSigningKey -&gt; Value -&gt; Payment
</span><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">CardanoSigningKey
from :: CardanoSigningKey
from :: CardanoSigningKey
</span><a href="#local-6989586621679412311"><span class="hs-identifier hs-var hs-var">from</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
to :: CardanoSigningKey
to :: CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#to"><span class="hs-identifier hs-var hs-var">to</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
value :: Value
value :: Value
</span><a href="#local-6989586621679412310"><span class="hs-identifier hs-var hs-var">value</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Gen (Party, Payment)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Gen (Party, Payment)) -&gt; Text -&gt; Gen (Party, Payment)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;genPayment impossible in state: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412313"><span class="hs-identifier hs-var">hydraState</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span id="local-6989586621679412741"><span class="annot"><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-type">unsafeConstructorName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412741"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679412741"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span></span><span>
</span><span id="line-365"></span><span id="unsafeConstructorName"><span class="annot"><span class="annottext">unsafeConstructorName :: a -&gt; String
</span><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-var hs-var">unsafeConstructorName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall a. [a] -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.head</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; (a -&gt; [String]) -&gt; a -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.words</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; (a -&gt; String) -&gt; a -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="hs-comment">-- |Generate a list of pairs of Hydra/Cardano signing keys.</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- All the keys in this list are guaranteed to be unique.</span><span>
</span><span id="line-369"></span><span class="annot"><a href="Hydra.Model.html#partyKeys"><span class="hs-identifier hs-type">partyKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-370"></span><span id="partyKeys"><span class="annot"><span class="annottext">partyKeys :: Gen [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#partyKeys"><span class="hs-identifier hs-var hs-var">partyKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><span class="annottext">(Int -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a. (Int -&gt; Gen a) -&gt; Gen a
</span><span class="hs-identifier hs-var">sized</span></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
 -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; (Int -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679412299"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679412299"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621679412298"><span class="annot"><span class="annottext">[SigningKey HydraKey]
</span><a href="#local-6989586621679412298"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey] -&gt; [SigningKey HydraKey]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">([SigningKey HydraKey] -&gt; [SigningKey HydraKey])
-&gt; Gen [SigningKey HydraKey] -&gt; Gen [SigningKey HydraKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen (SigningKey HydraKey) -&gt; Gen [SigningKey HydraKey]
forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679412299"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (SigningKey HydraKey)
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-373"></span><span>    </span><span id="local-6989586621679412296"><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679412296"><span class="hs-identifier hs-var">cks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey] -&gt; [CardanoSigningKey]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">([CardanoSigningKey] -&gt; [CardanoSigningKey])
-&gt; ([SigningKey PaymentKey] -&gt; [CardanoSigningKey])
-&gt; [SigningKey PaymentKey]
-&gt; [CardanoSigningKey]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; CardanoSigningKey)
-&gt; [SigningKey PaymentKey] -&gt; [CardanoSigningKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-var">CardanoSigningKey</span></a></span><span> </span><span class="annot"><span class="annottext">([SigningKey PaymentKey] -&gt; [CardanoSigningKey])
-&gt; Gen [SigningKey PaymentKey] -&gt; Gen [CardanoSigningKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen (SigningKey PaymentKey) -&gt; Gen [SigningKey PaymentKey]
forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679412299"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (SigningKey PaymentKey)
</span><span class="hs-identifier hs-var">genSigningKey</span></span><span>
</span><span id="line-374"></span><span>    </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([(SigningKey HydraKey, CardanoSigningKey)]
 -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey]
-&gt; [CardanoSigningKey]
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey]
</span><a href="#local-6989586621679412298"><span class="hs-identifier hs-var">hks</span></a></span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679412296"><span class="hs-identifier hs-var">cks</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-comment">-- * Running the model</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- | Concrete state needed to run actions against the implementation.</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- This state is used and might be updated when actually `perform`ing actions generated from the `StateModel`.</span><span>
</span><span id="line-380"></span><span class="hs-keyword">data</span><span> </span><span id="Nodes"><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-var">Nodes</span></a></span></span><span> </span><span id="local-6989586621679412727"><span class="annot"><a href="#local-6989586621679412727"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Nodes"><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-var">Nodes</span></a></span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Anodes%3ANodes"><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier hs-type">TestHydraClient</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><a href="#local-6989586621679412727"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-comment">-- ^ Map from party identifiers to a /handle/ for interacting with a node.</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Alogger%3ANodes"><span class="annot"><span class="annottext">Nodes m -&gt; Tracer m (HydraLog Tx ())
</span><a href="Hydra.Model.html#%24sel%3Alogger%3ANodes"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412727"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HydraLog</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-comment">-- ^ Logger used by each node.</span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-comment">-- The reason we put this here is because the concrete value needs to be</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-comment">-- instantiated upon the test run initialisation, outiside of the model.</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Athreads%3ANodes"><span class="annot"><span class="annottext">Nodes m -&gt; [Async m ()]
</span><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var hs-var">threads</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="annot"><a href="#local-6989586621679412727"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-comment">-- ^ List of threads spawned when executing `RunMonad`</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-comment">-- NOTE: This newtype is needed to allow its use in typeclass instances</span><span>
</span><span id="line-392"></span><span class="hs-keyword">newtype</span><span> </span><span id="RunState"><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-var">RunState</span></a></span></span><span> </span><span id="local-6989586621679412778"><span class="annot"><a href="#local-6989586621679412778"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunState"><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-var">RunState</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AnodesState%3ARunState"><span class="annot"><span class="annottext">RunState m -&gt; TVar m (Nodes m)
</span><a href="Hydra.Model.html#%24sel%3AnodesState%3ARunState"><span class="hs-identifier hs-var hs-var">nodesState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679412778"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-type">Nodes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412778"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="hs-comment">-- | Our execution `MonadTrans`former.</span><span>
</span><span id="line-395"></span><span class="hs-comment">--</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- This type is needed in order to keep the execution monad `m` abstract  and thus</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- simplify the definition of the `RunModel` instance which requires a proper definition</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- of `Realized`  type family. See [this issue](https://github.com/input-output-hk/quickcheck-dynamic/issues/29)</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- for a discussion on why this monad is needed.</span><span>
</span><span id="line-400"></span><span class="hs-comment">--</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- We could perhaps getaway with it and just have a type based on `IOSim` monad</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- but this is cumbersome to write.</span><span>
</span><span id="line-403"></span><span class="hs-keyword">newtype</span><span> </span><span id="RunMonad"><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-var">RunMonad</span></a></span></span><span> </span><span id="local-6989586621679412789"><span class="annot"><a href="#local-6989586621679412789"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679412788"><span class="annot"><a href="#local-6989586621679412788"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunMonad"><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-var">RunMonad</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3ArunMonad%3ARunMonad"><span class="annot"><span class="annottext">RunMonad m a -&gt; ReaderT (RunState m) m a
</span><a href="Hydra.Model.html#%24sel%3ArunMonad%3ARunMonad"><span class="hs-identifier hs-var hs-var">runMonad</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-type">RunState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412789"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679412789"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412788"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412283"><span id="local-6989586621679412285"><span class="annot"><span class="annottext">a -&gt; RunMonad m b -&gt; RunMonad m a
(a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
(forall a b. (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b)
-&gt; (forall a b. a -&gt; RunMonad m b -&gt; RunMonad m a)
-&gt; Functor (RunMonad m)
forall a b. a -&gt; RunMonad m b -&gt; RunMonad m a
forall a b. (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; RunMonad m b -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; RunMonad m b -&gt; RunMonad m a
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; RunMonad m b -&gt; RunMonad m a
fmap :: (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412271"><span id="local-6989586621679412273"><span id="local-6989586621679412275"><span id="local-6989586621679412277"><span id="local-6989586621679412279"><span class="annot"><span class="annottext">Functor (RunMonad m)
a -&gt; RunMonad m a
Functor (RunMonad m)
-&gt; (forall a. a -&gt; RunMonad m a)
-&gt; (forall a b.
    RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a)
-&gt; Applicative (RunMonad m)
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
forall a. a -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall a b. RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
forall (f :: * -&gt; *).
Functor f
-&gt; (forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall (m :: * -&gt; *). Applicative m =&gt; Functor (RunMonad m)
forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
&lt;* :: RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
$c&lt;* :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
*&gt; :: RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
$c*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
liftA2 :: (a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
&lt;*&gt; :: RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
pure :: a -&gt; RunMonad m a
$cpure :: forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; RunMonad m a
$cp1Applicative :: forall (m :: * -&gt; *). Applicative m =&gt; Functor (RunMonad m)
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412263"><span id="local-6989586621679412265"><span id="local-6989586621679412267"><span class="annot"><span class="annottext">Applicative (RunMonad m)
a -&gt; RunMonad m a
Applicative (RunMonad m)
-&gt; (forall a b.
    RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b)
-&gt; (forall a. a -&gt; RunMonad m a)
-&gt; Monad (RunMonad m)
RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall a. a -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (RunMonad m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *).
Applicative m
-&gt; (forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
return :: a -&gt; RunMonad m a
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RunMonad m a
&gt;&gt; :: RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
&gt;&gt;= :: RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
$cp1Monad :: forall (m :: * -&gt; *). Monad m =&gt; Applicative (RunMonad m)
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412255"><span id="local-6989586621679412257"><span id="local-6989586621679412259"><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-type">RunState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412789"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412245"><span id="local-6989586621679412247"><span id="local-6989586621679412249"><span id="local-6989586621679412251"><span class="annot"><span class="annottext">Monad (RunMonad m)
e -&gt; RunMonad m a
Monad (RunMonad m)
-&gt; (forall e a. Exception e =&gt; e -&gt; RunMonad m a)
-&gt; (forall a b c.
    RunMonad m a
    -&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c)
-&gt; (forall a b c.
    RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a)
-&gt; MonadThrow (RunMonad m)
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall e a. Exception e =&gt; e -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall a b c.
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
forall a b c.
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
forall (m :: * -&gt; *).
Monad m
-&gt; (forall e a. Exception e =&gt; e -&gt; m a)
-&gt; (forall a b c. m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c)
-&gt; (forall a b c. m a -&gt; m b -&gt; m c -&gt; m c)
-&gt; (forall a b. m a -&gt; m b -&gt; m a)
-&gt; MonadThrow m
forall (m :: * -&gt; *). MonadThrow m =&gt; Monad (RunMonad m)
forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
finally :: RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
$cfinally :: forall (m :: * -&gt; *) a b.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
bracket_ :: RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
$cbracket_ :: forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
bracket :: RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
$cbracket :: forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
throwIO :: e -&gt; RunMonad m a
$cthrowIO :: forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; RunMonad m a
$cp1MonadThrow :: forall (m :: * -&gt; *). MonadThrow m =&gt; Monad (RunMonad m)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTrans</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-407"></span><span>  </span><span id="local-6989586621679412241"><span class="annot"><span class="annottext">lift :: m a -&gt; RunMonad m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (RunState m) m a -&gt; RunMonad m a
forall (m :: * -&gt; *) a. ReaderT (RunState m) m a -&gt; RunMonad m a
</span><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-var">RunMonad</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (RunState m) m a -&gt; RunMonad m a)
-&gt; (m a -&gt; ReaderT (RunState m) m a) -&gt; m a -&gt; RunMonad m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; ReaderT (RunState m) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span id="local-6989586621679412239"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679412234"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679412239"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-type">Nodes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412239"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412239"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-410"></span><span>  </span><span id="local-6989586621679412232"><span class="annot"><span class="annottext">get :: RunMonad m (Nodes m)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
-&gt; (RunState m -&gt; RunMonad m (Nodes m)) -&gt; RunMonad m (Nodes m)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">m (Nodes m) -&gt; RunMonad m (Nodes m)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Nodes m) -&gt; RunMonad m (Nodes m))
-&gt; (RunState m -&gt; m (Nodes m))
-&gt; RunState m
-&gt; RunMonad m (Nodes m)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m (Nodes m) -&gt; m (Nodes m)
forall (m :: * -&gt; *) a. MonadSTM m =&gt; TVar m a -&gt; m a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">(TVar m (Nodes m) -&gt; m (Nodes m))
-&gt; (RunState m -&gt; TVar m (Nodes m)) -&gt; RunState m -&gt; m (Nodes m)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RunState m -&gt; TVar m (Nodes m)
forall (m :: * -&gt; *). RunState m -&gt; TVar m (Nodes m)
</span><a href="Hydra.Model.html#%24sel%3AnodesState%3ARunState"><span class="hs-identifier hs-var hs-var">nodesState</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>  </span><span id="local-6989586621679412229"><span class="annot"><span class="annottext">put :: Nodes m -&gt; RunMonad m ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">put</span></span></span><span> </span><span id="local-6989586621679412227"><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679412227"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
-&gt; (RunState m -&gt; RunMonad m ()) -&gt; RunMonad m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ())
-&gt; (RunState m -&gt; m ()) -&gt; RunState m -&gt; RunMonad m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">STM m () -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM m () -&gt; m ())
-&gt; (RunState m -&gt; STM m ()) -&gt; RunState m -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TVar m (Nodes m) -&gt; (Nodes m -&gt; Nodes m) -&gt; STM m ())
-&gt; (Nodes m -&gt; Nodes m) -&gt; TVar m (Nodes m) -&gt; STM m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m (Nodes m) -&gt; (Nodes m -&gt; Nodes m) -&gt; STM m ()
forall (m :: * -&gt; *) a.
MonadSTM m =&gt;
TVar m a -&gt; (a -&gt; a) -&gt; STM m ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nodes m -&gt; Nodes m -&gt; Nodes m
forall a b. a -&gt; b -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679412227"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TVar m (Nodes m) -&gt; STM m ())
-&gt; (RunState m -&gt; TVar m (Nodes m)) -&gt; RunState m -&gt; STM m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RunState m -&gt; TVar m (Nodes m)
forall (m :: * -&gt; *). RunState m -&gt; TVar m (Nodes m)
</span><a href="Hydra.Model.html#%24sel%3AnodesState%3ARunState"><span class="hs-identifier hs-var hs-var">nodesState</span></a></span></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span class="hs-keyword">data</span><span> </span><span id="RunException"><span class="annot"><a href="Hydra.Model.html#RunException"><span class="hs-identifier hs-var">RunException</span></a></span></span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TransactionNotObserved"><span class="annot"><a href="Hydra.Model.html#TransactionNotObserved"><span class="hs-identifier hs-var">TransactionNotObserved</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnexpectedParty"><span class="annot"><a href="Hydra.Model.html#UnexpectedParty"><span class="hs-identifier hs-var">UnexpectedParty</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnknownAddress"><span class="annot"><a href="Hydra.Model.html#UnknownAddress"><span class="hs-identifier hs-var">UnknownAddress</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CannotFindSpendableUTxO"><span class="annot"><a href="Hydra.Model.html#CannotFindSpendableUTxO"><span class="hs-identifier hs-var">CannotFindSpendableUTxO</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412216"><span id="local-6989586621679412218"><span class="annot"><span class="annottext">RunException -&gt; RunException -&gt; Bool
(RunException -&gt; RunException -&gt; Bool)
-&gt; (RunException -&gt; RunException -&gt; Bool) -&gt; Eq RunException
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: RunException -&gt; RunException -&gt; Bool
$c/= :: RunException -&gt; RunException -&gt; Bool
== :: RunException -&gt; RunException -&gt; Bool
$c== :: RunException -&gt; RunException -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412210"><span id="local-6989586621679412212"><span id="local-6989586621679412214"><span class="annot"><span class="annottext">Int -&gt; RunException -&gt; ShowS
[RunException] -&gt; ShowS
RunException -&gt; String
(Int -&gt; RunException -&gt; ShowS)
-&gt; (RunException -&gt; String)
-&gt; ([RunException] -&gt; ShowS)
-&gt; Show RunException
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RunException] -&gt; ShowS
$cshowList :: [RunException] -&gt; ShowS
show :: RunException -&gt; String
$cshow :: RunException -&gt; String
showsPrec :: Int -&gt; RunException -&gt; ShowS
$cshowsPrec :: Int -&gt; RunException -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679412202"><span id="local-6989586621679412204"><span id="local-6989586621679412206"><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#RunException"><span class="hs-identifier hs-type">RunException</span></a></span></span></span></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-comment">-- | This type family is needed to link the _actual_ output from runnign actions</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- with the ones that are modelled.</span><span>
</span><span id="line-425"></span><span class="hs-comment">--</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- In our case we can keep things simple and use the same types on both side of</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- the fence.</span><span>
</span><span id="line-428"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Realized"><span class="annot"><span class="hs-identifier hs-var">Realized</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span id="local-6989586621679412200"><span class="annot"><a href="#local-6989586621679412200"><span class="hs-identifier hs-type hs-type">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679412199"><span class="annot"><a href="#local-6989586621679412199"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679412199"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span id="local-6989586621679412198"><span class="hs-keyword">instance</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679412198"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFork</span></span><span> </span><span class="annot"><a href="#local-6989586621679412198"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679412198"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412198"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679412198"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLabelledSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679412198"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">RunModel</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412198"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-440"></span><span>  </span><span id="local-6989586621679412192"><span class="annot"><span class="annottext">postcondition :: (WorldState, WorldState)
-&gt; Action WorldState a
-&gt; LookUp (RunMonad m)
-&gt; Realized (RunMonad m) a
-&gt; PostconditionM (RunMonad m) Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">postcondition</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412190"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412190"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679412189"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412189"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679412188"><span class="annot"><span class="annottext">LookUp (RunMonad m)
</span><a href="#local-6989586621679412188"><span class="hs-identifier hs-var">_l</span></a></span></span><span> </span><span id="local-6989586621679412187"><span class="annot"><span class="annottext">Realized (RunMonad m) a
</span><a href="#local-6989586621679412187"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PostconditionM (RunMonad m) Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; PostconditionM (RunMonad m) Bool)
-&gt; Bool -&gt; PostconditionM (RunMonad m) Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; Action WorldState a -&gt; a -&gt; Bool
forall a. WorldState -&gt; Action WorldState a -&gt; a -&gt; Bool
</span><a href="Hydra.Model.html#checkOutcome"><span class="hs-identifier hs-var">checkOutcome</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412190"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412189"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">a
Realized (RunMonad m) a
</span><a href="#local-6989586621679412187"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>  </span><span id="local-6989586621679412185"><span class="annot"><span class="annottext">monitoring :: (WorldState, WorldState)
-&gt; Action WorldState a
-&gt; LookUp (RunMonad m)
-&gt; Realized (RunMonad m) a
-&gt; Property
-&gt; Property
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">monitoring</span></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412183"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412183"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412182"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412182"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679412181"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412181"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679412180"><span class="annot"><span class="annottext">LookUp (RunMonad m)
</span><a href="#local-6989586621679412180"><span class="hs-identifier hs-var">_l</span></a></span></span><span> </span><span id="local-6989586621679412179"><span class="annot"><span class="annottext">Realized (RunMonad m) a
</span><a href="#local-6989586621679412179"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><span class="annottext">Property -&gt; Property
</span><a href="#local-6989586621679412178"><span class="hs-identifier hs-var">decoratePostconditionFailure</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">(Property -&gt; Property)
-&gt; (Property -&gt; Property) -&gt; Property -&gt; Property
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Property -&gt; Property
</span><a href="#local-6989586621679412177"><span class="hs-identifier hs-var">decorateTransitions</span></a></span><span>
</span><span id="line-445"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-comment">-- REVIEW: This should be part of the quickcheck-dynamic runActions</span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621679412178"><span class="annot"><span class="annottext">decoratePostconditionFailure :: Property -&gt; Property
</span><a href="#local-6989586621679412178"><span class="hs-identifier hs-var hs-var">decoratePostconditionFailure</span></a></span></span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; Action WorldState a -&gt; a -&gt; Bool
forall a. WorldState -&gt; Action WorldState a -&gt; a -&gt; Bool
</span><a href="Hydra.Model.html#checkOutcome"><span class="hs-identifier hs-var">checkOutcome</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412183"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412181"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">a
Realized (RunMonad m) a
</span><a href="#local-6989586621679412179"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Property -&gt; Property
forall a. a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-449"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-450"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;postcondition failed&quot;</span></span><span>
</span><span id="line-451"></span><span>            </span><span class="annot"><span class="annottext">(Property -&gt; Property)
-&gt; (Property -&gt; Property) -&gt; Property -&gt; Property
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Action: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState a -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412181"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>            </span><span class="annot"><span class="annottext">(Property -&gt; Property)
-&gt; (Property -&gt; Property) -&gt; Property -&gt; Property
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;State: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412183"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>            </span><span class="annot"><span class="annottext">(Property -&gt; Property)
-&gt; (Property -&gt; Property) -&gt; Property -&gt; Property
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Property -&gt; Property
forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Result: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Show a =&gt; String) -&gt; Action WorldState a -&gt; String
forall a b. (Show a =&gt; b) -&gt; Action WorldState a -&gt; b
</span><a href="Hydra.Model.html#showFromAction"><span class="hs-identifier hs-var">showFromAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
Realized (RunMonad m) a
</span><a href="#local-6989586621679412179"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412181"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>    </span><span id="local-6989586621679412177"><span class="annot"><span class="annottext">decorateTransitions :: Property -&gt; Property
</span><a href="#local-6989586621679412177"><span class="hs-identifier hs-var hs-var">decorateTransitions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412183"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412182"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679412174"><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412174"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412173"><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412173"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; Property -&gt; Property
forall prop.
Testable prop =&gt;
String -&gt; [String] -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">tabulate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Transitions&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalState -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-var">unsafeConstructorName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412174"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; -&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-var">unsafeConstructorName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679412173"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621679412172"><span class="annot"><span class="annottext">perform :: WorldState
-&gt; Action WorldState a
-&gt; LookUp (RunMonad m)
-&gt; RunMonad m (Realized (RunMonad m) a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">perform</span></span></span><span> </span><span id="local-6989586621679412170"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412170"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679412169"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412169"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="annot"><span class="annottext">LookUp (RunMonad m)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679412169"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412168"><span class="annot"><a href="#local-6989586621679412168"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412167"><span class="annot"><a href="#local-6989586621679412167"><span class="hs-identifier hs-var hs-var">seedContestationPeriod</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-462"></span><span>        </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadDelay m, MonadAsync m, MonadTimer m, MonadThrow (STM m),
 MonadLabelledSTM m, MonadFork m, MonadMask m) =&gt;
[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#seedWorld"><span class="hs-identifier hs-var">seedWorld</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412168"><span class="hs-identifier hs-var">seedKeys</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679412167"><span class="hs-identifier hs-var">seedContestationPeriod</span></a></span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679412165"><span class="annot"><a href="#local-6989586621679412165"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679412164"><span class="annot"><a href="#local-6989586621679412164"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>        </span><span class="annot"><span class="annottext">[CardanoSigningKey]
-&gt; Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m (UTxOType Payment)
forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m) =&gt;
[CardanoSigningKey]
-&gt; Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m (UTxOType Payment)
</span><a href="Hydra.Model.html#performCommit"><span class="hs-identifier hs-var">performCommit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; [CardanoSigningKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412170"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412165"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679412164"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-465"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span> </span><span id="local-6989586621679412162"><span class="annot"><a href="#local-6989586621679412162"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679412161"><span class="annot"><a href="#local-6989586621679412161"><span class="hs-identifier hs-var">transaction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-466"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; Payment -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
Party -&gt; Payment -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performNewTx"><span class="hs-identifier hs-var">performNewTx</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412162"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412161"><span class="hs-identifier hs-var">transaction</span></a></span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span> </span><span id="local-6989586621679412159"><span class="annot"><a href="#local-6989586621679412159"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-468"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadDelay m, MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performInit"><span class="hs-identifier hs-var">performInit</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412159"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span> </span><span id="local-6989586621679412157"><span class="annot"><a href="#local-6989586621679412157"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadDelay m, MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performAbort"><span class="hs-identifier hs-var">performAbort</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412157"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-471"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span> </span><span id="local-6989586621679412155"><span class="annot"><a href="#local-6989586621679412155"><span class="hs-identifier hs-var">delay</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-472"></span><span>        </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679412155"><span class="hs-identifier hs-var">delay</span></a></span><span>
</span><span id="line-473"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span> </span><span id="local-6989586621679412153"><span class="annot"><a href="#local-6989586621679412153"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-474"></span><span>        </span><span id="local-6989586621679412152"><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679412152"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [(Party, TestHydraClient Tx m)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Party (TestHydraClient Tx m)
 -&gt; [(Party, TestHydraClient Tx m)])
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679412152"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">(((Party, TestHydraClient Tx m) -&gt; RunMonad m ()) -&gt; RunMonad m ())
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412148"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412148"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>          </span><span class="annot"><span class="annottext">m (Either UTxO (TxIn, TxOut CtxUTxO))
-&gt; RunMonad m (Either UTxO (TxIn, TxOut CtxUTxO))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall (m :: * -&gt; *).
(MonadDelay m, MonadTimer m) =&gt;
UTxO
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
</span><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-var">waitForUTxOToSpend</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#to"><span class="hs-identifier hs-var hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412153"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#value"><span class="hs-identifier hs-var hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412153"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412148"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad m (Either UTxO (TxIn, TxOut CtxUTxO))
-&gt; (Either UTxO (TxIn, TxOut CtxUTxO) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-477"></span><span>            </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679412146"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412146"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunException -&gt; RunMonad m ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(RunException -&gt; RunMonad m ()) -&gt; RunException -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; UTxO -&gt; RunException
</span><a href="Hydra.Model.html#TransactionNotObserved"><span class="hs-identifier hs-var">TransactionNotObserved</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412153"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412146"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-478"></span><span>            </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; RunMonad m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>        </span><span id="local-6989586621679412144"><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679412144"><span class="hs-identifier hs-var">nodes'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [(Party, TestHydraClient Tx m)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Party (TestHydraClient Tx m)
 -&gt; [(Party, TestHydraClient Tx m)])
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679412144"><span class="hs-identifier hs-var">nodes'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Party, TestHydraClient Tx m) -&gt; RunMonad m ()) -&gt; RunMonad m ())
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412143"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412143"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>          </span><span id="local-6989586621679412142"><span class="annot"><span class="annottext">[ServerOutput Tx]
</span><a href="#local-6989586621679412142"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [ServerOutput Tx] -&gt; RunMonad m [ServerOutput Tx]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m [ServerOutput Tx] -&gt; RunMonad m [ServerOutput Tx])
-&gt; m [ServerOutput Tx] -&gt; RunMonad m [ServerOutput Tx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; m [ServerOutput Tx]
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m [ServerOutput tx]
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AserverOutputs%3ATestHydraClient"><span class="hs-identifier hs-var hs-var">serverOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412143"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-483"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(ServerOutput Tx -&gt; Bool)
-&gt; [ServerOutput Tx] -&gt; Maybe (ServerOutput Tx)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Bool
forall tx. ServerOutput tx -&gt; Bool
</span><a href="#local-6989586621679412140"><span class="hs-identifier hs-var">headIsOpen</span></a></span><span> </span><span class="annot"><span class="annottext">[ServerOutput Tx]
</span><a href="#local-6989586621679412142"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-484"></span><span>            </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; RunMonad m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ServerOutput Tx)
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RunMonad m ()
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The head is not open for node&quot;</span></span><span>
</span><span id="line-486"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-487"></span><span>        </span><span class="annot"><span class="annottext">RunMonad m (Realized (RunMonad m) a)
forall (m :: * -&gt; *). MonadAsync m =&gt; RunMonad m ()
</span><a href="Hydra.Model.html#stopTheWorld"><span class="hs-identifier hs-var">stopTheWorld</span></a></span><span>
</span><span id="line-488"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-489"></span><span>    </span><span id="local-6989586621679412140"><span class="annot"><span class="annottext">headIsOpen :: ServerOutput tx -&gt; Bool
</span><a href="#local-6989586621679412140"><span class="hs-identifier hs-var hs-var">headIsOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-490"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HeadIsOpen</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-491"></span><span>      </span><span id="local-6989586621679412137"><span class="annot"><span class="annottext">ServerOutput tx
</span><a href="#local-6989586621679412137"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-comment">-- ** Performing actions</span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span id="local-6989586621679412739"><span class="annot"><a href="Hydra.Model.html#seedWorld"><span class="hs-identifier hs-type">seedWorld</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLabelledSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFork</span></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-505"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-506"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412739"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-507"></span><span id="seedWorld"><span class="annot"><span class="annottext">seedWorld :: [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#seedWorld"><span class="hs-identifier hs-var hs-var">seedWorld</span></a></span></span><span> </span><span id="local-6989586621679412136"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412136"><span class="hs-identifier hs-var">seedKeys</span></a></span></span><span> </span><span id="local-6989586621679412135"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679412135"><span class="hs-identifier hs-var">seedCP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>  </span><span id="local-6989586621679412134"><span class="annot"><span class="annottext">Tracer m (HydraLog Tx ())
</span><a href="#local-6989586621679412134"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Tracer m (HydraLog Tx ()))
-&gt; RunMonad m (Tracer m (HydraLog Tx ()))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Tracer m (HydraLog Tx ())
forall (m :: * -&gt; *). Nodes m -&gt; Tracer m (HydraLog Tx ())
</span><a href="Hydra.Model.html#%24sel%3Alogger%3ANodes"><span class="hs-identifier hs-var hs-var">logger</span></a></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>  </span><span id="local-6989586621679412133"><span class="annot"><span class="annottext">mockChain :: SimulatedChainNetwork Tx m
</span><a href="#local-6989586621679412133"><span class="hs-identifier hs-var">mockChain</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier hs-type">SimulatedChainNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621679412131"><span class="annot"><span class="annottext">Async m ()
$sel:tickThread:SimulatedChainNetwork :: forall tx (m :: * -&gt; *). SimulatedChainNetwork tx m -&gt; Async m ()
tickThread :: Async m ()
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AtickThread%3ASimulatedChainNetwork"><span class="hs-identifier hs-var hs-var">tickThread</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><span class="annottext">m (SimulatedChainNetwork Tx m)
-&gt; RunMonad m (SimulatedChainNetwork Tx m)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (SimulatedChainNetwork Tx m)
 -&gt; RunMonad m (SimulatedChainNetwork Tx m))
-&gt; m (SimulatedChainNetwork Tx m)
-&gt; RunMonad m (SimulatedChainNetwork Tx m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-512"></span><span>      </span><span class="annot"><span class="annottext">Tracer m DirectChainLog
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod
-&gt; m (SimulatedChainNetwork Tx m)
forall (m :: * -&gt; *).
(MonadSTM m, MonadTimer m, MonadAsync m, MonadMask m,
 MonadThrow (STM m), MonadLabelledSTM m, MonadFork m) =&gt;
Tracer m DirectChainLog
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod
-&gt; m (SimulatedChainNetwork Tx m)
</span><a href="Hydra.Model.MockChain.html#mockChainAndNetwork"><span class="hs-identifier hs-var">mockChainAndNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DirectChainLog -&gt; HydraLog Tx ())
-&gt; Tracer m (HydraLog Tx ()) -&gt; Tracer m DirectChainLog
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">DirectChainLog -&gt; HydraLog Tx ()
forall tx net. DirectChainLog -&gt; HydraLog tx net
</span><span class="hs-identifier hs-var">DirectChain</span></span><span> </span><span class="annot"><span class="annottext">Tracer m (HydraLog Tx ())
</span><a href="#local-6989586621679412134"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412136"><span class="hs-identifier hs-var">seedKeys</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679412135"><span class="hs-identifier hs-var">seedCP</span></a></span><span>
</span><span id="line-513"></span><span>  </span><span class="annot"><span class="annottext">Async m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) (m :: * -&gt; *).
MonadState (Nodes m) m =&gt;
Async m () -&gt; m ()
</span><a href="#local-6989586621679412128"><span class="hs-identifier hs-var">pushThread</span></a></span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412131"><span class="hs-identifier hs-var">tickThread</span></a></span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span>  </span><span id="local-6989586621679412127"><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679412127"><span class="hs-identifier hs-var">clients</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; RunMonad m (Party, TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412136"><span class="hs-identifier hs-var">seedKeys</span></a></span><span> </span><span class="annot"><span class="annottext">(((SigningKey HydraKey, CardanoSigningKey)
  -&gt; RunMonad m (Party, TestHydraClient Tx m))
 -&gt; RunMonad m [(Party, TestHydraClient Tx m)])
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; RunMonad m (Party, TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679412125"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412125"><span class="hs-identifier hs-var">hsk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412124"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412124"><span class="hs-identifier hs-var">_csk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412123"><span class="annot"><span class="annottext">party :: Party
</span><a href="#local-6989586621679412123"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412125"><span class="hs-identifier hs-var">hsk</span></a></span><span>
</span><span id="line-517"></span><span>        </span><span id="local-6989586621679412122"><span class="annot"><span class="annottext">otherParties :: [Party]
</span><a href="#local-6989586621679412122"><span class="hs-identifier hs-var hs-var">otherParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Bool) -&gt; [Party] -&gt; [Party]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party -&gt; Party -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412123"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679412120"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679412119"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412119"><span class="hs-identifier hs-var">testClient</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412118"><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412118"><span class="hs-identifier hs-var">nodeThread</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (TestHydraClient Tx m, Async m ())
-&gt; RunMonad m (TestHydraClient Tx m, Async m ())
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (TestHydraClient Tx m, Async m ())
 -&gt; RunMonad m (TestHydraClient Tx m, Async m ()))
-&gt; m (TestHydraClient Tx m, Async m ())
-&gt; RunMonad m (TestHydraClient Tx m, Async m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-519"></span><span>      </span><span id="local-6989586621679412117"><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679412117"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM m (TQueue m (ServerOutput Tx))
-&gt; m (TQueue m (ServerOutput Tx))
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM m (TQueue m (ServerOutput Tx))
forall (m :: * -&gt; *) a. MonadSTM m =&gt; STM m (TQueue m a)
</span><span class="hs-identifier hs-var">newTQueue</span></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx) -&gt; String -&gt; m ()
forall (m :: * -&gt; *) a.
MonadLabelledSTM m =&gt;
TQueue m a -&gt; String -&gt; m ()
</span><span class="hs-identifier hs-var">labelTQueueIO</span></span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679412117"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outputs-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; String
</span><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier hs-var">shortLabel</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412125"><span class="hs-identifier hs-var">hsk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>      </span><span id="local-6989586621679412116"><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679412116"><span class="hs-identifier hs-var">outputHistory</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ServerOutput Tx] -&gt; m (TVar m [ServerOutput Tx])
forall (m :: * -&gt; *) a. MonadSTM m =&gt; a -&gt; m (TVar m a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-522"></span><span>      </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx] -&gt; String -&gt; m ()
forall (m :: * -&gt; *) a.
MonadLabelledSTM m =&gt;
TVar m a -&gt; String -&gt; m ()
</span><span class="hs-identifier hs-var">labelTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679412116"><span class="hs-identifier hs-var">outputHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;history-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; String
</span><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier hs-var">shortLabel</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412125"><span class="hs-identifier hs-var">hsk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>      </span><span id="local-6989586621679412115"><span class="annot"><span class="annottext">NodeState Tx m
</span><a href="#local-6989586621679412115"><span class="hs-identifier hs-var">nodeState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HeadState Tx -&gt; m (NodeState Tx m)
forall (m :: * -&gt; *) tx.
(MonadSTM m, MonadLabelledSTM m) =&gt;
HeadState tx -&gt; m (NodeState tx m)
</span><span class="hs-identifier hs-var">createNodeState</span></span><span> </span><span class="annot"><span class="annottext">(HeadState Tx -&gt; m (NodeState Tx m))
-&gt; HeadState Tx -&gt; m (NodeState Tx m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IdleState Tx -&gt; HeadState Tx
forall tx. IdleState tx -&gt; HeadState tx
</span><span class="hs-identifier hs-var">HeadState.Idle</span></span><span> </span><span class="annot"><span class="annottext">IdleState :: forall tx. ChainStateType tx -&gt; IdleState tx
</span><span class="hs-identifier hs-type">IdleState</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:chainState:IdleState :: ChainStateType Tx
</span><span class="hs-identifier hs-var">chainState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainStateType Tx
</span><span class="hs-identifier hs-var">initialChainState</span></span><span class="hs-special">}</span><span>
</span><span id="line-524"></span><span>      </span><span id="local-6989586621679412111"><span class="annot"><span class="annottext">HydraNode Tx m
</span><a href="#local-6989586621679412111"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ledger Tx
-&gt; NodeState Tx m
-&gt; SigningKey HydraKey
-&gt; [Party]
-&gt; TQueue m (ServerOutput Tx)
-&gt; TVar m [ServerOutput Tx]
-&gt; SimulatedChainNetwork Tx m
-&gt; ContestationPeriod
-&gt; m (HydraNode Tx m)
forall (m :: * -&gt; *) tx.
(MonadDelay m, MonadAsync m, MonadLabelledSTM m) =&gt;
Ledger tx
-&gt; NodeState tx m
-&gt; SigningKey HydraKey
-&gt; [Party]
-&gt; TQueue m (ServerOutput tx)
-&gt; TVar m [ServerOutput tx]
-&gt; SimulatedChainNetwork tx m
-&gt; ContestationPeriod
-&gt; m (HydraNode tx m)
</span><a href="Hydra.BehaviorSpec.html#createHydraNode"><span class="hs-identifier hs-var">createHydraNode</span></a></span><span> </span><span class="annot"><span class="annottext">Ledger Tx
</span><a href="#local-6989586621679412110"><span class="hs-identifier hs-var">ledger</span></a></span><span> </span><span class="annot"><span class="annottext">NodeState Tx m
</span><a href="#local-6989586621679412115"><span class="hs-identifier hs-var">nodeState</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412125"><span class="hs-identifier hs-var">hsk</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679412122"><span class="hs-identifier hs-var">otherParties</span></a></span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679412117"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679412116"><span class="hs-identifier hs-var">outputHistory</span></a></span><span> </span><span class="annot"><span class="annottext">SimulatedChainNetwork Tx m
</span><a href="#local-6989586621679412133"><span class="hs-identifier hs-var">mockChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679412135"><span class="hs-identifier hs-var">seedCP</span></a></span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412109"><span class="annot"><span class="annottext">testClient :: TestHydraClient Tx m
</span><a href="#local-6989586621679412109"><span class="hs-identifier hs-var hs-var">testClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
-&gt; TVar m [ServerOutput Tx]
-&gt; HydraNode Tx m
-&gt; TestHydraClient Tx m
forall (m :: * -&gt; *) tx.
MonadSTM m =&gt;
TQueue m (ServerOutput tx)
-&gt; TVar m [ServerOutput tx]
-&gt; HydraNode tx m
-&gt; TestHydraClient tx m
</span><a href="Hydra.BehaviorSpec.html#createTestHydraClient"><span class="hs-identifier hs-var">createTestHydraClient</span></a></span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679412117"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679412116"><span class="hs-identifier hs-var">outputHistory</span></a></span><span> </span><span class="annot"><span class="annottext">HydraNode Tx m
</span><a href="#local-6989586621679412111"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-526"></span><span>      </span><span id="local-6989586621679412108"><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412108"><span class="hs-identifier hs-var">nodeThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (Async m ())
forall (m :: * -&gt; *) a. MonadAsync m =&gt; m a -&gt; m (Async m a)
</span><span class="hs-identifier hs-var">async</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m (Async m ())) -&gt; m () -&gt; m (Async m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><span class="hs-identifier hs-var">labelThisThread</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;node-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; String
</span><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier hs-var">shortLabel</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679412125"><span class="hs-identifier hs-var">hsk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer m (HydraNodeLog Tx) -&gt; HydraNode Tx m -&gt; m ()
forall (m :: * -&gt; *) tx.
(MonadThrow m, MonadCatch m, MonadAsync m, IsChainState tx) =&gt;
Tracer m (HydraNodeLog tx) -&gt; HydraNode tx m -&gt; m ()
</span><span class="hs-identifier hs-var">runHydraNode</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HydraNodeLog Tx -&gt; HydraLog Tx ())
-&gt; Tracer m (HydraLog Tx ()) -&gt; Tracer m (HydraNodeLog Tx)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">HydraNodeLog Tx -&gt; HydraLog Tx ()
forall tx net. HydraNodeLog tx -&gt; HydraLog tx net
</span><span class="hs-identifier hs-var">Node</span></span><span> </span><span class="annot"><span class="annottext">Tracer m (HydraLog Tx ())
</span><a href="#local-6989586621679412134"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HydraNode Tx m
</span><a href="#local-6989586621679412111"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-527"></span><span>      </span><span class="annot"><span class="annottext">Async m () -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadAsync m, MonadFork m, MonadMask m) =&gt;
Async m a -&gt; m ()
</span><span class="hs-identifier hs-var">link</span></span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412108"><span class="hs-identifier hs-var">nodeThread</span></a></span><span>
</span><span id="line-528"></span><span>      </span><span class="annot"><span class="annottext">(TestHydraClient Tx m, Async m ())
-&gt; m (TestHydraClient Tx m, Async m ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412109"><span class="hs-identifier hs-var">testClient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412108"><span class="hs-identifier hs-var">nodeThread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>    </span><span class="annot"><span class="annottext">Async m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) (m :: * -&gt; *).
MonadState (Nodes m) m =&gt;
Async m () -&gt; m ()
</span><a href="#local-6989586621679412128"><span class="hs-identifier hs-var">pushThread</span></a></span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412118"><span class="hs-identifier hs-var">nodeThread</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span class="annot"><span class="annottext">(Party, TestHydraClient Tx m)
-&gt; RunMonad m (Party, TestHydraClient Tx m)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412123"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412119"><span class="hs-identifier hs-var">testClient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>
</span><span id="line-532"></span><span>  </span><span class="annot"><span class="annottext">(Nodes m -&gt; Nodes m) -&gt; RunMonad m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((Nodes m -&gt; Nodes m) -&gt; RunMonad m ())
-&gt; (Nodes m -&gt; Nodes m) -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679412106"><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679412106"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679412106"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:nodes:Nodes :: Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)] -&gt; Map Party (TestHydraClient Tx m)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679412127"><span class="hs-identifier hs-var">clients</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-534"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-535"></span><span>  </span><span id="local-6989586621679412120"><span class="annot"><span class="annottext">parties :: [Party]
</span><a href="#local-6989586621679412120"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)] -&gt; [Party]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679412136"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>  </span><span id="local-6989586621679412110"><span class="annot"><span class="annottext">ledger :: Ledger Tx
</span><a href="#local-6989586621679412110"><span class="hs-identifier hs-var hs-var">ledger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals -&gt; LedgerEnv LedgerEra -&gt; Ledger Tx
</span><span class="hs-identifier hs-var">cardanoLedger</span></span><span> </span><span class="annot"><span class="annottext">Globals
</span><span class="hs-identifier hs-var">defaultGlobals</span></span><span> </span><span class="annot"><span class="annottext">LedgerEnv LedgerEra
</span><span class="hs-identifier hs-var">defaultLedgerEnv</span></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>  </span><span id="local-6989586621679412128"><span class="annot"><span class="annottext">pushThread :: Async m () -&gt; m ()
</span><a href="#local-6989586621679412128"><span class="hs-identifier hs-var hs-var">pushThread</span></a></span></span><span> </span><span id="local-6989586621679412104"><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412104"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Nodes m) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((Nodes m -&gt; Nodes m) -&gt; m ()) -&gt; (Nodes m -&gt; Nodes m) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679412103"><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679412103"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679412103"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:threads:Nodes :: [Async m ()]
</span><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var">threads</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679412104"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Async m () -&gt; [Async m ()] -&gt; [Async m ()]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; [Async m ()]
forall (m :: * -&gt; *). Nodes m -&gt; [Async m ()]
</span><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var hs-var">threads</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679412103"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span id="local-6989586621679412737"><span class="annot"><a href="Hydra.Model.html#performCommit"><span class="hs-identifier hs-type">performCommit</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679412737"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412737"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412737"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#ActualCommitted"><span class="hs-identifier hs-type">ActualCommitted</span></a></span></span><span>
</span><span id="line-548"></span><span id="performCommit"><span class="annot"><span class="annottext">performCommit :: [CardanoSigningKey]
-&gt; Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m (UTxOType Payment)
</span><a href="Hydra.Model.html#performCommit"><span class="hs-identifier hs-var hs-var">performCommit</span></a></span></span><span> </span><span id="local-6989586621679412102"><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679412102"><span class="hs-identifier hs-var">parties</span></a></span></span><span> </span><span id="local-6989586621679412101"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412101"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679412100"><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412100"><span class="hs-identifier hs-var">paymentUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>  </span><span id="local-6989586621679412099"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412099"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span><span>
</span><span id="line-550"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Party
-&gt; Map Party (TestHydraClient Tx m) -&gt; Maybe (TestHydraClient Tx m)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412101"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412099"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TestHydraClient Tx m)
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunException -&gt; RunMonad m [(CardanoSigningKey, Value)]
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(RunException -&gt; RunMonad m [(CardanoSigningKey, Value)])
-&gt; RunException -&gt; RunMonad m [(CardanoSigningKey, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; RunException
</span><a href="Hydra.Model.html#UnexpectedParty"><span class="hs-identifier hs-var">UnexpectedParty</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412101"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679412097"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412097"><span class="hs-identifier hs-var">actorNode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-553"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412096"><span class="annot"><span class="annottext">realUTxO :: UTxO
</span><a href="#local-6989586621679412096"><span class="hs-identifier hs-var hs-var">realUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-554"></span><span>            </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)] -&gt; UTxO
forall out. [(TxIn, out)] -&gt; UTxO' out
</span><span class="hs-identifier hs-var">UTxO.fromPairs</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO)] -&gt; UTxO)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-555"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Word -&gt; TxIn
</span><a href="Hydra.Model.MockChain.html#mkMockTxIn"><span class="hs-identifier hs-var">mkMockTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679412094"><span class="hs-identifier hs-var">vk</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679412093"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679412092"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412093"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679412093"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span id="local-6989586621679412091"><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679412091"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412090"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412090"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word]
-&gt; [(CardanoSigningKey, Value)]
-&gt; [(Word, (CardanoSigningKey, Value))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412100"><span class="hs-identifier hs-var">paymentUTxO</span></a></span><span>
</span><span id="line-557"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412094"><span class="annot"><span class="annottext">vk :: VerificationKey PaymentKey
</span><a href="#local-6989586621679412094"><span class="hs-identifier hs-var hs-var">vk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
Key keyrole =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679412091"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-558"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412092"><span class="annot"><span class="annottext">txOut :: TxOut CtxUTxO
</span><a href="#local-6989586621679412092"><span class="hs-identifier hs-var hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum CtxUTxO -&gt; ReferenceScript -&gt; TxOut CtxUTxO
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra
forall era.
IsShelleyBasedEra era =&gt;
NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkVkAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679412094"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412090"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxUTxO
forall ctx. TxOutDatum ctx
</span><span class="hs-identifier hs-var">TxOutDatumNone</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-559"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412101"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">Commit :: forall tx. UTxOType tx -&gt; ClientInput tx
</span><span class="hs-identifier hs-type">Input.Commit</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">utxo :: UTxOType Tx
</span><span class="hs-identifier hs-var">Input.utxo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOType Tx
UTxO
</span><a href="#local-6989586621679412096"><span class="hs-identifier hs-var">realUTxO</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-561"></span><span>      </span><span id="local-6989586621679412082"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412082"><span class="hs-identifier hs-var">observedUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-562"></span><span>        </span><span class="annot"><span class="annottext">m UTxO -&gt; RunMonad m UTxO
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m UTxO -&gt; RunMonad m UTxO) -&gt; m UTxO -&gt; RunMonad m UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-563"></span><span>          </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; (ServerOutput Tx -&gt; Maybe UTxO) -&gt; m UTxO
forall (m :: * -&gt; *) tx a.
MonadThrow m =&gt;
TestHydraClient tx m -&gt; (ServerOutput tx -&gt; Maybe a) -&gt; m a
</span><a href="Hydra.BehaviorSpec.html#waitMatch"><span class="hs-identifier hs-var">waitMatch</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412097"><span class="hs-identifier hs-var">actorNode</span></a></span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Maybe UTxO) -&gt; m UTxO)
-&gt; (ServerOutput Tx -&gt; Maybe UTxO) -&gt; m UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-564"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Committed</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">party :: forall tx. ServerOutput tx -&gt; Party
</span><span class="hs-identifier hs-var">party</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679412079"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412079"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">utxo :: forall tx. ServerOutput tx -&gt; UTxOType tx
</span><span class="hs-identifier hs-var">utxo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679412077"><span class="annot"><span class="annottext">UTxOType Tx
</span><a href="#local-6989586621679412077"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-565"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412079"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Party -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412101"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Maybe UTxO
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Tx
UTxO
</span><a href="#local-6989586621679412077"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-566"></span><span>            </span><span id="local-6989586621679412076"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679412076"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe UTxO
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe UTxO) -&gt; Text -&gt; Maybe UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679412076"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-567"></span><span>            </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe UTxO
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>      </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
-&gt; RunMonad m [(CardanoSigningKey, Value)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([(CardanoSigningKey, Value)]
 -&gt; RunMonad m [(CardanoSigningKey, Value)])
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m [(CardanoSigningKey, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412074"><span class="hs-identifier hs-var">fromUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412082"><span class="hs-identifier hs-var">observedUTxO</span></a></span><span>
</span><span id="line-570"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-571"></span><span>  </span><span class="annot"><a href="#local-6989586621679412074"><span class="hs-identifier hs-type">fromUtxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-572"></span><span>  </span><span id="local-6989586621679412074"><span class="annot"><span class="annottext">fromUtxo :: UTxO -&gt; [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679412074"><span class="hs-identifier hs-var hs-var">fromUtxo</span></a></span></span><span> </span><span id="local-6989586621679412073"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412073"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AddressInEra, Value) -&gt; (CardanoSigningKey, Value)
</span><a href="#local-6989586621679412072"><span class="hs-identifier hs-var">findSigningKey</span></a></span><span> </span><span class="annot"><span class="annottext">((AddressInEra, Value) -&gt; (CardanoSigningKey, Value))
-&gt; ((TxIn, TxOut CtxUTxO) -&gt; (AddressInEra, Value))
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; (CardanoSigningKey, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; AddressInEra
forall ctx. TxOut ctx -&gt; AddressInEra
</span><span class="hs-identifier hs-var">txOutAddress</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; AddressInEra)
-&gt; (TxOut CtxUTxO -&gt; Value)
-&gt; TxOut CtxUTxO
-&gt; (AddressInEra, Value)
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; (AddressInEra, Value))
-&gt; ((TxIn, TxOut CtxUTxO) -&gt; TxOut CtxUTxO)
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; (AddressInEra, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxOut CtxUTxO
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; (CardanoSigningKey, Value))
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [(CardanoSigningKey, Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; [(TxIn, TxOut CtxUTxO)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412073"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span>  </span><span class="annot"><a href="#local-6989586621679412068"><span class="hs-identifier hs-type">knownAddresses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-575"></span><span>  </span><span id="local-6989586621679412068"><span class="annot"><span class="annottext">knownAddresses :: [(AddressInEra, CardanoSigningKey)]
</span><a href="#local-6989586621679412068"><span class="hs-identifier hs-var hs-var">knownAddresses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AddressInEra]
-&gt; [CardanoSigningKey] -&gt; [(AddressInEra, CardanoSigningKey)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; AddressInEra
</span><a href="#local-6989586621679412067"><span class="hs-identifier hs-var">makeAddressFromSigningKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; AddressInEra)
-&gt; [CardanoSigningKey] -&gt; [AddressInEra]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679412102"><span class="hs-identifier hs-var">parties</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679412102"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><a href="#local-6989586621679412072"><span class="hs-identifier hs-type">findSigningKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>  </span><span id="local-6989586621679412072"><span class="annot"><span class="annottext">findSigningKey :: (AddressInEra, Value) -&gt; (CardanoSigningKey, Value)
</span><a href="#local-6989586621679412072"><span class="hs-identifier hs-var hs-var">findSigningKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679412066"><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679412066"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412065"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412065"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-579"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AddressInEra
-&gt; [(AddressInEra, CardanoSigningKey)] -&gt; Maybe CardanoSigningKey
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">List.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679412066"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">[(AddressInEra, CardanoSigningKey)]
</span><a href="#local-6989586621679412068"><span class="hs-identifier hs-var">knownAddresses</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-580"></span><span>      </span><span class="annot"><span class="annottext">Maybe CardanoSigningKey
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (CardanoSigningKey, Value)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; (CardanoSigningKey, Value))
-&gt; Text -&gt; (CardanoSigningKey, Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cannot invert address:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679412066"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-581"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679412063"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412063"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412063"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412065"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><a href="#local-6989586621679412067"><span class="hs-identifier hs-type">makeAddressFromSigningKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span>
</span><span id="line-584"></span><span>  </span><span id="local-6989586621679412067"><span class="annot"><span class="annottext">makeAddressFromSigningKey :: CardanoSigningKey -&gt; AddressInEra
</span><a href="#local-6989586621679412067"><span class="hs-identifier hs-var hs-var">makeAddressFromSigningKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra
forall era.
IsShelleyBasedEra era =&gt;
NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkVkAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; AddressInEra)
-&gt; (CardanoSigningKey -&gt; VerificationKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; AddressInEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
Key keyrole =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; VerificationKey PaymentKey)
-&gt; (CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; VerificationKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#signingKey"><span class="hs-identifier hs-var hs-var">signingKey</span></a></span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span id="local-6989586621679412736"><span class="annot"><a href="Hydra.Model.html#performNewTx"><span class="hs-identifier hs-type">performNewTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679412736"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679412736"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412736"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-588"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-589"></span><span>  </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412736"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-591"></span><span id="performNewTx"><span class="annot"><span class="annottext">performNewTx :: Party -&gt; Payment -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performNewTx"><span class="hs-identifier hs-var hs-var">performNewTx</span></a></span></span><span> </span><span id="local-6989586621679412062"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412062"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679412061"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412061"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412060"><span class="annot"><span class="annottext">recipient :: AddressInEra
</span><a href="#local-6989586621679412060"><span class="hs-identifier hs-var hs-var">recipient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra
forall era.
IsShelleyBasedEra era =&gt;
NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkVkAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; AddressInEra)
-&gt; (CardanoSigningKey -&gt; VerificationKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; AddressInEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
Key keyrole =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; VerificationKey PaymentKey)
-&gt; (CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; VerificationKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#signingKey"><span class="hs-identifier hs-var hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; AddressInEra)
-&gt; CardanoSigningKey -&gt; AddressInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#to"><span class="hs-identifier hs-var hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412061"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-593"></span><span>  </span><span id="local-6989586621679412059"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412059"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412058"><span class="annot"><span class="annottext">thisNode :: TestHydraClient Tx m
</span><a href="#local-6989586621679412058"><span class="hs-identifier hs-var hs-var">thisNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412059"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; Party -&gt; TestHydraClient Tx m
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-glyph hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412062"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>  </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var">waitForOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412058"><span class="hs-identifier hs-var">thisNode</span></a></span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679412056"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679412056"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679412055"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679412055"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><span class="annottext">m (Either UTxO (TxIn, TxOut CtxUTxO))
-&gt; RunMonad m (Either UTxO (TxIn, TxOut CtxUTxO))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall (m :: * -&gt; *).
(MonadDelay m, MonadTimer m) =&gt;
UTxO
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
</span><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-var">waitForUTxOToSpend</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#from"><span class="hs-identifier hs-var hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412061"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#value"><span class="hs-identifier hs-var hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412061"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412058"><span class="hs-identifier hs-var">thisNode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad m (Either UTxO (TxIn, TxOut CtxUTxO))
-&gt; (Either UTxO (TxIn, TxOut CtxUTxO)
    -&gt; RunMonad m (TxIn, TxOut CtxUTxO))
-&gt; RunMonad m (TxIn, TxOut CtxUTxO)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-600"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679412054"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412054"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO))
-&gt; Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cannot execute NewTx for &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412061"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, no spendable UTxO in &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412054"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-601"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679412053"><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO)
</span><a href="#local-6989586621679412053"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; RunMonad m (TxIn, TxOut CtxUTxO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO)
</span><a href="#local-6989586621679412053"><span class="hs-identifier hs-var">ok</span></a></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679412052"><span class="annot"><span class="annottext">realTx :: Tx
</span><a href="#local-6989586621679412052"><span class="hs-identifier hs-var hs-var">realTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-604"></span><span>        </span><span class="annot"><span class="annottext">(TxBodyError -&gt; Tx) -&gt; (Tx -&gt; Tx) -&gt; Either TxBodyError Tx -&gt; Tx
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span>
</span><span id="line-605"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Tx
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Tx) -&gt; (TxBodyError -&gt; Text) -&gt; TxBodyError -&gt; Tx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>          </span><span class="annot"><span class="annottext">Tx -&gt; Tx
forall a. a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-607"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO)
-&gt; (AddressInEra, Value)
-&gt; SigningKey PaymentKey
-&gt; Either TxBodyError Tx
</span><span class="hs-identifier hs-var">mkSimpleTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679412056"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679412055"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679412060"><span class="hs-identifier hs-var">recipient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#value"><span class="hs-identifier hs-var hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412061"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#signingKey"><span class="hs-identifier hs-var hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey -&gt; SigningKey PaymentKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#from"><span class="hs-identifier hs-var hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679412061"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412062"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; ClientInput Tx
forall tx. tx -&gt; ClientInput tx
</span><span class="hs-identifier hs-var">Input.NewTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679412052"><span class="hs-identifier hs-var">realTx</span></a></span><span>
</span><span id="line-610"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall (m :: * -&gt; *) tx.
(HasCallStack, MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412058"><span class="hs-identifier hs-var">thisNode</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-612"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">SnapshotConfirmed</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">snapshot :: forall tx. ServerOutput tx -&gt; Snapshot tx
</span><span class="hs-identifier hs-var">snapshot</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679412047"><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="#local-6989586621679412047"><span class="hs-identifier hs-var">snapshot</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-613"></span><span>        </span><span class="annot"><span class="annottext">Tx -&gt; TxIdType Tx
forall tx. IsTx tx =&gt; tx -&gt; TxIdType tx
</span><span class="hs-identifier hs-var">txId</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679412052"><span class="hs-identifier hs-var">realTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxId -&gt; [TxId] -&gt; Bool
forall (f :: * -&gt; *) a.
(Foldable f, DisallowElem f, Eq a) =&gt;
a -&gt; f a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx -&gt; [TxIdType Tx]
forall tx. Snapshot tx -&gt; [TxIdType tx]
</span><span class="hs-identifier hs-var hs-var">Snapshot.confirmed</span></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="#local-6989586621679412047"><span class="hs-identifier hs-var">snapshot</span></a></span><span>
</span><span id="line-614"></span><span>      </span><span id="local-6989586621679412043"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679412043"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">TxInvalid</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;expected tx to be valid: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679412043"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="hs-comment">-- | Wait for the head to be open by searching from the beginning. Note that</span><span>
</span><span id="line-618"></span><span class="hs-comment">-- there rollbacks or multiple life-cycles of heads are not handled here.</span><span>
</span><span id="line-619"></span><span id="local-6989586621679412620"><span id="local-6989586621679412621"><span class="annot"><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-type">waitForOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679412621"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier hs-type">TestHydraClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412620"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412621"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412621"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-620"></span><span id="waitForOpen"><span class="annot"><span class="annottext">waitForOpen :: TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var hs-var">waitForOpen</span></a></span></span><span> </span><span id="local-6989586621679412041"><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679412041"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>  </span><span id="local-6989586621679412040"><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679412040"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx]
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx])
-&gt; m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; m [ServerOutput tx]
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m [ServerOutput tx]
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AserverOutputs%3ATestHydraClient"><span class="hs-identifier hs-var hs-var">serverOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679412041"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-622"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; RunMonad m () -&gt; RunMonad m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span>
</span><span id="line-623"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ServerOutput tx -&gt; Bool) -&gt; [ServerOutput tx] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput tx -&gt; Bool
forall tx. ServerOutput tx -&gt; Bool
</span><a href="#local-6989586621679412037"><span class="hs-identifier hs-var">headIsOpen</span></a></span><span> </span><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679412040"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>    </span><span class="annot"><span class="annottext">RunMonad m ()
</span><a href="#local-6989586621679412036"><span class="hs-identifier hs-var">waitAndRetry</span></a></span><span>
</span><span id="line-625"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-626"></span><span>  </span><span id="local-6989586621679412037"><span class="annot"><span class="annottext">headIsOpen :: ServerOutput tx -&gt; Bool
</span><a href="#local-6989586621679412037"><span class="hs-identifier hs-var hs-var">headIsOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-627"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HeadIsOpen</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-628"></span><span>    </span><span class="annot"><span class="annottext">ServerOutput tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>  </span><span id="local-6989586621679412036"><span class="annot"><span class="annottext">waitAndRetry :: RunMonad m ()
</span><a href="#local-6989586621679412036"><span class="hs-identifier hs-var hs-var">waitAndRetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad m () -&gt; RunMonad m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var">waitForOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679412041"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span id="local-6989586621679412641"><span class="annot"><a href="Hydra.Model.html#sendsInput"><span class="hs-identifier hs-type">sendsInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679412641"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679412641"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientInput</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-633"></span><span id="sendsInput"><span class="annot"><span class="annottext">sendsInput :: Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-identifier hs-var hs-var">sendsInput</span></a></span></span><span> </span><span id="local-6989586621679412035"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412035"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679412034"><span class="annot"><span class="annottext">ClientInput Tx
</span><a href="#local-6989586621679412034"><span class="hs-identifier hs-var">command</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621679412033"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412033"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Party
-&gt; Map Party (TestHydraClient Tx m) -&gt; Maybe (TestHydraClient Tx m)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412035"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412033"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-636"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TestHydraClient Tx m)
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunException -&gt; RunMonad m ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(RunException -&gt; RunMonad m ()) -&gt; RunException -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; RunException
</span><a href="Hydra.Model.html#UnexpectedParty"><span class="hs-identifier hs-var">UnexpectedParty</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412035"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679412032"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412032"><span class="hs-identifier hs-var">actorNode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412032"><span class="hs-identifier hs-var">actorNode</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; ClientInput Tx -&gt; m ()
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; ClientInput tx -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#%24sel%3Asend%3ATestHydraClient"><span class="hs-operator hs-var hs-var">`send`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
</span><a href="#local-6989586621679412034"><span class="hs-identifier hs-var">command</span></a></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span id="local-6989586621679412735"><span class="annot"><a href="Hydra.Model.html#performInit"><span class="hs-identifier hs-type">performInit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679412735"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679412735"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679412735"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412735"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412735"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-640"></span><span id="performInit"><span class="annot"><span class="annottext">performInit :: Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performInit"><span class="hs-identifier hs-var hs-var">performInit</span></a></span></span><span> </span><span id="local-6989586621679412030"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412030"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-641"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412030"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.Init</span></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>  </span><span id="local-6989586621679412028"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412028"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-645"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall (m :: * -&gt; *) tx.
(HasCallStack, MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [TestHydraClient Tx m]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412028"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-646"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HeadIsInitializing</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-647"></span><span>      </span><span id="local-6989586621679412026"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679412026"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679412026"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-648"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span id="local-6989586621679412025"><span class="annot"><a href="Hydra.Model.html#performAbort"><span class="hs-identifier hs-type">performAbort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679412025"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679412025"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679412025"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412025"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412025"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-651"></span><span id="performAbort"><span class="annot"><span class="annottext">performAbort :: Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performAbort"><span class="hs-identifier hs-var hs-var">performAbort</span></a></span></span><span> </span><span id="local-6989586621679412024"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412024"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679412024"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.Abort</span></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span>  </span><span id="local-6989586621679412022"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412022"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span><span>
</span><span id="line-655"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-656"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall (m :: * -&gt; *) tx.
(HasCallStack, MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [TestHydraClient Tx m]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679412022"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-657"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HeadIsAborted</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-658"></span><span>      </span><span id="local-6989586621679412020"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679412020"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679412020"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-659"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span id="local-6989586621679412713"><span class="annot"><a href="Hydra.Model.html#stopTheWorld"><span class="hs-identifier hs-type">stopTheWorld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679412713"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412713"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-662"></span><span id="stopTheWorld"><span class="annot"><span class="annottext">stopTheWorld :: RunMonad m ()
</span><a href="Hydra.Model.html#stopTheWorld"><span class="hs-identifier hs-var hs-var">stopTheWorld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>  </span><span class="annot"><span class="annottext">(Nodes m -&gt; [Async m ()]) -&gt; RunMonad m [Async m ()]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; [Async m ()]
forall (m :: * -&gt; *). Nodes m -&gt; [Async m ()]
</span><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var hs-var">threads</span></a></span><span> </span><span class="annot"><span class="annottext">RunMonad m [Async m ()]
-&gt; ([Async m ()] -&gt; RunMonad m ()) -&gt; RunMonad m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Async m () -&gt; RunMonad m ()) -&gt; [Async m ()] -&gt; RunMonad m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RunMonad m () -&gt; RunMonad m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(RunMonad m () -&gt; RunMonad m ())
-&gt; (Async m () -&gt; RunMonad m ()) -&gt; Async m () -&gt; RunMonad m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ())
-&gt; (Async m () -&gt; m ()) -&gt; Async m () -&gt; RunMonad m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Async m () -&gt; m ()
forall (m :: * -&gt; *) a. MonadAsync m =&gt; Async m a -&gt; m ()
</span><span class="hs-identifier hs-var">cancel</span></span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-comment">-- ** Utility functions</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span class="hs-comment">-- | Bring `Show` instance in scope drawing it from the `Action` type.</span><span>
</span><span id="line-668"></span><span class="hs-comment">--</span><span>
</span><span id="line-669"></span><span class="hs-comment">-- This is a neat trick to provide `show`able results from action in a context where</span><span>
</span><span id="line-670"></span><span class="hs-comment">-- there's no explicit `Show a` instance, eg. in the `monitoring` and `postcondition`</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- functions. We don't have access to an `a` directly because its value depends on</span><span>
</span><span id="line-672"></span><span class="hs-comment">-- type family `Realized`.</span><span>
</span><span id="line-673"></span><span id="local-6989586621679412743"><span id="local-6989586621679412744"><span class="annot"><a href="Hydra.Model.html#showFromAction"><span class="hs-identifier hs-type">showFromAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412744"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679412743"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412744"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679412743"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-674"></span><span id="showFromAction"><span class="annot"><span class="annottext">showFromAction :: (Show a =&gt; b) -&gt; Action WorldState a -&gt; b
</span><a href="Hydra.Model.html#showFromAction"><span class="hs-identifier hs-var hs-var">showFromAction</span></a></span></span><span> </span><span id="local-6989586621679412017"><span class="annot"><span class="annottext">Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-679"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-681"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679412017"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span id="local-6989586621679412749"><span class="annot"><a href="Hydra.Model.html#checkOutcome"><span class="hs-identifier hs-type">checkOutcome</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679412749"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679412749"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-686"></span><span id="checkOutcome"><span class="annot"><span class="annottext">checkOutcome :: WorldState -&gt; Action WorldState a -&gt; a -&gt; Bool
</span><a href="Hydra.Model.html#checkOutcome"><span class="hs-identifier hs-var hs-var">checkOutcome</span></a></span></span><span> </span><span id="local-6989586621679412016"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679412016"><span class="hs-identifier hs-var">_st</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679412015"><span class="annot"><a href="#local-6989586621679412015"><span class="hs-identifier hs-var">_party</span></a></span></span><span> </span><span id="local-6989586621679412014"><span class="annot"><a href="#local-6989586621679412014"><span class="hs-identifier hs-var">expectedCommitted</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679412013"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679412013"><span class="hs-identifier hs-var">actualCommitted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-687"></span><span>  </span><span class="annot"><span class="annottext">a
UTxOType Payment
</span><a href="#local-6989586621679412014"><span class="hs-identifier hs-var">expectedCommitted</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679412013"><span class="hs-identifier hs-var">actualCommitted</span></a></span><span>
</span><span id="line-688"></span><span class="annot"><a href="Hydra.Model.html#checkOutcome"><span class="hs-identifier hs-var">checkOutcome</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="annot"><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-type">waitForUTxOToSpend</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679412718"><span class="annot"><a href="#local-6989586621679412718"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679412718"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679412718"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-694"></span><span>  </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-695"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-696"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier hs-type">TestHydraClient</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><a href="#local-6989586621679412718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-697"></span><span>  </span><span class="annot"><a href="#local-6989586621679412718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span id="waitForUTxOToSpend"><span class="annot"><span class="annottext">waitForUTxOToSpend :: UTxO
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
</span><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-var hs-var">waitForUTxOToSpend</span></a></span></span><span> </span><span id="local-6989586621679412012"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412012"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679412011"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412011"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679412010"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412010"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span id="local-6989586621679412009"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412009"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
</span><a href="#local-6989586621679412008"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-699"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-700"></span><span>  </span><span class="annot"><a href="#local-6989586621679412008"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679412718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>  </span><span id="local-6989586621679412008"><span class="annot"><span class="annottext">go :: Int -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
</span><a href="#local-6989586621679412008"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-702"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-703"></span><span>      </span><span class="annot"><span class="annottext">Either UTxO (TxIn, TxOut CtxUTxO)
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either UTxO (TxIn, TxOut CtxUTxO)
 -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO)))
-&gt; Either UTxO (TxIn, TxOut CtxUTxO)
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Either UTxO (TxIn, TxOut CtxUTxO)
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679412012"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-704"></span><span>    </span><span id="local-6989586621679412007"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679412007"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-705"></span><span>      </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412009"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; ClientInput Tx -&gt; m ()
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; ClientInput tx -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#%24sel%3Asend%3ATestHydraClient"><span class="hs-operator hs-var hs-var">`send`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.GetUTxO</span></span><span>
</span><span id="line-706"></span><span>      </span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">5</span></span><span>
</span><span id="line-707"></span><span>      </span><span class="annot"><span class="annottext">DiffTime -&gt; m (ServerOutput Tx) -&gt; m (Maybe (ServerOutput Tx))
forall (m :: * -&gt; *) a.
MonadTimer m =&gt;
DiffTime -&gt; m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">timeout</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">10</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; m (ServerOutput Tx)
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m (ServerOutput tx)
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AwaitForNext%3ATestHydraClient"><span class="hs-identifier hs-var hs-var">waitForNext</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679412009"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe (ServerOutput Tx))
-&gt; (Maybe (ServerOutput Tx)
    -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO)))
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-708"></span><span>        </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetUTxOResponse</span></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679412003"><span class="annot"><span class="annottext">UTxOType Tx
</span><a href="#local-6989586621679412003"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UTxOType Tx
UTxO
</span><a href="#local-6989586621679412003"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; UTxO -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-710"></span><span>              </span><span class="annot"><span class="annottext">m (Either UTxO (TxIn, TxOut CtxUTxO))
-&gt; ((TxIn, TxOut CtxUTxO) -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO)))
-&gt; Maybe (TxIn, TxOut CtxUTxO)
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span>
</span><span id="line-711"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
</span><a href="#local-6989586621679412008"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679412007"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either UTxO (TxIn, TxOut CtxUTxO)
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either UTxO (TxIn, TxOut CtxUTxO)
 -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO)))
-&gt; ((TxIn, TxOut CtxUTxO) -&gt; Either UTxO (TxIn, TxOut CtxUTxO))
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; Either UTxO (TxIn, TxOut CtxUTxO)
forall a b. b -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; Bool)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; Bool
</span><a href="#local-6989586621679412001"><span class="hs-identifier hs-var">matchPayment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO -&gt; [(TxIn, TxOut CtxUTxO)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">UTxO.pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxOType Tx
UTxO
</span><a href="#local-6989586621679412003"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ServerOutput Tx)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m (Either UTxO (TxIn, TxOut CtxUTxO))
</span><a href="#local-6989586621679412008"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679412007"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>  </span><span id="local-6989586621679412001"><span class="annot"><span class="annottext">matchPayment :: (TxIn, TxOut CtxUTxO) -&gt; Bool
</span><a href="#local-6989586621679412001"><span class="hs-identifier hs-var hs-var">matchPayment</span></a></span></span><span> </span><span id="local-6989586621679412000"><span class="annot"><span class="annottext">p :: (TxIn, TxOut CtxUTxO)
</span><a href="#local-6989586621679412000"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679411999"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679411999"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; (TxIn, TxOut CtxUTxO) -&gt; Bool
forall ctx. CardanoSigningKey -&gt; (TxIn, TxOut ctx) -&gt; Bool
</span><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-var">isOwned</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679412011"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO)
</span><a href="#local-6989586621679412000"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679412010"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679411999"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span id="local-6989586621679412574"><span class="annot"><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-type">isOwned</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621679412574"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-720"></span><span id="isOwned"><span class="annot"><span class="annottext">isOwned :: CardanoSigningKey -&gt; (TxIn, TxOut ctx) -&gt; Bool
</span><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-var hs-var">isOwned</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span id="local-6989586621679411996"><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679411996"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">txOutAddress :: forall ctx. TxOut ctx -&gt; AddressInEra
</span><span class="hs-identifier hs-var">txOutAddress</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShelleyAddressInEra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyAddress</span></span><span> </span><span class="annot"><span class="annottext">Network
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679411993"><span class="annot"><span class="annottext">PaymentCredential StandardCrypto
</span><a href="#local-6989586621679411993"><span class="hs-identifier hs-var">cre</span></a></span></span><span> </span><span class="annot"><span class="annottext">StakeReference StandardCrypto
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-721"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PaymentCredential StandardCrypto -&gt; PaymentCredential
</span><span class="hs-identifier hs-var">fromShelleyPaymentCredential</span></span><span> </span><span class="annot"><span class="annottext">PaymentCredential StandardCrypto
</span><a href="#local-6989586621679411993"><span class="hs-identifier hs-var">cre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-722"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PaymentCredentialByKey</span></span><span> </span><span id="local-6989586621679411991"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679411991"><span class="hs-identifier hs-var">ha</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
Key keyrole =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679411996"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; Hash PaymentKey -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679411991"><span class="hs-identifier hs-var">ha</span></a></span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><span class="annottext">PaymentCredential
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-724"></span><span class="annot"><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-var">isOwned</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut ctx)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-725"></span></pre></body></html>