<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | Smart constructors for creating Hydra protocol transactions to be used in</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- the 'Hydra.Chain.Direct' way of talking to the main-chain.</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- This module also encapsulates the transaction format used when talking to the</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- cardano-node, which is currently different from the 'Hydra.Ledger.Cardano',</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- thus we have not yet &quot;reached&quot; 'isomorphism'.</span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Chain.Direct.Tx</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Base16</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Base16</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api.Network</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">networkIdToNetwork</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.html"><span class="hs-identifier">Hydra.Chain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier">HeadId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier">HeadParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html"><span class="hs-identifier">Hydra.Chain.Direct.ScriptRegistry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier">ScriptRegistry</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html"><span class="hs-identifier">Hydra.Chain.Direct.TimeHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier">PointInTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html"><span class="hs-identifier">Hydra.ContestationPeriod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.ContestationPeriod.html#ContestationPeriod"><span class="hs-identifier">ContestationPeriod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html#fromChain"><span class="hs-identifier">fromChain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier">toChain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Commit</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Commit</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Head</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadState</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadTokens</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HeadTokens</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Initial</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Initial</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.MintAction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MintAction</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Burn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Mint</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Util</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hydraHeadV1</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Crypto.html"><span class="hs-identifier">Hydra.Crypto</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Crypto.html#MultiSignature"><span class="hs-identifier">MultiSignature</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Crypto.html#toPlutusSignatures"><span class="hs-identifier">toPlutusSignatures</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">addContestationPeriod</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">posixFromUTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.ContestationPeriod</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OnChain</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.Party</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OnChain</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Ledger.html"><span class="hs-identifier">Hydra.Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Ledger.html#IsTx"><span class="hs-identifier">IsTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Ledger.html#hashUTxO"><span class="hs-identifier">hashUTxO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Ledger.Cardano.html"><span class="hs-identifier">Hydra.Ledger.Cardano</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier">addReferenceInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html"><span class="hs-identifier">Hydra.Ledger.Cardano.Builder</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier">addExtraRequiredSigners</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier">addInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier">addOutputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#addVkInputs"><span class="hs-identifier">addVkInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#burnTokens"><span class="hs-identifier">burnTokens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier">emptyTxBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#mintTokens"><span class="hs-identifier">mintTokens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#setValidityLowerBound"><span class="hs-identifier">setValidityLowerBound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#setValidityUpperBound"><span class="hs-identifier">setValidityUpperBound</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier">unsafeBuildTransaction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Party.html"><span class="hs-identifier">Hydra.Party</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier">Party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Party.html#partyFromChain"><span class="hs-identifier">partyFromChain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Party.html#partyToChain"><span class="hs-identifier">partyToChain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html"><span class="hs-identifier">Hydra.Snapshot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier">Snapshot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier">SnapshotNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#fromChainSnapshot"><span class="hs-identifier">fromChainSnapshot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Orphans</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CurrencySymbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CurrencySymbol</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromBuiltin</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toBuiltin</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V2</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | Needed on-chain data to create Head transactions.</span><span>
</span><span id="line-58"></span><span class="hs-keyword">type</span><span> </span><span id="UTxOWithScript"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-var">UTxOWithScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span id="local-6989586621680000326"><span id="local-6989586621680000327"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="UTxOHash"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UTxOHash"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000321"><span id="local-6989586621680000323"><span class="annot"><span class="annottext">UTxOHash -&gt; UTxOHash -&gt; Bool
(UTxOHash -&gt; UTxOHash -&gt; Bool)
-&gt; (UTxOHash -&gt; UTxOHash -&gt; Bool) -&gt; Eq UTxOHash
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: UTxOHash -&gt; UTxOHash -&gt; Bool
$c/= :: UTxOHash -&gt; UTxOHash -&gt; Bool
== :: UTxOHash -&gt; UTxOHash -&gt; Bool
$c== :: UTxOHash -&gt; UTxOHash -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000314"><span id="local-6989586621680000316"><span id="local-6989586621680000318"><span class="annot"><span class="annottext">Int -&gt; UTxOHash -&gt; ShowS
[UTxOHash] -&gt; ShowS
UTxOHash -&gt; String
(Int -&gt; UTxOHash -&gt; ShowS)
-&gt; (UTxOHash -&gt; String) -&gt; ([UTxOHash] -&gt; ShowS) -&gt; Show UTxOHash
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [UTxOHash] -&gt; ShowS
$cshowList :: [UTxOHash] -&gt; ShowS
show :: UTxOHash -&gt; String
$cshow :: UTxOHash -&gt; String
showsPrec :: Int -&gt; UTxOHash -&gt; ShowS
$cshowsPrec :: Int -&gt; UTxOHash -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. UTxOHash -&gt; Rep UTxOHash x)
-&gt; (forall x. Rep UTxOHash x -&gt; UTxOHash) -&gt; Generic UTxOHash
forall x. Rep UTxOHash x -&gt; UTxOHash
forall x. UTxOHash -&gt; Rep UTxOHash x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep UTxOHash x -&gt; UTxOHash
$cfrom :: forall x. UTxOHash -&gt; Rep UTxOHash x
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680000303"><span id="local-6989586621680000305"><span id="local-6989586621680000307"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>  </span><span id="local-6989586621680000301"><span class="annot"><span class="annottext">toJSON :: UTxOHash -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span> </span><span id="local-6989586621680000299"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680000299"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">Aeson.String</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
forall a b. ConvertUtf8 a b =&gt; b -&gt; a
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Value) -&gt; ByteString -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">Base16.encode</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680000299"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680000292"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>  </span><span id="local-6989586621680000290"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser UTxOHash
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Text -&gt; Parser UTxOHash) -&gt; Value -&gt; Parser UTxOHash
forall a. String -&gt; (Text -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">Aeson.withText</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UTxOHash&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Text -&gt; Parser UTxOHash) -&gt; Value -&gt; Parser UTxOHash)
-&gt; (Text -&gt; Parser UTxOHash) -&gt; Value -&gt; Parser UTxOHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680000287"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680000287"><span class="hs-identifier hs-var">cborText</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String ByteString
</span><span class="hs-identifier hs-var">Base16.decode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String ByteString)
-&gt; ByteString -&gt; Either String ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
forall a b. ConvertUtf8 a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680000287"><span class="hs-identifier hs-var">cborText</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680000284"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680000284"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser UTxOHash
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680000284"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680000283"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680000283"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOHash -&gt; Parser UTxOHash
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxOHash -&gt; Parser UTxOHash) -&gt; UTxOHash -&gt; Parser UTxOHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680000283"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- | Representation of the Head output after an Init transaction.</span><span>
</span><span id="line-74"></span><span id="local-6989586621680000281"><span id="local-6989586621680000282"></span></span><span class="hs-keyword">data</span><span> </span><span id="InitialThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-var">InitialThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InitialThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-var">InitialThreadOutput</span></a></span></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-type">UTxOWithScript</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AinitialContestationPeriod%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialContestationPeriod%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnChain.ContestationPeriod</span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AinitialParties%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialParties%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000273"><span id="local-6989586621680000275"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
(InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool)
-&gt; (InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool)
-&gt; Eq InitialThreadOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
$c/= :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
== :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
$c== :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000267"><span id="local-6989586621680000269"><span id="local-6989586621680000271"><span class="annot"><span class="annottext">Int -&gt; InitialThreadOutput -&gt; ShowS
[InitialThreadOutput] -&gt; ShowS
InitialThreadOutput -&gt; String
(Int -&gt; InitialThreadOutput -&gt; ShowS)
-&gt; (InitialThreadOutput -&gt; String)
-&gt; ([InitialThreadOutput] -&gt; ShowS)
-&gt; Show InitialThreadOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [InitialThreadOutput] -&gt; ShowS
$cshowList :: [InitialThreadOutput] -&gt; ShowS
show :: InitialThreadOutput -&gt; String
$cshow :: InitialThreadOutput -&gt; String
showsPrec :: Int -&gt; InitialThreadOutput -&gt; ShowS
$cshowsPrec :: Int -&gt; InitialThreadOutput -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x)
-&gt; (forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput)
-&gt; Generic InitialThreadOutput
forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
$cfrom :: forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000257"><span id="local-6989586621680000259"><span id="local-6989586621680000261"><span id="local-6989586621680000263"><span class="annot"><span class="annottext">[InitialThreadOutput] -&gt; Value
[InitialThreadOutput] -&gt; Encoding
InitialThreadOutput -&gt; Value
InitialThreadOutput -&gt; Encoding
(InitialThreadOutput -&gt; Value)
-&gt; (InitialThreadOutput -&gt; Encoding)
-&gt; ([InitialThreadOutput] -&gt; Value)
-&gt; ([InitialThreadOutput] -&gt; Encoding)
-&gt; ToJSON InitialThreadOutput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [InitialThreadOutput] -&gt; Encoding
$ctoEncodingList :: [InitialThreadOutput] -&gt; Encoding
toJSONList :: [InitialThreadOutput] -&gt; Value
$ctoJSONList :: [InitialThreadOutput] -&gt; Value
toEncoding :: InitialThreadOutput -&gt; Encoding
$ctoEncoding :: InitialThreadOutput -&gt; Encoding
toJSON :: InitialThreadOutput -&gt; Value
$ctoJSON :: InitialThreadOutput -&gt; Value
</span><a href="#local-6989586621680000257"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000253"><span id="local-6989586621680000255"><span class="annot"><span class="annottext">Value -&gt; Parser [InitialThreadOutput]
Value -&gt; Parser InitialThreadOutput
(Value -&gt; Parser InitialThreadOutput)
-&gt; (Value -&gt; Parser [InitialThreadOutput])
-&gt; FromJSON InitialThreadOutput
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [InitialThreadOutput]
$cparseJSONList :: Value -&gt; Parser [InitialThreadOutput]
parseJSON :: Value -&gt; Parser InitialThreadOutput
$cparseJSON :: Value -&gt; Parser InitialThreadOutput
</span><a href="#local-6989586621680000253"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Representation of the Head output after a CollectCom transaction.</span><span>
</span><span id="line-82"></span><span id="local-6989586621680000251"><span id="local-6989586621680000252"></span></span><span class="hs-keyword">data</span><span> </span><span id="OpenThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-var">OpenThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OpenThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-var">OpenThreadOutput</span></a></span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-type">UTxOWithScript</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AopenContestationPeriod%3AOpenThreadOutput"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenContestationPeriod%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnChain.ContestationPeriod</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AopenParties%3AOpenThreadOutput"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenParties%3AOpenThreadOutput"><span class="hs-identifier hs-var hs-var">openParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000243"><span id="local-6989586621680000245"><span class="annot"><span class="annottext">OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
(OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool)
-&gt; (OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool)
-&gt; Eq OpenThreadOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
$c/= :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
== :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
$c== :: OpenThreadOutput -&gt; OpenThreadOutput -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000237"><span id="local-6989586621680000239"><span id="local-6989586621680000241"><span class="annot"><span class="annottext">Int -&gt; OpenThreadOutput -&gt; ShowS
[OpenThreadOutput] -&gt; ShowS
OpenThreadOutput -&gt; String
(Int -&gt; OpenThreadOutput -&gt; ShowS)
-&gt; (OpenThreadOutput -&gt; String)
-&gt; ([OpenThreadOutput] -&gt; ShowS)
-&gt; Show OpenThreadOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [OpenThreadOutput] -&gt; ShowS
$cshowList :: [OpenThreadOutput] -&gt; ShowS
show :: OpenThreadOutput -&gt; String
$cshow :: OpenThreadOutput -&gt; String
showsPrec :: Int -&gt; OpenThreadOutput -&gt; ShowS
$cshowsPrec :: Int -&gt; OpenThreadOutput -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. OpenThreadOutput -&gt; Rep OpenThreadOutput x)
-&gt; (forall x. Rep OpenThreadOutput x -&gt; OpenThreadOutput)
-&gt; Generic OpenThreadOutput
forall x. Rep OpenThreadOutput x -&gt; OpenThreadOutput
forall x. OpenThreadOutput -&gt; Rep OpenThreadOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep OpenThreadOutput x -&gt; OpenThreadOutput
$cfrom :: forall x. OpenThreadOutput -&gt; Rep OpenThreadOutput x
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000227"><span id="local-6989586621680000229"><span id="local-6989586621680000231"><span id="local-6989586621680000233"><span class="annot"><span class="annottext">[OpenThreadOutput] -&gt; Value
[OpenThreadOutput] -&gt; Encoding
OpenThreadOutput -&gt; Value
OpenThreadOutput -&gt; Encoding
(OpenThreadOutput -&gt; Value)
-&gt; (OpenThreadOutput -&gt; Encoding)
-&gt; ([OpenThreadOutput] -&gt; Value)
-&gt; ([OpenThreadOutput] -&gt; Encoding)
-&gt; ToJSON OpenThreadOutput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [OpenThreadOutput] -&gt; Encoding
$ctoEncodingList :: [OpenThreadOutput] -&gt; Encoding
toJSONList :: [OpenThreadOutput] -&gt; Value
$ctoJSONList :: [OpenThreadOutput] -&gt; Value
toEncoding :: OpenThreadOutput -&gt; Encoding
$ctoEncoding :: OpenThreadOutput -&gt; Encoding
toJSON :: OpenThreadOutput -&gt; Value
$ctoJSON :: OpenThreadOutput -&gt; Value
</span><a href="#local-6989586621680000227"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000223"><span id="local-6989586621680000225"><span class="annot"><span class="annottext">Value -&gt; Parser [OpenThreadOutput]
Value -&gt; Parser OpenThreadOutput
(Value -&gt; Parser OpenThreadOutput)
-&gt; (Value -&gt; Parser [OpenThreadOutput])
-&gt; FromJSON OpenThreadOutput
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [OpenThreadOutput]
$cparseJSONList :: Value -&gt; Parser [OpenThreadOutput]
parseJSON :: Value -&gt; Parser OpenThreadOutput
$cparseJSON :: Value -&gt; Parser OpenThreadOutput
</span><a href="#local-6989586621680000223"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621680000221"><span id="local-6989586621680000222"></span></span><span class="hs-keyword">data</span><span> </span><span id="ClosedThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-var">ClosedThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ClosedThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-var">ClosedThreadOutput</span></a></span></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-type">UTxOWithScript</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AclosedParties%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedParties%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AclosedContestationDeadline%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; POSIXTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContestationDeadline%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedContestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plutus.POSIXTime</span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AclosedContesters%3AClosedThreadOutput"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContesters%3AClosedThreadOutput"><span class="hs-identifier hs-var hs-var">closedContesters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.PubKeyHash</span></span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000212"><span id="local-6989586621680000214"><span class="annot"><span class="annottext">ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
(ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool)
-&gt; (ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool)
-&gt; Eq ClosedThreadOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
$c/= :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
== :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
$c== :: ClosedThreadOutput -&gt; ClosedThreadOutput -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000206"><span id="local-6989586621680000208"><span id="local-6989586621680000210"><span class="annot"><span class="annottext">Int -&gt; ClosedThreadOutput -&gt; ShowS
[ClosedThreadOutput] -&gt; ShowS
ClosedThreadOutput -&gt; String
(Int -&gt; ClosedThreadOutput -&gt; ShowS)
-&gt; (ClosedThreadOutput -&gt; String)
-&gt; ([ClosedThreadOutput] -&gt; ShowS)
-&gt; Show ClosedThreadOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ClosedThreadOutput] -&gt; ShowS
$cshowList :: [ClosedThreadOutput] -&gt; ShowS
show :: ClosedThreadOutput -&gt; String
$cshow :: ClosedThreadOutput -&gt; String
showsPrec :: Int -&gt; ClosedThreadOutput -&gt; ShowS
$cshowsPrec :: Int -&gt; ClosedThreadOutput -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ClosedThreadOutput -&gt; Rep ClosedThreadOutput x)
-&gt; (forall x. Rep ClosedThreadOutput x -&gt; ClosedThreadOutput)
-&gt; Generic ClosedThreadOutput
forall x. Rep ClosedThreadOutput x -&gt; ClosedThreadOutput
forall x. ClosedThreadOutput -&gt; Rep ClosedThreadOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ClosedThreadOutput x -&gt; ClosedThreadOutput
$cfrom :: forall x. ClosedThreadOutput -&gt; Rep ClosedThreadOutput x
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000196"><span id="local-6989586621680000198"><span id="local-6989586621680000200"><span id="local-6989586621680000202"><span class="annot"><span class="annottext">[ClosedThreadOutput] -&gt; Value
[ClosedThreadOutput] -&gt; Encoding
ClosedThreadOutput -&gt; Value
ClosedThreadOutput -&gt; Encoding
(ClosedThreadOutput -&gt; Value)
-&gt; (ClosedThreadOutput -&gt; Encoding)
-&gt; ([ClosedThreadOutput] -&gt; Value)
-&gt; ([ClosedThreadOutput] -&gt; Encoding)
-&gt; ToJSON ClosedThreadOutput
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [ClosedThreadOutput] -&gt; Encoding
$ctoEncodingList :: [ClosedThreadOutput] -&gt; Encoding
toJSONList :: [ClosedThreadOutput] -&gt; Value
$ctoJSONList :: [ClosedThreadOutput] -&gt; Value
toEncoding :: ClosedThreadOutput -&gt; Encoding
$ctoEncoding :: ClosedThreadOutput -&gt; Encoding
toJSON :: ClosedThreadOutput -&gt; Value
$ctoJSON :: ClosedThreadOutput -&gt; Value
</span><a href="#local-6989586621680000196"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000192"><span id="local-6989586621680000194"><span class="annot"><span class="annottext">Value -&gt; Parser [ClosedThreadOutput]
Value -&gt; Parser ClosedThreadOutput
(Value -&gt; Parser ClosedThreadOutput)
-&gt; (Value -&gt; Parser [ClosedThreadOutput])
-&gt; FromJSON ClosedThreadOutput
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [ClosedThreadOutput]
$cparseJSONList :: Value -&gt; Parser [ClosedThreadOutput]
parseJSON :: Value -&gt; Parser ClosedThreadOutput
$cparseJSON :: Value -&gt; Parser ClosedThreadOutput
</span><a href="#local-6989586621680000192"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-type">hydraHeadV1AssetName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span>
</span><span id="line-98"></span><span id="hydraHeadV1AssetName"><span class="annot"><span class="annottext">hydraHeadV1AssetName :: AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var hs-var">hydraHeadV1AssetName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; AssetName
</span><span class="hs-identifier hs-var">AssetName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ByteString
forall arep a. FromBuiltin arep a =&gt; arep -&gt; a
</span><span class="hs-identifier hs-var">fromBuiltin</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><span class="hs-identifier hs-var">hydraHeadV1</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- FIXME: sould not be hardcoded</span><span>
</span><span id="line-101"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headValue"><span class="hs-identifier hs-type">headValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-102"></span><span id="headValue"><span class="annot"><span class="annottext">headValue :: Value
</span><a href="Hydra.Chain.Direct.Tx.html#headValue"><span class="hs-identifier hs-var hs-var">headValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Value
</span><span class="hs-identifier hs-var">lovelaceToValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Lovelace
</span><span class="hs-identifier hs-var">Lovelace</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2_000_000</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- * Create Hydra Head transactions</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- | Create the init transaction from some 'HeadParameters' and a single TxIn</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- which will be used as unique parameter for minting NFTs.</span><span>
</span><span id="line-108"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#initTx"><span class="hs-identifier hs-type">initTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- | All participants cardano keys.</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-115"></span><span id="initTx"><span class="annot"><span class="annottext">initTx :: NetworkId
-&gt; [VerificationKey PaymentKey] -&gt; HeadParameters -&gt; TxIn -&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#initTx"><span class="hs-identifier hs-var hs-var">initTx</span></a></span></span><span> </span><span id="local-6989586621680000185"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000185"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680000184"><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621680000184"><span class="hs-identifier hs-var">cardanoKeys</span></a></span></span><span> </span><span id="local-6989586621680000183"><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621680000183"><span class="hs-identifier hs-var">parameters</span></a></span></span><span> </span><span id="local-6989586621680000182"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000182"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-118"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addVkInputs"><span class="hs-identifier hs-var">addVkInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000182"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; TxIn -&gt; HeadParameters -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutputInitial"><span class="hs-identifier hs-var">mkHeadOutputInitial</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000185"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000182"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621680000183"><span class="hs-identifier hs-var">parameters</span></a></span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; [TxOut CtxTx] -&gt; [TxOut CtxTx]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; TxOut CtxTx)
-&gt; [VerificationKey PaymentKey] -&gt; [TxOut CtxTx]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; TxIn -&gt; VerificationKey PaymentKey -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkInitialOutput"><span class="hs-identifier hs-var">mkInitialOutput</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000185"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000182"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621680000184"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
-&gt; MintAction
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
forall redeemer.
ToScriptData redeemer =&gt;
PlutusScript
-&gt; redeemer
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#mintTokens"><span class="hs-identifier hs-var">mintTokens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; PlutusScript
</span><span class="hs-identifier hs-var">HeadTokens.mkHeadTokenScript</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000182"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MintAction
</span><span class="hs-identifier hs-var">Mint</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AssetName, Quantity)
-&gt; [(AssetName, Quantity)] -&gt; [(AssetName, Quantity)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Quantity)]
</span><a href="#local-6989586621680000177"><span class="hs-identifier hs-var">participationTokens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621680000177"><span class="annot"><span class="annottext">participationTokens :: [(AssetName, Quantity)]
</span><a href="#local-6989586621680000177"><span class="hs-identifier hs-var hs-var">participationTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#assetNameFromVerificationKey"><span class="hs-identifier hs-var">assetNameFromVerificationKey</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680000175"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680000175"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680000175"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621680000184"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span id="local-6989586621680000551"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutput"><span class="hs-identifier hs-type">mkHeadOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutDatum</span></span><span> </span><span class="annot"><a href="#local-6989586621680000551"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680000551"><span class="hs-identifier hs-type">ctx</span></a></span></span><span>
</span><span id="line-129"></span><span id="mkHeadOutput"><span class="annot"><span class="annottext">mkHeadOutput :: NetworkId -&gt; PolicyId -&gt; TxOutDatum ctx -&gt; TxOut ctx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutput"><span class="hs-identifier hs-var hs-var">mkHeadOutput</span></a></span></span><span> </span><span id="local-6989586621680000173"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000173"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680000172"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680000172"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span></span><span> </span><span id="local-6989586621680000171"><span class="annot"><span class="annottext">TxOutDatum ctx
</span><a href="#local-6989586621680000171"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000173"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621680000168"><span class="hs-identifier hs-var">headScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="Hydra.Chain.Direct.Tx.html#headValue"><span class="hs-identifier hs-var">headValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680000172"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="annottext">TxOutDatum ctx
</span><a href="#local-6989586621680000171"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-135"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621680000168"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621680000168"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutputInitial"><span class="hs-identifier hs-type">mkHeadOutputInitial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxTx</span></span><span>
</span><span id="line-139"></span><span id="mkHeadOutputInitial"><span class="annot"><span class="annottext">mkHeadOutputInitial :: NetworkId -&gt; TxIn -&gt; HeadParameters -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutputInitial"><span class="hs-identifier hs-var hs-var">mkHeadOutputInitial</span></a></span></span><span> </span><span id="local-6989586621680000162"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000162"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680000161"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000161"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadParameters"><span class="hs-identifier hs-type">HeadParameters</span></a></span><span class="hs-special">{</span><span id="local-6989586621680000159"><span class="annot"><span class="annottext">ContestationPeriod
$sel:contestationPeriod:HeadParameters :: HeadParameters -&gt; ContestationPeriod
contestationPeriod :: ContestationPeriod
</span><a href="Hydra.Chain.html#%24sel%3AcontestationPeriod%3AHeadParameters"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000157"><span class="annot"><span class="annottext">[Party]
$sel:parties:HeadParameters :: HeadParameters -&gt; [Party]
parties :: [Party]
</span><a href="Hydra.Chain.html#%24sel%3Aparties%3AHeadParameters"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="annottext">NetworkId -&gt; PolicyId -&gt; TxOutDatum CtxTx -&gt; TxOut CtxTx
forall ctx. NetworkId -&gt; PolicyId -&gt; TxOutDatum ctx -&gt; TxOut ctx
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadOutput"><span class="hs-identifier hs-var">mkHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000162"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680000155"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680000154"><span class="hs-identifier hs-var">headDatum</span></a></span><span>
</span><span id="line-141"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>  </span><span id="local-6989586621680000155"><span class="annot"><span class="annottext">tokenPolicyId :: PolicyId
</span><a href="#local-6989586621680000155"><span class="hs-identifier hs-var hs-var">tokenPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; PolicyId
</span><span class="hs-identifier hs-var">HeadTokens.headPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000161"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621680000154"><span class="annot"><span class="annottext">headDatum :: TxOutDatum CtxTx
</span><a href="#local-6989586621680000154"><span class="hs-identifier hs-var hs-var">headDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span> </span><span class="annot"><span class="annottext">(State -&gt; TxOutDatum CtxTx) -&gt; State -&gt; TxOutDatum CtxTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">Initial :: ContestationPeriod
-&gt; [Party] -&gt; CurrencySymbol -&gt; TxOutRef -&gt; State
</span><span class="hs-identifier hs-type">Head.Initial</span></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier hs-var">toChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680000159"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Party) -&gt; [Party] -&gt; [Party]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Party
</span><a href="Hydra.Party.html#partyToChain"><span class="hs-identifier hs-var">partyToChain</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680000157"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">toPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680000155"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:seed:Initial :: TxOutRef
</span><span class="hs-identifier hs-var">seed</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">toPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000161"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkInitialOutput"><span class="hs-identifier hs-type">mkInitialOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxTx</span></span><span>
</span><span id="line-153"></span><span id="mkInitialOutput"><span class="annot"><span class="annottext">mkInitialOutput :: NetworkId -&gt; TxIn -&gt; VerificationKey PaymentKey -&gt; TxOut CtxTx
</span><a href="Hydra.Chain.Direct.Tx.html#mkInitialOutput"><span class="hs-identifier hs-var hs-var">mkInitialOutput</span></a></span></span><span> </span><span id="local-6989586621680000144"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000144"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680000143"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000143"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680000141"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621680000141"><span class="hs-identifier hs-var">pkh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum CtxTx -&gt; ReferenceScript -&gt; TxOut CtxTx
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680000140"><span class="hs-identifier hs-var">initialAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680000139"><span class="hs-identifier hs-var">initialValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680000138"><span class="hs-identifier hs-var">initialDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-155"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621680000137"><span class="annot"><span class="annottext">tokenPolicyId :: PolicyId
</span><a href="#local-6989586621680000137"><span class="hs-identifier hs-var hs-var">tokenPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; PolicyId
</span><span class="hs-identifier hs-var">HeadTokens.headPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000143"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621680000139"><span class="annot"><span class="annottext">initialValue :: Value
</span><a href="#local-6989586621680000139"><span class="hs-identifier hs-var hs-var">initialValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">Value
</span><a href="Hydra.Chain.Direct.Tx.html#headValue"><span class="hs-identifier hs-var">headValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680000137"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; AssetName
</span><span class="hs-identifier hs-var">AssetName</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; AssetName) -&gt; ByteString -&gt; AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialiseToRawBytes</span></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621680000141"><span class="hs-identifier hs-var">pkh</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621680000140"><span class="annot"><span class="annottext">initialAddress :: AddressInEra
</span><a href="#local-6989586621680000140"><span class="hs-identifier hs-var hs-var">initialAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000144"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621680000135"><span class="hs-identifier hs-var">initialScript</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621680000135"><span class="annot"><span class="annottext">initialScript :: PlutusScript lang
</span><a href="#local-6989586621680000135"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621680000138"><span class="annot"><span class="annottext">initialDatum :: TxOutDatum CtxTx
</span><a href="#local-6989586621680000138"><span class="hs-identifier hs-var hs-var">initialDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">Datum -&gt; TxOutDatum CtxTx
forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; TxOutDatum CtxTx) -&gt; Datum -&gt; TxOutDatum CtxTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Datum
</span><span class="hs-identifier hs-var">Initial.datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">toPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680000137"><span class="hs-identifier hs-var">tokenPolicyId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | Craft a commit transaction which includes the &quot;committed&quot; utxo as a datum.</span><span>
</span><span id="line-167"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#commitTx"><span class="hs-identifier hs-type">commitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-comment">-- | Published Hydra scripts to reference.</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-comment">-- | The UTxO to commit to the Head along with witnesses.</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Witness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WitCtxTxIn</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-comment">-- | The initial output (sent to each party) which should contain the PT and is</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-comment">-- locked by initial script</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-179"></span><span id="commitTx"><span class="annot"><span class="annottext">commitTx :: NetworkId
-&gt; ScriptRegistry
-&gt; HeadId
-&gt; Party
-&gt; UTxO' (TxOut CtxUTxO, Witness WitCtxTxIn)
-&gt; (TxIn, TxOut CtxUTxO, Hash PaymentKey)
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#commitTx"><span class="hs-identifier hs-var hs-var">commitTx</span></a></span></span><span> </span><span id="local-6989586621680000131"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000131"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680000130"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680000130"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680000129"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680000129"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span id="local-6989586621680000128"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680000128"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621680000127"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO, Witness WitCtxTxIn)
</span><a href="#local-6989586621680000127"><span class="hs-identifier hs-var">utxoToCommitWitnessed</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000126"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000126"><span class="hs-identifier hs-var">initialInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000125"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680000125"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000124"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621680000124"><span class="hs-identifier hs-var">vkh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000126"><span class="hs-identifier hs-var">initialInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000123"><span class="hs-identifier hs-var">initialWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000122"><span class="hs-identifier hs-var">initialScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx
</span><a href="#local-6989586621680000121"><span class="hs-identifier hs-var">committedTxIns</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621680000124"><span class="hs-identifier hs-var">vkh</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680000120"><span class="hs-identifier hs-var">commitOutput</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621680000123"><span class="annot"><span class="annottext">initialWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000123"><span class="hs-identifier hs-var hs-var">initialWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-190"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000122"><span class="hs-identifier hs-var">initialScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680000115"><span class="hs-identifier hs-var">initialScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000114"><span class="hs-identifier hs-var">initialDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000113"><span class="hs-identifier hs-var">initialRedeemer</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621680000115"><span class="annot"><span class="annottext">initialScript :: PlutusScript
</span><a href="#local-6989586621680000115"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621680000122"><span class="annot"><span class="annottext">initialScriptRef :: TxIn
</span><a href="#local-6989586621680000122"><span class="hs-identifier hs-var hs-var">initialScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#initialReference"><span class="hs-identifier hs-var hs-var">initialReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680000130"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621680000114"><span class="annot"><span class="annottext">initialDatum :: ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000114"><span class="hs-identifier hs-var hs-var">initialDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">Datum -&gt; ScriptDatum WitCtxTxIn
forall a. ToScriptData a =&gt; a -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">mkScriptDatum</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; ScriptDatum WitCtxTxIn)
-&gt; Datum -&gt; ScriptDatum WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Datum
</span><span class="hs-identifier hs-var">Initial.datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680000129"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>  </span><span id="local-6989586621680000113"><span class="annot"><span class="annottext">initialRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621680000113"><span class="hs-identifier hs-var hs-var">initialRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">(Redeemer -&gt; ScriptRedeemer)
-&gt; (RedeemerType -&gt; Redeemer) -&gt; RedeemerType -&gt; ScriptRedeemer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RedeemerType -&gt; Redeemer
</span><span class="hs-identifier hs-var">Initial.redeemer</span></span><span> </span><span class="annot"><span class="annottext">(RedeemerType -&gt; ScriptRedeemer) -&gt; RedeemerType -&gt; ScriptRedeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; RedeemerType
</span><span class="hs-identifier hs-var">Initial.ViaCommit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">toPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; TxOutRef)
-&gt; ((TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn)) -&gt; TxIn)
-&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; TxOutRef
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn)) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn)) -&gt; TxOutRef)
-&gt; TxIns BuildTx -&gt; [TxOutRef]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx
</span><a href="#local-6989586621680000121"><span class="hs-identifier hs-var">committedTxIns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621680000121"><span class="annot"><span class="annottext">committedTxIns :: TxIns BuildTx
</span><a href="#local-6989586621680000121"><span class="hs-identifier hs-var hs-var">committedTxIns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">((TxIn, (TxOut CtxUTxO, Witness WitCtxTxIn))
 -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn)))
-&gt; [(TxIn, (TxOut CtxUTxO, Witness WitCtxTxIn))] -&gt; TxIns BuildTx
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680000105"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000105"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000104"><span class="annot"><span class="annottext">Witness WitCtxTxIn
</span><a href="#local-6989586621680000104"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000105"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn
</span><a href="#local-6989586621680000104"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(TxIn, (TxOut CtxUTxO, Witness WitCtxTxIn))] -&gt; TxIns BuildTx)
-&gt; [(TxIn, (TxOut CtxUTxO, Witness WitCtxTxIn))] -&gt; TxIns BuildTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO, Witness WitCtxTxIn)
-&gt; [(TxIn, (TxOut CtxUTxO, Witness WitCtxTxIn))]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">UTxO.pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO, Witness WitCtxTxIn)
</span><a href="#local-6989586621680000127"><span class="hs-identifier hs-var">utxoToCommitWitnessed</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>  </span><span id="local-6989586621680000120"><span class="annot"><span class="annottext">commitOutput :: TxOut CtxTx
</span><a href="#local-6989586621680000120"><span class="hs-identifier hs-var hs-var">commitOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum CtxTx -&gt; ReferenceScript -&gt; TxOut CtxTx
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680000102"><span class="hs-identifier hs-var">commitAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680000101"><span class="hs-identifier hs-var">commitValue</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680000100"><span class="hs-identifier hs-var">commitDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621680000099"><span class="annot"><span class="annottext">commitScript :: PlutusScript lang
</span><a href="#local-6989586621680000099"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621680000102"><span class="annot"><span class="annottext">commitAddress :: AddressInEra
</span><a href="#local-6989586621680000102"><span class="hs-identifier hs-var hs-var">commitAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000131"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621680000099"><span class="hs-identifier hs-var">commitScript</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621680000101"><span class="annot"><span class="annottext">commitValue :: Value
</span><a href="#local-6989586621680000101"><span class="hs-identifier hs-var hs-var">commitValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680000125"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value) -&gt; UTxO' (TxOut CtxUTxO) -&gt; Value
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680000095"><span class="hs-identifier hs-var">utxoToCommit</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621680000100"><span class="annot"><span class="annottext">commitDatum :: TxOutDatum CtxTx
</span><a href="#local-6989586621680000100"><span class="hs-identifier hs-var hs-var">commitDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="annottext">Datum -&gt; TxOutDatum CtxTx
forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; TxOutDatum CtxTx) -&gt; Datum -&gt; TxOutDatum CtxTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; UTxO' (TxOut CtxUTxO) -&gt; CurrencySymbol -&gt; Datum
</span><a href="Hydra.Chain.Direct.Tx.html#mkCommitDatum"><span class="hs-identifier hs-var">mkCommitDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680000128"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680000095"><span class="hs-identifier hs-var">utxoToCommit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680000129"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621680000095"><span class="annot"><span class="annottext">utxoToCommit :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680000095"><span class="hs-identifier hs-var hs-var">utxoToCommit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO, Witness WitCtxTxIn) -&gt; TxOut CtxUTxO
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut CtxUTxO, Witness WitCtxTxIn) -&gt; TxOut CtxUTxO)
-&gt; UTxO' (TxOut CtxUTxO, Witness WitCtxTxIn)
-&gt; UTxO' (TxOut CtxUTxO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO, Witness WitCtxTxIn)
</span><a href="#local-6989586621680000127"><span class="hs-identifier hs-var">utxoToCommitWitnessed</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkCommitDatum"><span class="hs-identifier hs-type">mkCommitDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CurrencySymbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plutus.Datum</span></span><span>
</span><span id="line-227"></span><span id="mkCommitDatum"><span class="annot"><span class="annottext">mkCommitDatum :: Party -&gt; UTxO' (TxOut CtxUTxO) -&gt; CurrencySymbol -&gt; Datum
</span><a href="Hydra.Chain.Direct.Tx.html#mkCommitDatum"><span class="hs-identifier hs-var hs-var">mkCommitDatum</span></a></span></span><span> </span><span id="local-6989586621680000092"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680000092"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621680000091"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680000091"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680000090"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680000090"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><span class="annottext">DatumType -&gt; Datum
</span><span class="hs-identifier hs-var">Commit.datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party -&gt; Party
</span><a href="Hydra.Party.html#partyToChain"><span class="hs-identifier hs-var">partyToChain</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680000092"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680000088"><span class="hs-identifier hs-var">commits</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680000090"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621680000088"><span class="annot"><span class="annottext">commits :: [Commit]
</span><a href="#local-6989586621680000088"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; Maybe Commit)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [Commit]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; Maybe Commit
</span><span class="hs-identifier hs-var">Commit.serializeCommit</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO)] -&gt; [Commit])
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [Commit]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; [(TxIn, TxOut CtxUTxO)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">UTxO.pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621680000091"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-comment">-- | Create a transaction collecting all &quot;committed&quot; utxo and opening a Head,</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- i.e. driving the Head script state.</span><span>
</span><span id="line-235"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#collectComTx"><span class="hs-identifier hs-type">collectComTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-comment">-- | Published Hydra scripts to reference.</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">-- | Party who's authorizing this transaction</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-type">InitialThreadOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-comment">-- | Data needed to spend the commit output produced by each party.</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-comment">-- Should contain the PT and is locked by @&#957;_commit@ script.</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-comment">-- | Head id</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-249"></span><span id="collectComTx"><span class="annot"><span class="annottext">collectComTx :: NetworkId
-&gt; ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; InitialThreadOutput
-&gt; Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; HeadId
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#collectComTx"><span class="hs-identifier hs-var hs-var">collectComTx</span></a></span></span><span> </span><span id="local-6989586621680000084"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000084"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680000083"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680000083"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680000082"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680000082"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span id="local-6989586621680000081"><span class="annot"><span class="annottext">InitialThreadOutput
</span><a href="#local-6989586621680000081"><span class="hs-identifier hs-var">initialThreadOutput</span></a></span></span><span> </span><span id="local-6989586621680000080"><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621680000080"><span class="hs-identifier hs-var">commits</span></a></span></span><span> </span><span id="local-6989586621680000079"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680000079"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000078"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000077"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; TxIns BuildTx -&gt; TxIns BuildTx
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
</span><a href="#local-6989586621680000076"><span class="hs-identifier hs-var">mkCommit</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, (TxOut CtxUTxO, ScriptRedeemer))
 -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn)))
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))] -&gt; TxIns BuildTx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621680000080"><span class="hs-identifier hs-var">commits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000074"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000073"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-254"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680000072"><span class="hs-identifier hs-var">headOutput</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680000082"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-256"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-type">InitialThreadOutput</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:initialThreadUTxO:InitialThreadOutput :: InitialThreadOutput -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="hs-identifier hs-var">initialThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680000078"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000078"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000071"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680000071"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680000069"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000069"><span class="hs-identifier hs-var">headDatumBefore</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000068"><span class="annot"><span class="annottext">[Party]
initialParties :: [Party]
$sel:initialParties:InitialThreadOutput :: InitialThreadOutput -&gt; [Party]
</span><a href="#local-6989586621680000068"><span class="hs-identifier hs-var hs-var">initialParties</span></a></span></span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000067"><span class="annot"><span class="annottext">ContestationPeriod
initialContestationPeriod :: ContestationPeriod
$sel:initialContestationPeriod:InitialThreadOutput :: InitialThreadOutput -&gt; ContestationPeriod
</span><a href="#local-6989586621680000067"><span class="hs-identifier hs-var hs-var">initialContestationPeriod</span></a></span></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InitialThreadOutput
</span><a href="#local-6989586621680000081"><span class="hs-identifier hs-var">initialThreadOutput</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621680000077"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000077"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-266"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000073"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680000066"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000069"><span class="hs-identifier hs-var">headDatumBefore</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000065"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span id="local-6989586621680000066"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680000066"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-268"></span><span>  </span><span id="local-6989586621680000073"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621680000073"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#headReference"><span class="hs-identifier hs-var hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680000083"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621680000065"><span class="annot"><span class="annottext">headRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621680000065"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.CollectCom</span></span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621680000072"><span class="annot"><span class="annottext">headOutput :: TxOut CtxTx
</span><a href="#local-6989586621680000072"><span class="hs-identifier hs-var hs-var">headOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value -&gt; TxOutDatum CtxTx -&gt; ReferenceScript -&gt; TxOut CtxTx
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680000084"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680000066"><span class="hs-identifier hs-var">headScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680000071"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680000062"><span class="hs-identifier hs-var">commitValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>      </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680000061"><span class="hs-identifier hs-var">headDatumAfter</span></a></span><span>
</span><span id="line-275"></span><span>      </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-276"></span><span>  </span><span id="local-6989586621680000061"><span class="annot"><span class="annottext">headDatumAfter :: TxOutDatum CtxTx
</span><a href="#local-6989586621680000061"><span class="hs-identifier hs-var hs-var">headDatumAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span>
</span><span id="line-278"></span><span>      </span><span class="annot"><span class="annottext">Open :: ContestationPeriod
-&gt; [Party] -&gt; BuiltinByteString -&gt; CurrencySymbol -&gt; State
</span><span class="hs-identifier hs-type">Head.Open</span></span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">Head.parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680000068"><span class="hs-identifier hs-var">initialParties</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
$sel:utxoHash:Initial :: BuiltinByteString
utxoHash :: BuiltinByteString
</span><span class="hs-identifier hs-var hs-var">utxoHash</span></span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680000067"><span class="hs-identifier hs-var">initialContestationPeriod</span></a></span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680000079"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-283"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621680000057"><span class="annot"><span class="annottext">extractCommits :: ScriptRedeemer -&gt; [Commit]
</span><a href="#local-6989586621680000057"><span class="hs-identifier hs-var hs-var">extractCommits</span></a></span></span><span> </span><span id="local-6989586621680000056"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000056"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe DatumType
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000056"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="annottext">Maybe DatumType
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Commit]
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SNAFU&quot;</span></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000053"><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680000053"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Commit.DatumType</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680000053"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>  </span><span id="local-6989586621680000059"><span class="annot"><span class="annottext">utxoHash :: BuiltinByteString
</span><a href="#local-6989586621680000059"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><span class="annottext">[Commit] -&gt; BuiltinByteString
</span><span class="hs-identifier hs-var">Head.hashPreSerializedCommits</span></span><span> </span><span class="annot"><span class="annottext">([Commit] -&gt; BuiltinByteString) -&gt; [Commit] -&gt; BuiltinByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, (TxOut CtxUTxO, ScriptRedeemer)) -&gt; [Commit])
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))] -&gt; [Commit]
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; [Commit]
</span><a href="#local-6989586621680000057"><span class="hs-identifier hs-var">extractCommits</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptRedeemer -&gt; [Commit])
-&gt; ((TxIn, (TxOut CtxUTxO, ScriptRedeemer)) -&gt; ScriptRedeemer)
-&gt; (TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; [Commit]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO, ScriptRedeemer) -&gt; ScriptRedeemer
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut CtxUTxO, ScriptRedeemer) -&gt; ScriptRedeemer)
-&gt; ((TxIn, (TxOut CtxUTxO, ScriptRedeemer))
    -&gt; (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; ScriptRedeemer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxOut CtxUTxO, ScriptRedeemer)
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(TxIn, (TxOut CtxUTxO, ScriptRedeemer))] -&gt; [Commit])
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))] -&gt; [Commit]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621680000080"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621680000076"><span class="annot"><span class="annottext">mkCommit :: (TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
</span><a href="#local-6989586621680000076"><span class="hs-identifier hs-var hs-var">mkCommit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000051"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000051"><span class="hs-identifier hs-var">commitInput</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000050"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680000050"><span class="hs-identifier hs-var">_commitOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000049"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000049"><span class="hs-identifier hs-var">commitDatum</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000051"><span class="hs-identifier hs-var">commitInput</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000048"><span class="hs-identifier hs-var">mkCommitWitness</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000049"><span class="hs-identifier hs-var">commitDatum</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621680000048"><span class="annot"><span class="annottext">mkCommitWitness :: ScriptRedeemer -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000048"><span class="hs-identifier hs-var hs-var">mkCommitWitness</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680000047"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000047"><span class="hs-identifier hs-var">commitDatum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000074"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680000046"><span class="hs-identifier hs-var">commitScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000047"><span class="hs-identifier hs-var">commitDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000045"><span class="hs-identifier hs-var">commitRedeemer</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621680000074"><span class="annot"><span class="annottext">commitScriptRef :: TxIn
</span><a href="#local-6989586621680000074"><span class="hs-identifier hs-var hs-var">commitScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#commitReference"><span class="hs-identifier hs-var hs-var">commitReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680000083"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621680000062"><span class="annot"><span class="annottext">commitValue :: Value
</span><a href="#local-6989586621680000062"><span class="hs-identifier hs-var hs-var">commitValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; Value) -&gt; [Value] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value)
-&gt; ((TxOut CtxUTxO, ScriptRedeemer) -&gt; TxOut CtxUTxO)
-&gt; (TxOut CtxUTxO, ScriptRedeemer)
-&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO, ScriptRedeemer) -&gt; TxOut CtxUTxO
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut CtxUTxO, ScriptRedeemer) -&gt; Value)
-&gt; [(TxOut CtxUTxO, ScriptRedeemer)] -&gt; [Value]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; [(TxOut CtxUTxO, ScriptRedeemer)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621680000080"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-305"></span><span>  </span><span id="local-6989586621680000046"><span class="annot"><span class="annottext">commitScript :: PlutusScript
</span><a href="#local-6989586621680000046"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621680000045"><span class="annot"><span class="annottext">commitRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621680000045"><span class="hs-identifier hs-var hs-var">commitRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">(Redeemer -&gt; ScriptRedeemer) -&gt; Redeemer -&gt; ScriptRedeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RedeemerType -&gt; Redeemer
</span><span class="hs-identifier hs-var">Commit.redeemer</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType
</span><span class="hs-identifier hs-var">Commit.ViaCollectCom</span></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">-- | Low-level data type of a snapshot to close the head with. This is different</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- to the 'ConfirmedSnasphot', which is provided to `CloseTx` as it also</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- contains relevant chain state like the 'openUtxoHash'.</span><span>
</span><span id="line-313"></span><span class="hs-keyword">data</span><span> </span><span id="ClosingSnapshot"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosingSnapshot"><span class="hs-identifier hs-var">ClosingSnapshot</span></a></span></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CloseWithInitialSnapshot"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-var">CloseWithInitialSnapshot</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AopenUtxoHash%3ACloseWithInitialSnapshot"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenUtxoHash%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">openUtxoHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CloseWithConfirmedSnapshot"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-var">CloseWithConfirmedSnapshot</span></a></span></span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AsnapshotNumber%3ACloseWithInitialSnapshot"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier hs-type">SnapshotNumber</span></a></span><span>
</span><span id="line-317"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcloseUtxoHash%3ACloseWithInitialSnapshot"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcloseUtxoHash%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">closeUtxoHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- XXX: This is a bit of a wart and stems from the fact that our</span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-comment">-- SignableRepresentation of 'Snapshot' is in fact the snapshotNumber</span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-comment">-- and the closeUtxoHash as also included above</span><span>
</span><span id="line-321"></span><span>        </span><span id="%24sel%3Asignatures%3ACloseWithInitialSnapshot"><span class="annot"><span class="annottext">ClosingSnapshot -&gt; MultiSignature (Snapshot Tx)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Asignatures%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">signatures</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Crypto.html#MultiSignature"><span class="hs-identifier hs-type">MultiSignature</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-comment">-- | Create a transaction closing a head with either the initial snapshot or</span><span>
</span><span id="line-325"></span><span class="hs-comment">-- with a multi-signed confirmed snapshot.</span><span>
</span><span id="line-326"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#closeTx"><span class="hs-identifier hs-type">closeTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-comment">-- | Published Hydra scripts to reference.</span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-comment">-- | Party who's authorizing this transaction</span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-comment">-- | The snapshot to close with, can be either initial or confirmed one.</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosingSnapshot"><span class="hs-identifier hs-type">ClosingSnapshot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-comment">-- | Lower validity slot number, usually a current or quite recent slot number.</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-comment">-- | Upper validity slot and UTC time to compute the contestation deadline time.</span><span>
</span><span id="line-336"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier hs-type">PointInTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-comment">-- | Head identifier</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-342"></span><span id="closeTx"><span class="annot"><span class="annottext">closeTx :: ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; ClosingSnapshot
-&gt; SlotNo
-&gt; PointInTime
-&gt; OpenThreadOutput
-&gt; HeadId
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#closeTx"><span class="hs-identifier hs-var hs-var">closeTx</span></a></span></span><span> </span><span id="local-6989586621680000033"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680000033"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621680000032"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680000032"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span id="local-6989586621680000031"><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680000031"><span class="hs-identifier hs-var">closing</span></a></span></span><span> </span><span id="local-6989586621680000030"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680000030"><span class="hs-identifier hs-var">startSlotNo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000029"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680000029"><span class="hs-identifier hs-var">endSlotNo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000028"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680000028"><span class="hs-identifier hs-var">utcTime</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680000027"><span class="annot"><span class="annottext">OpenThreadOutput
</span><a href="#local-6989586621680000027"><span class="hs-identifier hs-var">openThreadOutput</span></a></span></span><span> </span><span id="local-6989586621680000026"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680000026"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-343"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000025"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000024"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000023"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-347"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621680000022"><span class="hs-identifier hs-var">headOutputAfter</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621680000032"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityLowerBound"><span class="hs-identifier hs-var">setValidityLowerBound</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680000030"><span class="hs-identifier hs-var">startSlotNo</span></a></span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityUpperBound"><span class="hs-identifier hs-var">setValidityUpperBound</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680000029"><span class="hs-identifier hs-var">endSlotNo</span></a></span><span>
</span><span id="line-351"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:openThreadUTxO:OpenThreadOutput :: OpenThreadOutput -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="hs-identifier hs-var">openThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680000025"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000025"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000021"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680000021"><span class="hs-identifier hs-var">headOutputBefore</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680000020"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000020"><span class="hs-identifier hs-var">headDatumBefore</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000019"><span class="annot"><span class="annottext">ContestationPeriod
openContestationPeriod :: ContestationPeriod
$sel:openContestationPeriod:OpenThreadOutput :: OpenThreadOutput -&gt; ContestationPeriod
</span><a href="#local-6989586621680000019"><span class="hs-identifier hs-var hs-var">openContestationPeriod</span></a></span></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680000018"><span class="annot"><span class="annottext">[Party]
openParties :: [Party]
$sel:openParties:OpenThreadOutput :: OpenThreadOutput -&gt; [Party]
</span><a href="#local-6989586621680000018"><span class="hs-identifier hs-var hs-var">openParties</span></a></span></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OpenThreadOutput
</span><a href="#local-6989586621680000027"><span class="hs-identifier hs-var">openThreadOutput</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>  </span><span id="local-6989586621680000024"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621680000024"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680000023"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621680000017"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621680000020"><span class="hs-identifier hs-var">headDatumBefore</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621680000016"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>  </span><span id="local-6989586621680000023"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621680000023"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#headReference"><span class="hs-identifier hs-var hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621680000033"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>  </span><span id="local-6989586621680000017"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621680000017"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>  </span><span id="local-6989586621680000016"><span class="annot"><span class="annottext">headRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621680000016"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="annottext">Input -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span>
</span><span id="line-371"></span><span>      </span><span class="annot"><span class="annottext">Close :: [BuiltinByteString] -&gt; Input
</span><span class="hs-identifier hs-type">Head.Close</span></span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[BuiltinByteString]
$sel:signature:CollectCom :: [BuiltinByteString]
signature :: [BuiltinByteString]
</span><span class="hs-keyword hs-var hs-var">signature</span></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>  </span><span id="local-6989586621680000022"><span class="annot"><span class="annottext">headOutputAfter :: TxOut CtxTx
</span><a href="#local-6989586621680000022"><span class="hs-identifier hs-var hs-var">headOutputAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="annottext">(TxOutDatum CtxUTxO Era -&gt; TxOutDatum CtxTx)
-&gt; TxOut CtxUTxO -&gt; TxOut CtxTx
forall ctx0 era ctx1.
(TxOutDatum ctx0 era -&gt; TxOutDatum ctx1 era)
-&gt; TxOut ctx0 era -&gt; TxOut ctx1 era
</span><span class="hs-identifier hs-var">modifyTxOutDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutDatum CtxTx -&gt; TxOutDatum CtxUTxO Era -&gt; TxOutDatum CtxTx
forall a b. a -&gt; b -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621680000010"><span class="hs-identifier hs-var">headDatumAfter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680000021"><span class="hs-identifier hs-var">headOutputBefore</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621680000010"><span class="annot"><span class="annottext">headDatumAfter :: TxOutDatum CtxTx
</span><a href="#local-6989586621680000010"><span class="hs-identifier hs-var hs-var">headDatumAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">Closed :: [Party]
-&gt; Integer
-&gt; BuiltinByteString
-&gt; POSIXTime
-&gt; ContestationPeriod
-&gt; CurrencySymbol
-&gt; [PubKeyHash]
-&gt; State
</span><span class="hs-identifier hs-type">Head.Closed</span></span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Integer
$sel:snapshotNumber:Initial :: Integer
snapshotNumber :: Integer
</span><span class="hs-identifier hs-var hs-var">snapshotNumber</span></span><span>
</span><span id="line-382"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoHash:Initial :: BuiltinByteString
</span><span class="hs-identifier hs-var">utxoHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BuiltinByteString
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680000006"><span class="hs-identifier hs-var">utxoHashBytes</span></a></span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680000018"><span class="hs-identifier hs-var">openParties</span></a></span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTime
$sel:contestationDeadline:Initial :: POSIXTime
contestationDeadline :: POSIXTime
</span><span class="hs-identifier hs-var hs-var">contestationDeadline</span></span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680000019"><span class="hs-identifier hs-var">openContestationPeriod</span></a></span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680000026"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contesters:Initial :: [PubKeyHash]
</span><span class="hs-identifier hs-var">contesters</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>  </span><span id="local-6989586621680000008"><span class="annot"><span class="annottext">snapshotNumber :: Integer
</span><a href="#local-6989586621680000008"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(SnapshotNumber -&gt; Integer) -&gt; SnapshotNumber -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680000031"><span class="hs-identifier hs-var">closing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><span class="hs-number">0</span></span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-type">CloseWithConfirmedSnapshot</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:snapshotNumber:CloseWithInitialSnapshot :: ClosingSnapshot -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680000002"><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621680000002"><span class="hs-identifier hs-var">sn</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621680000002"><span class="hs-identifier hs-var">sn</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span> </span><span id="local-6989586621680000006"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680000006"><span class="hs-identifier hs-var">utxoHashBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680000031"><span class="hs-identifier hs-var">closing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-395"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span class="hs-special">{</span><span id="local-6989586621680000001"><span class="annot"><span class="annottext">UTxOHash
openUtxoHash :: UTxOHash
$sel:openUtxoHash:CloseWithInitialSnapshot :: ClosingSnapshot -&gt; UTxOHash
</span><a href="#local-6989586621680000001"><span class="hs-identifier hs-var hs-var">openUtxoHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOHash
</span><a href="#local-6989586621680000001"><span class="hs-identifier hs-var">openUtxoHash</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-type">CloseWithConfirmedSnapshot</span></a></span><span class="hs-special">{</span><span id="local-6989586621680000000"><span class="annot"><span class="annottext">UTxOHash
closeUtxoHash :: UTxOHash
$sel:closeUtxoHash:CloseWithInitialSnapshot :: ClosingSnapshot -&gt; UTxOHash
</span><a href="#local-6989586621680000000"><span class="hs-identifier hs-var hs-var">closeUtxoHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOHash
</span><a href="#local-6989586621680000000"><span class="hs-identifier hs-var">closeUtxoHash</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621680000014"><span class="annot"><span class="annottext">signature :: [BuiltinByteString]
</span><a href="#local-6989586621680000014"><span class="hs-keyword hs-var hs-var">signature</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ClosingSnapshot
</span><a href="#local-6989586621680000031"><span class="hs-identifier hs-var">closing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[BuiltinByteString]
forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseWithConfirmedSnapshot"><span class="hs-identifier hs-type">CloseWithConfirmedSnapshot</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:signatures:CloseWithInitialSnapshot :: ClosingSnapshot -&gt; MultiSignature (Snapshot Tx)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Asignatures%3ACloseWithInitialSnapshot"><span class="hs-identifier hs-var">signatures</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679999999"><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621679999999"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx) -&gt; [BuiltinByteString]
forall a. MultiSignature a -&gt; [BuiltinByteString]
</span><a href="Hydra.Crypto.html#toPlutusSignatures"><span class="hs-identifier hs-var">toPlutusSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621679999999"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621680000005"><span class="annot"><span class="annottext">contestationDeadline :: POSIXTime
</span><a href="#local-6989586621680000005"><span class="hs-identifier hs-var hs-var">contestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-403"></span><span>    </span><span class="annot"><span class="annottext">POSIXTime -&gt; ContestationPeriod -&gt; POSIXTime
</span><span class="hs-identifier hs-var">addContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; POSIXTime
</span><span class="hs-identifier hs-var">posixFromUTCTime</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680000028"><span class="hs-identifier hs-var">utcTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680000019"><span class="hs-identifier hs-var">openContestationPeriod</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="hs-comment">-- XXX: This function is VERY similar to the 'closeTx' function (only notable</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- difference being the redeemer, which is in itself also the same structure as</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- the close's one. We could potentially refactor this to avoid repetition or do</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- something more principled at the protocol level itself and &quot;merge&quot; close and</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- contest as one operation.</span><span>
</span><span id="line-410"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#contestTx"><span class="hs-identifier hs-type">contestTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-comment">-- | Published Hydra scripts to reference.</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-comment">-- | Party who's authorizing this transaction</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-comment">-- | Contested snapshot number (i.e. the one we contest to)</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-comment">-- | Multi-signature of the whole snapshot</span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><a href="Hydra.Crypto.html#MultiSignature"><span class="hs-identifier hs-type">MultiSignature</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-comment">-- | Current slot and posix time to be used as the contestation time.</span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier hs-type">PointInTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-423"></span><span>  </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><a href="Hydra.ContestationPeriod.html#ContestationPeriod"><span class="hs-identifier hs-type">ContestationPeriod</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-425"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-426"></span><span id="contestTx"><span class="annot"><span class="annottext">contestTx :: ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; Snapshot Tx
-&gt; MultiSignature (Snapshot Tx)
-&gt; PointInTime
-&gt; ClosedThreadOutput
-&gt; HeadId
-&gt; ContestationPeriod
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#contestTx"><span class="hs-identifier hs-var hs-var">contestTx</span></a></span></span><span>
</span><span id="line-427"></span><span>  </span><span id="local-6989586621679999997"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999997"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span>
</span><span id="line-428"></span><span>  </span><span id="local-6989586621679999996"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679999996"><span class="hs-identifier hs-var">vk</span></a></span></span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><a href="Hydra.Snapshot.html#Snapshot"><span class="hs-identifier hs-type">Snapshot</span></a></span><span class="hs-special">{</span><span id="local-6989586621679999994"><span class="annot"><span class="annottext">SnapshotNumber
number :: forall tx. Snapshot tx -&gt; SnapshotNumber
number :: SnapshotNumber
</span><a href="Hydra.Snapshot.html#number"><span class="hs-identifier hs-var hs-var">number</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999992"><span class="annot"><span class="annottext">UTxOType Tx
utxo :: forall tx. Snapshot tx -&gt; UTxOType tx
utxo :: UTxOType Tx
</span><a href="Hydra.Snapshot.html#utxo"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>  </span><span id="local-6989586621679999990"><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621679999990"><span class="hs-identifier hs-var">sig</span></a></span></span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999989"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679999989"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:closedThreadUTxO:ClosedThreadOutput :: ClosedThreadOutput -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999988"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999988"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999987"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999987"><span class="hs-identifier hs-var">headOutputBefore</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679999986"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999986"><span class="hs-identifier hs-var">headDatumBefore</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999985"><span class="annot"><span class="annottext">[Party]
closedParties :: [Party]
$sel:closedParties:ClosedThreadOutput :: ClosedThreadOutput -&gt; [Party]
</span><a href="#local-6989586621679999985"><span class="hs-identifier hs-var hs-var">closedParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999984"><span class="annot"><span class="annottext">POSIXTime
closedContestationDeadline :: POSIXTime
$sel:closedContestationDeadline:ClosedThreadOutput :: ClosedThreadOutput -&gt; POSIXTime
</span><a href="#local-6989586621679999984"><span class="hs-identifier hs-var hs-var">closedContestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999983"><span class="annot"><span class="annottext">[PubKeyHash]
closedContesters :: [PubKeyHash]
$sel:closedContesters:ClosedThreadOutput :: ClosedThreadOutput -&gt; [PubKeyHash]
</span><a href="#local-6989586621679999983"><span class="hs-identifier hs-var hs-var">closedContesters</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-433"></span><span>  </span><span id="local-6989586621679999982"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621679999982"><span class="hs-identifier hs-var">headId</span></a></span></span><span>
</span><span id="line-434"></span><span>  </span><span id="local-6989586621679999981"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999981"><span class="hs-identifier hs-var">contestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-436"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999988"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999980"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999979"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-439"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999978"><span class="hs-identifier hs-var">headOutputAfter</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-440"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679999996"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span>        </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityUpperBound"><span class="hs-identifier hs-var">setValidityUpperBound</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679999989"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-442"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-443"></span><span>    </span><span id="local-6989586621679999980"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999980"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-446"></span><span>          </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999979"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999977"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999986"><span class="hs-identifier hs-var">headDatumBefore</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999976"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621679999979"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621679999979"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#headReference"><span class="hs-identifier hs-var hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999997"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621679999977"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621679999977"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-451"></span><span>    </span><span id="local-6989586621679999976"><span class="annot"><span class="annottext">headRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621679999976"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-452"></span><span>      </span><span class="annot"><span class="annottext">Input -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span>
</span><span id="line-453"></span><span>        </span><span class="annot"><span class="annottext">Contest :: [BuiltinByteString] -&gt; Input
</span><span class="hs-identifier hs-type">Head.Contest</span></span><span>
</span><span id="line-454"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:signature:CollectCom :: [BuiltinByteString]
</span><span class="hs-keyword hs-var">signature</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx) -&gt; [BuiltinByteString]
forall a. MultiSignature a -&gt; [BuiltinByteString]
</span><a href="Hydra.Crypto.html#toPlutusSignatures"><span class="hs-identifier hs-var">toPlutusSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSignature (Snapshot Tx)
</span><a href="#local-6989586621679999990"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-455"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>    </span><span id="local-6989586621679999978"><span class="annot"><span class="annottext">headOutputAfter :: TxOut CtxTx
</span><a href="#local-6989586621679999978"><span class="hs-identifier hs-var hs-var">headOutputAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>      </span><span class="annot"><span class="annottext">(TxOutDatum CtxUTxO Era -&gt; TxOutDatum CtxTx)
-&gt; TxOut CtxUTxO -&gt; TxOut CtxTx
forall ctx0 era ctx1.
(TxOutDatum ctx0 era -&gt; TxOutDatum ctx1 era)
-&gt; TxOut ctx0 era -&gt; TxOut ctx1 era
</span><span class="hs-identifier hs-var">modifyTxOutDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutDatum CtxTx -&gt; TxOutDatum CtxUTxO Era -&gt; TxOutDatum CtxTx
forall a b. a -&gt; b -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><a href="#local-6989586621679999974"><span class="hs-identifier hs-var">headDatumAfter</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999987"><span class="hs-identifier hs-var">headOutputBefore</span></a></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>    </span><span id="local-6989586621679999973"><span class="annot"><span class="annottext">contester :: PubKeyHash
</span><a href="#local-6989586621679999973"><span class="hs-identifier hs-var hs-var">contester</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; PubKeyHash
</span><span class="hs-identifier hs-var">toPlutusKeyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679999996"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>    </span><span id="local-6989586621679999971"><span class="annot"><span class="annottext">onChainConstestationPeriod :: ContestationPeriod
</span><a href="#local-6989586621679999971"><span class="hs-identifier hs-var hs-var">onChainConstestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier hs-var">toChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999981"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621679999970"><span class="annot"><span class="annottext">newContestationDeadline :: POSIXTime
</span><a href="#local-6989586621679999970"><span class="hs-identifier hs-var hs-var">newContestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-464"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679999973"><span class="hs-identifier hs-var">contester</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; [PubKeyHash] -&gt; [PubKeyHash]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621679999983"><span class="hs-identifier hs-var">closedContesters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">[Party] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999985"><span class="hs-identifier hs-var">closedParties</span></a></span><span>
</span><span id="line-465"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679999984"><span class="hs-identifier hs-var">closedContestationDeadline</span></a></span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; ContestationPeriod -&gt; POSIXTime
</span><span class="hs-identifier hs-var">addContestationPeriod</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679999984"><span class="hs-identifier hs-var">closedContestationDeadline</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999971"><span class="hs-identifier hs-var">onChainConstestationPeriod</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>    </span><span id="local-6989586621679999974"><span class="annot"><span class="annottext">headDatumAfter :: TxOutDatum CtxTx
</span><a href="#local-6989586621679999974"><span class="hs-identifier hs-var hs-var">headDatumAfter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><span class="annottext">State -&gt; TxOutDatum CtxTx
forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">Closed :: [Party]
-&gt; Integer
-&gt; BuiltinByteString
-&gt; POSIXTime
-&gt; ContestationPeriod
-&gt; CurrencySymbol
-&gt; [PubKeyHash]
-&gt; State
</span><span class="hs-identifier hs-type">Head.Closed</span></span><span>
</span><span id="line-471"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:Initial :: Integer
</span><span class="hs-identifier hs-var">snapshotNumber</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679999994"><span class="hs-identifier hs-var">number</span></a></span><span>
</span><span id="line-472"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
utxoHash :: BuiltinByteString
$sel:utxoHash:Initial :: BuiltinByteString
</span><a href="#local-6989586621679999968"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span><span>
</span><span id="line-473"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:Initial :: [Party]
</span><span class="hs-identifier hs-var">parties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999985"><span class="hs-identifier hs-var">closedParties</span></a></span><span>
</span><span id="line-474"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationDeadline:Initial :: POSIXTime
</span><span class="hs-identifier hs-var">contestationDeadline</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679999970"><span class="hs-identifier hs-var">newContestationDeadline</span></a></span><span>
</span><span id="line-475"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:Initial :: ContestationPeriod
</span><span class="hs-identifier hs-var">contestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999971"><span class="hs-identifier hs-var">onChainConstestationPeriod</span></a></span><span>
</span><span id="line-476"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:Initial :: CurrencySymbol
</span><span class="hs-identifier hs-var">headId</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621679999982"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-477"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contesters:Initial :: [PubKeyHash]
</span><span class="hs-identifier hs-var">contesters</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PubKeyHash
</span><a href="#local-6989586621679999973"><span class="hs-identifier hs-var">contester</span></a></span><span> </span><span class="annot"><span class="annottext">PubKeyHash -&gt; [PubKeyHash] -&gt; [PubKeyHash]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621679999983"><span class="hs-identifier hs-var">closedContesters</span></a></span><span>
</span><span id="line-478"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-479"></span><span>    </span><span id="local-6989586621679999968"><span class="annot"><span class="annottext">utxoHash :: BuiltinByteString
</span><a href="#local-6989586621679999968"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BuiltinByteString
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; BuiltinByteString)
-&gt; ByteString -&gt; BuiltinByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Tx -&gt; ByteString
forall tx. IsTx tx =&gt; UTxOType tx -&gt; ByteString
</span><a href="Hydra.Ledger.html#hashUTxO"><span class="hs-identifier hs-var">hashUTxO</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><span class="annottext">UTxOType Tx
</span><a href="#local-6989586621679999992"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span class="hs-comment">-- | Create the fanout transaction, which distributes the closed state</span><span>
</span><span id="line-482"></span><span class="hs-comment">-- accordingly. The head validator allows fanout only &gt; deadline, so we need</span><span>
</span><span id="line-483"></span><span class="hs-comment">-- to set the lower bound to be deadline + 1 slot.</span><span>
</span><span id="line-484"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#fanoutTx"><span class="hs-identifier hs-type">fanoutTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-comment">-- | Published Hydra scripts to reference.</span><span>
</span><span id="line-486"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-comment">-- | Snapshotted UTxO to fanout on layer 1</span><span>
</span><span id="line-488"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-type">UTxOWithScript</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-comment">-- | Contestation deadline as SlotNo, used to set lower tx validity bound.</span><span>
</span><span id="line-492"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-comment">-- | Minting Policy script, made from initial seed</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PlutusScript</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-496"></span><span id="fanoutTx"><span class="annot"><span class="annottext">fanoutTx :: ScriptRegistry
-&gt; UTxO' (TxOut CtxUTxO)
-&gt; UTxOWithScript
-&gt; SlotNo
-&gt; PlutusScript
-&gt; Tx
</span><a href="Hydra.Chain.Direct.Tx.html#fanoutTx"><span class="hs-identifier hs-var hs-var">fanoutTx</span></a></span></span><span> </span><span id="local-6989586621679999966"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999966"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621679999965"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999965"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999964"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999964"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999963"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999963"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679999962"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999962"><span class="hs-identifier hs-var">headDatumBefore</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679999961"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679999961"><span class="hs-identifier hs-var">deadlineSlotNo</span></a></span></span><span> </span><span id="local-6989586621679999960"><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999960"><span class="hs-identifier hs-var">headTokenScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-497"></span><span>  </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-498"></span><span>    </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999964"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999959"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-500"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999958"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-501"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx]
</span><a href="#local-6989586621679999957"><span class="hs-identifier hs-var">orderedTxOutsToFanout</span></a></span><span>
</span><span id="line-502"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
-&gt; MintAction
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
forall redeemer.
ToScriptData redeemer =&gt;
PlutusScript
-&gt; redeemer
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#burnTokens"><span class="hs-identifier hs-var">burnTokens</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999960"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="annot"><span class="annottext">MintAction
</span><span class="hs-identifier hs-var">Burn</span></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Quantity)]
</span><a href="#local-6989586621679999956"><span class="hs-identifier hs-var">headTokens</span></a></span><span>
</span><span id="line-503"></span><span>      </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#setValidityLowerBound"><span class="hs-identifier hs-var">setValidityLowerBound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679999961"><span class="hs-identifier hs-var">deadlineSlotNo</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; SlotNo
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-505"></span><span>  </span><span id="local-6989586621679999959"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999959"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-507"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999958"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999954"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999962"><span class="hs-identifier hs-var">headDatumBefore</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999953"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-509"></span><span>  </span><span id="local-6989586621679999958"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621679999958"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#headReference"><span class="hs-identifier hs-var hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999966"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>  </span><span id="local-6989586621679999954"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621679999954"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-513"></span><span>  </span><span id="local-6989586621679999953"><span class="annot"><span class="annottext">headRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621679999953"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><span class="annottext">Input -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Input
</span><span class="hs-identifier hs-var">Head.Fanout</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Input) -&gt; Integer -&gt; Input
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999965"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span>  </span><span id="local-6989586621679999956"><span class="annot"><span class="annottext">headTokens :: [(AssetName, Quantity)]
</span><a href="#local-6989586621679999956"><span class="hs-identifier hs-var hs-var">headTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><span class="annottext">PlutusScript -&gt; Value -&gt; [(AssetName, Quantity)]
</span><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-var">headTokensFromValue</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999960"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999963"><span class="hs-identifier hs-var">headOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>  </span><span id="local-6989586621679999957"><span class="annot"><span class="annottext">orderedTxOutsToFanout :: [TxOut CtxTx]
</span><a href="#local-6989586621679999957"><span class="hs-identifier hs-var hs-var">orderedTxOutsToFanout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-520"></span><span>    </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall (f :: * -&gt; * -&gt; *) era.
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; TxOut CtxTx) -&gt; [TxOut CtxUTxO] -&gt; [TxOut CtxTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; [TxOut CtxUTxO]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999965"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-keyword">data</span><span> </span><span id="AbortTxError"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortTxError"><span class="hs-identifier hs-var">AbortTxError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OverlappingInputs"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OverlappingInputs"><span class="hs-identifier hs-var">OverlappingInputs</span></a></span></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999942"><span id="local-6989586621679999944"><span id="local-6989586621679999946"><span class="annot"><span class="annottext">Int -&gt; AbortTxError -&gt; ShowS
[AbortTxError] -&gt; ShowS
AbortTxError -&gt; String
(Int -&gt; AbortTxError -&gt; ShowS)
-&gt; (AbortTxError -&gt; String)
-&gt; ([AbortTxError] -&gt; ShowS)
-&gt; Show AbortTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AbortTxError] -&gt; ShowS
$cshowList :: [AbortTxError] -&gt; ShowS
show :: AbortTxError -&gt; String
$cshow :: AbortTxError -&gt; String
showsPrec :: Int -&gt; AbortTxError -&gt; ShowS
$cshowsPrec :: Int -&gt; AbortTxError -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="hs-comment">-- | Create transaction which aborts a head by spending the Head output and all</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- other &quot;initial&quot; outputs.</span><span>
</span><span id="line-527"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#abortTx"><span class="hs-identifier hs-type">abortTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-comment">-- | Committed UTxOs to reimburse.</span><span>
</span><span id="line-529"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-comment">-- | Published Hydra scripts to reference.</span><span>
</span><span id="line-531"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.ScriptRegistry.html#ScriptRegistry"><span class="hs-identifier hs-type">ScriptRegistry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-comment">-- | Party who's authorizing this transaction</span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-comment">-- | Everything needed to spend the Head state-machine output.</span><span>
</span><span id="line-535"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-536"></span><span>  </span><span class="hs-comment">-- | Script for monetary policy to burn tokens</span><span>
</span><span id="line-537"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PlutusScript</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-comment">-- | Data needed to spend the initial output sent to each party to the Head.</span><span>
</span><span id="line-539"></span><span>  </span><span class="hs-comment">-- Should contain the PT and is locked by initial script.</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-comment">-- | Data needed to spend commit outputs.</span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-comment">-- Should contain the PT and is locked by commit script.</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortTxError"><span class="hs-identifier hs-type">AbortTxError</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-545"></span><span id="abortTx"><span class="annot"><span class="annottext">abortTx :: UTxO' (TxOut CtxUTxO)
-&gt; ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; UTxOWithScript
-&gt; PlutusScript
-&gt; Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; Either AbortTxError Tx
</span><a href="Hydra.Chain.Direct.Tx.html#abortTx"><span class="hs-identifier hs-var hs-var">abortTx</span></a></span></span><span> </span><span id="local-6989586621679999940"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999940"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span> </span><span id="local-6989586621679999939"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999939"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span id="local-6989586621679999938"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679999938"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999937"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999937"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999936"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999936"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679999935"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999935"><span class="hs-identifier hs-var">headDatumBefore</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679999934"><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999934"><span class="hs-identifier hs-var">headTokenScript</span></a></span></span><span> </span><span id="local-6989586621679999933"><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621679999933"><span class="hs-identifier hs-var">initialsToAbort</span></a></span></span><span> </span><span id="local-6989586621679999932"><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621679999932"><span class="hs-identifier hs-var">commitsToAbort</span></a></span></span><span>
</span><span id="line-546"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut CtxUTxO, ScriptRedeemer) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key (Map TxIn (TxOut CtxUTxO, ScriptRedeemer))
-&gt; Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; Maybe (Val (Map TxIn (TxOut CtxUTxO, ScriptRedeemer)))
forall t. StaticMap t =&gt; Key t -&gt; t -&gt; Maybe (Val t)
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">Key (Map TxIn (TxOut CtxUTxO, ScriptRedeemer))
TxIn
</span><a href="#local-6989586621679999937"><span class="hs-identifier hs-var">headInput</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621679999933"><span class="hs-identifier hs-var">initialsToAbort</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-547"></span><span>      </span><span class="annot"><span class="annottext">AbortTxError -&gt; Either AbortTxError Tx
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">AbortTxError
</span><a href="Hydra.Chain.Direct.Tx.html#OverlappingInputs"><span class="hs-identifier hs-var">OverlappingInputs</span></a></span><span>
</span><span id="line-548"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-549"></span><span>      </span><span class="annot"><span class="annottext">Tx -&gt; Either AbortTxError Tx
forall a b. b -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx -&gt; Either AbortTxError Tx) -&gt; Tx -&gt; Either AbortTxError Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span class="annot"><span class="annottext">HasCallStack =&gt; TxBodyContent BuildTx -&gt; Tx
TxBodyContent BuildTx -&gt; Tx
</span><a href="Hydra.Ledger.Cardano.Builder.html#unsafeBuildTransaction"><span class="hs-identifier hs-var">unsafeBuildTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx -&gt; Tx) -&gt; TxBodyContent BuildTx -&gt; Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-551"></span><span>          </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#emptyTxBody"><span class="hs-identifier hs-var">emptyTxBody</span></a></span><span>
</span><span id="line-552"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addInputs"><span class="hs-identifier hs-var">addInputs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999937"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999929"><span class="hs-identifier hs-var">headWitness</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; TxIns BuildTx -&gt; TxIns BuildTx
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx
</span><a href="#local-6989586621679999928"><span class="hs-identifier hs-var">initialInputs</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx -&gt; TxIns BuildTx -&gt; TxIns BuildTx
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIns BuildTx
</span><a href="#local-6989586621679999927"><span class="hs-identifier hs-var">commitInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addReferenceInputs"><span class="hs-identifier hs-var">addReferenceInputs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999926"><span class="hs-identifier hs-var">initialScriptRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999925"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999924"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-554"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addOutputs"><span class="hs-identifier hs-var">addOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx]
</span><a href="#local-6989586621679999923"><span class="hs-identifier hs-var">reimbursedOutputs</span></a></span><span>
</span><span id="line-555"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
-&gt; MintAction
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
forall redeemer.
ToScriptData redeemer =&gt;
PlutusScript
-&gt; redeemer
-&gt; [(AssetName, Quantity)]
-&gt; TxBodyContent BuildTx
-&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#burnTokens"><span class="hs-identifier hs-var">burnTokens</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999934"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="annot"><span class="annottext">MintAction
</span><span class="hs-identifier hs-var">Burn</span></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Quantity)]
</span><a href="#local-6989586621679999922"><span class="hs-identifier hs-var">headTokens</span></a></span><span>
</span><span id="line-556"></span><span>            </span><span class="annot"><span class="annottext">TxBodyContent BuildTx
-&gt; (TxBodyContent BuildTx -&gt; TxBodyContent BuildTx)
-&gt; TxBodyContent BuildTx
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; TxBodyContent BuildTx -&gt; TxBodyContent BuildTx
</span><a href="Hydra.Ledger.Cardano.Builder.html#addExtraRequiredSigners"><span class="hs-identifier hs-var">addExtraRequiredSigners</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679999938"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-557"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-558"></span><span>  </span><span id="local-6989586621679999929"><span class="annot"><span class="annottext">headWitness :: BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999929"><span class="hs-identifier hs-var hs-var">headWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-559"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-561"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999924"><span class="hs-identifier hs-var">headScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999921"><span class="hs-identifier hs-var">headScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999935"><span class="hs-identifier hs-var">headDatumBefore</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999920"><span class="hs-identifier hs-var">headRedeemer</span></a></span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621679999924"><span class="annot"><span class="annottext">headScriptRef :: TxIn
</span><a href="#local-6989586621679999924"><span class="hs-identifier hs-var hs-var">headScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-563"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#headReference"><span class="hs-identifier hs-var hs-var">headReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999939"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>  </span><span id="local-6989586621679999921"><span class="annot"><span class="annottext">headScript :: PlutusScript
</span><a href="#local-6989586621679999921"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-565"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-566"></span><span>  </span><span id="local-6989586621679999920"><span class="annot"><span class="annottext">headRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621679999920"><span class="hs-identifier hs-var hs-var">headRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-567"></span><span>    </span><span class="annot"><span class="annottext">Input -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.Abort</span></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621679999928"><span class="annot"><span class="annottext">initialInputs :: TxIns BuildTx
</span><a href="#local-6989586621679999928"><span class="hs-identifier hs-var hs-var">initialInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
</span><a href="#local-6989586621679999918"><span class="hs-identifier hs-var">mkAbortInitial</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, (TxOut CtxUTxO, ScriptRedeemer))
 -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn)))
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))] -&gt; TxIns BuildTx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621679999933"><span class="hs-identifier hs-var">initialsToAbort</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>  </span><span id="local-6989586621679999927"><span class="annot"><span class="annottext">commitInputs :: TxIns BuildTx
</span><a href="#local-6989586621679999927"><span class="hs-identifier hs-var hs-var">commitInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
</span><a href="#local-6989586621679999917"><span class="hs-identifier hs-var">mkAbortCommit</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, (TxOut CtxUTxO, ScriptRedeemer))
 -&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn)))
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))] -&gt; TxIns BuildTx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
-&gt; [(TxIn, (TxOut CtxUTxO, ScriptRedeemer))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621679999932"><span class="hs-identifier hs-var">commitsToAbort</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>  </span><span id="local-6989586621679999922"><span class="annot"><span class="annottext">headTokens :: [(AssetName, Quantity)]
</span><a href="#local-6989586621679999922"><span class="hs-identifier hs-var hs-var">headTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><span class="annottext">PlutusScript -&gt; Value -&gt; [(AssetName, Quantity)]
</span><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-var">headTokensFromValue</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999934"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetName, Quantity)])
-&gt; Value -&gt; [(AssetName, Quantity)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-575"></span><span>      </span><span class="annot"><span class="annottext">[Value] -&gt; Value
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999936"><span class="hs-identifier hs-var">initialHeadOutput</span></a></span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((TxOut CtxUTxO, ScriptRedeemer) -&gt; Value)
-&gt; Map TxIn (TxOut CtxUTxO, ScriptRedeemer) -&gt; Value
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value)
-&gt; ((TxOut CtxUTxO, ScriptRedeemer) -&gt; TxOut CtxUTxO)
-&gt; (TxOut CtxUTxO, ScriptRedeemer)
-&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO, ScriptRedeemer) -&gt; TxOut CtxUTxO
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621679999933"><span class="hs-identifier hs-var">initialsToAbort</span></a></span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((TxOut CtxUTxO, ScriptRedeemer) -&gt; Value)
-&gt; Map TxIn (TxOut CtxUTxO, ScriptRedeemer) -&gt; Value
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Value)
-&gt; ((TxOut CtxUTxO, ScriptRedeemer) -&gt; TxOut CtxUTxO)
-&gt; (TxOut CtxUTxO, ScriptRedeemer)
-&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO, ScriptRedeemer) -&gt; TxOut CtxUTxO
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, ScriptRedeemer)
</span><a href="#local-6989586621679999932"><span class="hs-identifier hs-var">commitsToAbort</span></a></span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-comment">-- NOTE: Abort datums contain the datum of the spent state-machine input, but</span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-comment">-- also, the datum of the created output which is necessary for the</span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-comment">-- state-machine on-chain validator to control the correctness of the</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-comment">-- transition.</span><span>
</span><span id="line-585"></span><span>  </span><span id="local-6989586621679999918"><span class="annot"><span class="annottext">mkAbortInitial :: (TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
</span><a href="#local-6989586621679999918"><span class="hs-identifier hs-var hs-var">mkAbortInitial</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999916"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999916"><span class="hs-identifier hs-var">initialInput</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679999915"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999915"><span class="hs-identifier hs-var">initialDatum</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-586"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999916"><span class="hs-identifier hs-var">initialInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999914"><span class="hs-identifier hs-var">mkAbortInitialWitness</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999915"><span class="hs-identifier hs-var">initialDatum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>  </span><span id="local-6989586621679999914"><span class="annot"><span class="annottext">mkAbortInitialWitness :: ScriptDatum WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999914"><span class="hs-identifier hs-var hs-var">mkAbortInitialWitness</span></a></span></span><span> </span><span id="local-6989586621679999913"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999913"><span class="hs-identifier hs-var">initialDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-590"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-591"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999926"><span class="hs-identifier hs-var">initialScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999912"><span class="hs-identifier hs-var">initialScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999913"><span class="hs-identifier hs-var">initialDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999911"><span class="hs-identifier hs-var">initialRedeemer</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span id="local-6989586621679999926"><span class="annot"><span class="annottext">initialScriptRef :: TxIn
</span><a href="#local-6989586621679999926"><span class="hs-identifier hs-var hs-var">initialScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-593"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#initialReference"><span class="hs-identifier hs-var hs-var">initialReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999939"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>  </span><span id="local-6989586621679999912"><span class="annot"><span class="annottext">initialScript :: PlutusScript
</span><a href="#local-6989586621679999912"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-596"></span><span>  </span><span id="local-6989586621679999911"><span class="annot"><span class="annottext">initialRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621679999911"><span class="hs-identifier hs-var hs-var">initialRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">(Redeemer -&gt; ScriptRedeemer) -&gt; Redeemer -&gt; ScriptRedeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RedeemerType -&gt; Redeemer
</span><span class="hs-identifier hs-var">Initial.redeemer</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType
</span><span class="hs-identifier hs-var">Initial.ViaAbort</span></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>  </span><span id="local-6989586621679999917"><span class="annot"><span class="annottext">mkAbortCommit :: (TxIn, (TxOut CtxUTxO, ScriptRedeemer))
-&gt; (TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn))
</span><a href="#local-6989586621679999917"><span class="hs-identifier hs-var hs-var">mkAbortCommit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999909"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999909"><span class="hs-identifier hs-var">commitInput</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">ScriptDatumForTxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679999908"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999908"><span class="hs-identifier hs-var">commitDatum</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999909"><span class="hs-identifier hs-var">commitInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999907"><span class="hs-identifier hs-var">mkAbortCommitWitness</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999908"><span class="hs-identifier hs-var">commitDatum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>  </span><span id="local-6989586621679999907"><span class="annot"><span class="annottext">mkAbortCommitWitness :: ScriptDatum WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
</span><a href="#local-6989586621679999907"><span class="hs-identifier hs-var hs-var">mkAbortCommitWitness</span></a></span></span><span> </span><span id="local-6989586621679999906"><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999906"><span class="hs-identifier hs-var">commitDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><span class="annottext">Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn))
-&gt; Witness WitCtxTxIn -&gt; BuildTxWith BuildTx (Witness WitCtxTxIn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-604"></span><span>      </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall ctx.
ScriptWitnessInCtx ctx -&gt; ScriptWitness ctx -&gt; Witness ctx
</span><span class="hs-identifier hs-var">ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
forall ctx. IsScriptWitnessInCtx ctx =&gt; ScriptWitnessInCtx ctx
</span><span class="hs-identifier hs-var">scriptWitnessInCtx</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn)
-&gt; ScriptWitness WitCtxTxIn -&gt; Witness WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="annottext">TxIn
-&gt; PlutusScript
-&gt; ScriptDatum WitCtxTxIn
-&gt; ScriptRedeemer
-&gt; ScriptWitness WitCtxTxIn
forall ctx era lang.
(IsPlutusScriptLanguage lang, HasScriptLanguage lang era) =&gt;
TxIn
-&gt; PlutusScript lang
-&gt; ScriptDatum ctx
-&gt; ScriptRedeemer
-&gt; ScriptWitness ctx era
</span><span class="hs-identifier hs-var">mkScriptReference</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999925"><span class="hs-identifier hs-var">commitScriptRef</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999905"><span class="hs-identifier hs-var">commitScript</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDatum WitCtxTxIn
</span><a href="#local-6989586621679999906"><span class="hs-identifier hs-var">commitDatum</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999904"><span class="hs-identifier hs-var">commitRedeemer</span></a></span><span>
</span><span id="line-606"></span><span>  </span><span id="local-6989586621679999925"><span class="annot"><span class="annottext">commitScriptRef :: TxIn
</span><a href="#local-6989586621679999925"><span class="hs-identifier hs-var hs-var">commitScriptRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-607"></span><span>    </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.ScriptRegistry.html#commitReference"><span class="hs-identifier hs-var hs-var">commitReference</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679999939"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>  </span><span id="local-6989586621679999905"><span class="annot"><span class="annottext">commitScript :: PlutusScript
</span><a href="#local-6989586621679999905"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-610"></span><span>  </span><span id="local-6989586621679999904"><span class="annot"><span class="annottext">commitRedeemer :: ScriptRedeemer
</span><a href="#local-6989586621679999904"><span class="hs-identifier hs-var hs-var">commitRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><span class="annottext">Redeemer -&gt; ScriptRedeemer
forall a. ToScriptData a =&gt; a -&gt; ScriptRedeemer
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RedeemerType -&gt; Redeemer
</span><span class="hs-identifier hs-var">Commit.redeemer</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType
</span><span class="hs-identifier hs-var">Commit.ViaAbort</span></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>  </span><span id="local-6989586621679999923"><span class="annot"><span class="annottext">reimbursedOutputs :: [TxOut CtxTx]
</span><a href="#local-6989586621679999923"><span class="hs-identifier hs-var hs-var">reimbursedOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx
forall (f :: * -&gt; * -&gt; *) era.
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; TxOut CtxTx)
-&gt; ((TxIn, TxOut CtxUTxO) -&gt; TxOut CtxUTxO)
-&gt; (TxIn, TxOut CtxUTxO)
-&gt; TxOut CtxTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxOut CtxUTxO
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; TxOut CtxTx)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [TxOut CtxTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; [(TxIn, TxOut CtxUTxO)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">UTxO.pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999940"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="hs-comment">-- * Observe Hydra Head transactions</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="hs-keyword">data</span><span> </span><span id="InitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-var">InitObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-var">InitObservation</span></a></span></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AthreadOutput%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; InitialThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3AInitObservation"><span class="hs-identifier hs-var hs-var">threadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-type">InitialThreadOutput</span></a></span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-comment">-- ^ The state machine UTxO produced by the Init transaction</span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-comment">-- This output should always be present and 'threaded' across all</span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-comment">-- transactions.</span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-comment">-- NOTE(SN): The Head's identifier is somewhat encoded in the TxOut's address</span><span>
</span><span id="line-623"></span><span>  </span><span class="hs-comment">-- XXX(SN): Data and [OnChain.Party] are overlapping</span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Ainitials%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [UTxOWithScript]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Ainitials%3AInitObservation"><span class="hs-identifier hs-var hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-type">UTxOWithScript</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acommits%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [UTxOWithScript]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acommits%3AInitObservation"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-type">UTxOWithScript</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInitObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AseedTxIn%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; TxIn
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AseedTxIn%3AInitObservation"><span class="hs-identifier hs-var hs-var">seedTxIn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcontestationPeriod%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationPeriod%3AInitObservation"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.ContestationPeriod.html#ContestationPeriod"><span class="hs-identifier hs-type">ContestationPeriod</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aparties%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparties%3AInitObservation"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999889"><span id="local-6989586621679999891"><span id="local-6989586621679999893"><span class="annot"><span class="annottext">Int -&gt; InitObservation -&gt; ShowS
[InitObservation] -&gt; ShowS
InitObservation -&gt; String
(Int -&gt; InitObservation -&gt; ShowS)
-&gt; (InitObservation -&gt; String)
-&gt; ([InitObservation] -&gt; ShowS)
-&gt; Show InitObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [InitObservation] -&gt; ShowS
$cshowList :: [InitObservation] -&gt; ShowS
show :: InitObservation -&gt; String
$cshow :: InitObservation -&gt; String
showsPrec :: Int -&gt; InitObservation -&gt; ShowS
$cshowsPrec :: Int -&gt; InitObservation -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999885"><span id="local-6989586621679999887"><span class="annot"><span class="annottext">InitObservation -&gt; InitObservation -&gt; Bool
(InitObservation -&gt; InitObservation -&gt; Bool)
-&gt; (InitObservation -&gt; InitObservation -&gt; Bool)
-&gt; Eq InitObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: InitObservation -&gt; InitObservation -&gt; Bool
$c/= :: InitObservation -&gt; InitObservation -&gt; Bool
== :: InitObservation -&gt; InitObservation -&gt; Bool
$c== :: InitObservation -&gt; InitObservation -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="hs-keyword">data</span><span> </span><span id="NotAnInitReason"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAnInitReason"><span class="hs-identifier hs-var">NotAnInitReason</span></a></span></span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NotAHeadPolicy"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoHeadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoHeadOutput"><span class="hs-identifier hs-var">NoHeadOutput</span></a></span></span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotAHeadDatum"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAHeadDatum"><span class="hs-identifier hs-var">NotAHeadDatum</span></a></span></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoSTFound"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoSTFound"><span class="hs-identifier hs-var">NoSTFound</span></a></span></span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PartiesMismatch"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#PartiesMismatch"><span class="hs-identifier hs-var">PartiesMismatch</span></a></span></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="OwnPartyMissing"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OwnPartyMissing"><span class="hs-identifier hs-var">OwnPartyMissing</span></a></span></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CPMismatch"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CPMismatch"><span class="hs-identifier hs-var">CPMismatch</span></a></span></span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PTsNotMintedCorrectly"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#PTsNotMintedCorrectly"><span class="hs-identifier hs-var">PTsNotMintedCorrectly</span></a></span></span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999871"><span id="local-6989586621679999873"><span id="local-6989586621679999875"><span class="annot"><span class="annottext">Int -&gt; NotAnInitReason -&gt; ShowS
[NotAnInitReason] -&gt; ShowS
NotAnInitReason -&gt; String
(Int -&gt; NotAnInitReason -&gt; ShowS)
-&gt; (NotAnInitReason -&gt; String)
-&gt; ([NotAnInitReason] -&gt; ShowS)
-&gt; Show NotAnInitReason
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [NotAnInitReason] -&gt; ShowS
$cshowList :: [NotAnInitReason] -&gt; ShowS
show :: NotAnInitReason -&gt; String
$cshow :: NotAnInitReason -&gt; String
showsPrec :: Int -&gt; NotAnInitReason -&gt; ShowS
$cshowsPrec :: Int -&gt; NotAnInitReason -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999867"><span id="local-6989586621679999869"><span class="annot"><span class="annottext">NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
(NotAnInitReason -&gt; NotAnInitReason -&gt; Bool)
-&gt; (NotAnInitReason -&gt; NotAnInitReason -&gt; Bool)
-&gt; Eq NotAnInitReason
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
$c/= :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
== :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
$c== :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-type">observeInitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-645"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-comment">-- | Our node's contestation period</span><span>
</span><span id="line-648"></span><span>  </span><span class="annot"><a href="Hydra.ContestationPeriod.html#ContestationPeriod"><span class="hs-identifier hs-type">ContestationPeriod</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-649"></span><span>  </span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAnInitReason"><span class="hs-identifier hs-type">NotAnInitReason</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-653"></span><span id="observeInitTx"><span class="annot"><span class="annottext">observeInitTx :: NetworkId
-&gt; [VerificationKey PaymentKey]
-&gt; ContestationPeriod
-&gt; Party
-&gt; [Party]
-&gt; Tx
-&gt; Either NotAnInitReason InitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-var hs-var">observeInitTx</span></a></span></span><span> </span><span id="local-6989586621679999865"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679999865"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621679999864"><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679999864"><span class="hs-identifier hs-var">cardanoKeys</span></a></span></span><span> </span><span id="local-6989586621679999863"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999863"><span class="hs-identifier hs-var">expectedCP</span></a></span></span><span> </span><span id="local-6989586621679999862"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679999862"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679999861"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999861"><span class="hs-identifier hs-var">otherParties</span></a></span></span><span> </span><span id="local-6989586621679999860"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999860"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-comment">-- XXX: Lots of redundant information here</span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999859"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679999859"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999858"><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999858"><span class="hs-identifier hs-var">headOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999857"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999857"><span class="hs-identifier hs-var">headData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999856"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999856"><span class="hs-identifier hs-var">headState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-656"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason
-&gt; Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
-&gt; Either
     NotAnInitReason (Word, TxOut CtxTx, ScriptRedeemer, State)
forall a b. a -&gt; Maybe b -&gt; Either a b
</span><a href="#local-6989586621679999855"><span class="hs-identifier hs-var">maybeLeft</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NoHeadOutput"><span class="hs-identifier hs-var">NoHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
 -&gt; Either
      NotAnInitReason (Word, TxOut CtxTx, ScriptRedeemer, State))
-&gt; Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
-&gt; Either
     NotAnInitReason (Word, TxOut CtxTx, ScriptRedeemer, State)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-657"></span><span>      </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx)
 -&gt; Maybe (Word, TxOut CtxTx, ScriptRedeemer, State))
-&gt; [(Word, TxOut CtxTx)]
-&gt; Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-var">findFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(Word, TxOut CtxTx)
-&gt; Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
</span><a href="#local-6989586621679999853"><span class="hs-identifier hs-var">headOutput</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx)]
</span><a href="#local-6989586621679999852"><span class="hs-identifier hs-var">indexedOutputs</span></a></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-comment">-- check that we have a proper head</span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999851"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999851"><span class="hs-identifier hs-var">headId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999850"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999850"><span class="hs-identifier hs-var">contestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999849"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999849"><span class="hs-identifier hs-var">onChainParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999848"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999848"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999856"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Initial</span></span><span> </span><span id="local-6989586621679999847"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999847"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621679999846"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999846"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679999845"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679999845"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679999844"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679999844"><span class="hs-identifier hs-var">outRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-662"></span><span>      </span><span class="annot"><span class="annottext">(PolicyId, ContestationPeriod, [Party], TxIn)
-&gt; Either
     NotAnInitReason (PolicyId, ContestationPeriod, [Party], TxIn)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CurrencySymbol -&gt; PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679999845"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#fromChain"><span class="hs-identifier hs-var">fromChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999847"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999846"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; TxIn
</span><span class="hs-identifier hs-var">fromPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679999844"><span class="hs-identifier hs-var">outRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>    </span><span class="annot"><span class="annottext">State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
-&gt; Either
     NotAnInitReason (PolicyId, ContestationPeriod, [Party], TxIn)
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadDatum"><span class="hs-identifier hs-var">NotAHeadDatum</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679999841"><span class="annot"><span class="annottext">offChainParties :: [Party]
</span><a href="#local-6989586621679999841"><span class="hs-identifier hs-var hs-var">offChainParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; [Party]) -&gt; [Party] -&gt; [Party]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; [Party]
forall (m :: * -&gt; *). MonadFail m =&gt; Party -&gt; m Party
</span><a href="Hydra.Party.html#partyFromChain"><span class="hs-identifier hs-var">partyFromChain</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999849"><span class="hs-identifier hs-var">onChainParties</span></a></span><span>
</span><span id="line-666"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679999839"><span class="annot"><span class="annottext">stQuantity :: Quantity
</span><a href="#local-6989586621679999839"><span class="hs-identifier hs-var hs-var">stQuantity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; AssetId -&gt; Quantity
</span><span class="hs-identifier hs-var">selectAsset</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999858"><span class="hs-identifier hs-var">headOut</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999851"><span class="hs-identifier hs-var">headId</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-comment">-- check that ST is present in the head output</span><span>
</span><span id="line-669"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679999839"><span class="hs-identifier hs-var">stQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NoSTFound"><span class="hs-identifier hs-var">NoSTFound</span></a></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-comment">-- check that we are using the same seed and headId matches</span><span>
</span><span id="line-673"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999851"><span class="hs-identifier hs-var">headId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; PolicyId
</span><span class="hs-identifier hs-var">HeadTokens.headPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999848"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-674"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-comment">-- check that configured CP is present in the datum</span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999863"><span class="hs-identifier hs-var">expectedCP</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999850"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-678"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#CPMismatch"><span class="hs-identifier hs-var">CPMismatch</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-comment">-- check that our party is present in the datum</span><span>
</span><span id="line-681"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679999862"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; [Party] -&gt; Bool
forall (f :: * -&gt; *) a.
(Foldable f, DisallowElem f, Eq a) =&gt;
a -&gt; f a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999841"><span class="hs-identifier hs-var">offChainParties</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-682"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#OwnPartyMissing"><span class="hs-identifier hs-var">OwnPartyMissing</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-comment">-- check that configured parties are matched in the datum</span><span>
</span><span id="line-685"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Party] -&gt; [Party] -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621679999835"><span class="hs-identifier hs-var">containsSameElements</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999841"><span class="hs-identifier hs-var">offChainParties</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999834"><span class="hs-identifier hs-var">allConfiguredParties</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-686"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#PartiesMismatch"><span class="hs-identifier hs-var">PartiesMismatch</span></a></span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-comment">-- pub key hashes of all configured participants == the token names of PTs</span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AssetName] -&gt; [AssetName] -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621679999835"><span class="hs-identifier hs-var">containsSameElements</span></a></span><span> </span><span class="annot"><span class="annottext">[AssetName]
</span><a href="#local-6989586621679999833"><span class="hs-identifier hs-var">configuredTokenNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; [AssetName]
</span><a href="#local-6989586621679999832"><span class="hs-identifier hs-var">mintedTokenNames</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999851"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-690"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#PTsNotMintedCorrectly"><span class="hs-identifier hs-var">PTsNotMintedCorrectly</span></a></span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><span class="annottext">InitObservation -&gt; Either NotAnInitReason InitObservation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-693"></span><span>    </span><span class="annot"><span class="annottext">InitObservation :: InitialThreadOutput
-&gt; [UTxOWithScript]
-&gt; [UTxOWithScript]
-&gt; HeadId
-&gt; TxIn
-&gt; ContestationPeriod
-&gt; [Party]
-&gt; InitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-694"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:threadOutput:InitObservation :: InitialThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3AInitObservation"><span class="hs-identifier hs-var">threadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-695"></span><span>          </span><span class="annot"><span class="annottext">InitialThreadOutput :: UTxOWithScript
-&gt; ContestationPeriod -&gt; [Party] -&gt; InitialThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-type">InitialThreadOutput</span></a></span><span>
</span><span id="line-696"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:initialThreadUTxO:InitialThreadOutput :: UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="hs-identifier hs-var">initialThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-697"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; Word -&gt; TxIn
forall era. Tx era -&gt; Word -&gt; TxIn
</span><span class="hs-identifier hs-var">mkTxIn</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999860"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679999859"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-698"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999858"><span class="hs-identifier hs-var">headOut</span></a></span><span>
</span><span id="line-699"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999857"><span class="hs-identifier hs-var">headData</span></a></span><span>
</span><span id="line-700"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:initialParties:InitialThreadOutput :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialParties%3AInitialThreadOutput"><span class="hs-identifier hs-var">initialParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999849"><span class="hs-identifier hs-var">onChainParties</span></a></span><span>
</span><span id="line-702"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:initialContestationPeriod:InitialThreadOutput :: ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialContestationPeriod%3AInitialThreadOutput"><span class="hs-identifier hs-var">initialContestationPeriod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><a href="Hydra.ContestationPeriod.html#toChain"><span class="hs-identifier hs-var">toChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999850"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-703"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-704"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UTxOWithScript]
initials :: [UTxOWithScript]
$sel:initials:InitObservation :: [UTxOWithScript]
</span><a href="#local-6989586621679999829"><span class="hs-identifier hs-var hs-var">initials</span></a></span><span>
</span><span id="line-705"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:commits:InitObservation :: [UTxOWithScript]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acommits%3AInitObservation"><span class="hs-identifier hs-var">commits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-706"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:InitObservation :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInitObservation"><span class="hs-identifier hs-var">headId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var">mkHeadId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999851"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-707"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
seedTxIn :: TxIn
$sel:seedTxIn:InitObservation :: TxIn
</span><a href="#local-6989586621679999848"><span class="hs-identifier hs-var hs-var">seedTxIn</span></a></span><span>
</span><span id="line-708"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- NOTE: we should look into why parties and cp are duplicated in the InitObservation.</span><span>
</span><span id="line-709"></span><span>        </span><span class="hs-comment">-- They are included: Once in the InitialThreadOutput in their on-chain form, once in</span><span>
</span><span id="line-710"></span><span>        </span><span class="hs-comment">-- InitObservation in their off-chain form and they are also included in the datum of</span><span>
</span><span id="line-711"></span><span>        </span><span class="hs-comment">-- the initialThreadUTxO`.. so three times.</span><span>
</span><span id="line-712"></span><span>        </span><span class="annot"><span class="annottext">ContestationPeriod
contestationPeriod :: ContestationPeriod
$sel:contestationPeriod:InitObservation :: ContestationPeriod
</span><a href="#local-6989586621679999850"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-713"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:InitObservation :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparties%3AInitObservation"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999841"><span class="hs-identifier hs-var">offChainParties</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-715"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-716"></span><span>  </span><span id="local-6989586621679999834"><span class="annot"><span class="annottext">allConfiguredParties :: [Party]
</span><a href="#local-6989586621679999834"><span class="hs-identifier hs-var hs-var">allConfiguredParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679999862"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; [Party] -&gt; [Party]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999861"><span class="hs-identifier hs-var">otherParties</span></a></span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span>  </span><span id="local-6989586621679999833"><span class="annot"><span class="annottext">configuredTokenNames :: [AssetName]
</span><a href="#local-6989586621679999833"><span class="hs-identifier hs-var hs-var">configuredTokenNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#assetNameFromVerificationKey"><span class="hs-identifier hs-var">assetNameFromVerificationKey</span></a></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; AssetName)
-&gt; [VerificationKey PaymentKey] -&gt; [AssetName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679999864"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>  </span><span id="local-6989586621679999835"><span class="annot"><span class="annottext">containsSameElements :: [a] -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621679999835"><span class="hs-identifier hs-var hs-var">containsSameElements</span></a></span></span><span> </span><span id="local-6989586621679999827"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679999827"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679999826"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679999826"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Set a
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679999827"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; Set a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Set a
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679999826"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span>  </span><span id="local-6989586621679999855"><span class="annot"><span class="annottext">maybeLeft :: a -&gt; Maybe b -&gt; Either a b
</span><a href="#local-6989586621679999855"><span class="hs-identifier hs-var hs-var">maybeLeft</span></a></span></span><span> </span><span id="local-6989586621679999824"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679999824"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; (b -&gt; Either a b) -&gt; Maybe b -&gt; Either a b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a b
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679999824"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either a b
forall a b. b -&gt; Either a b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span>
</span><span id="line-723"></span><span>
</span><span id="line-724"></span><span>  </span><span id="local-6989586621679999853"><span class="annot"><span class="annottext">headOutput :: (Word, TxOut CtxTx)
-&gt; Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
</span><a href="#local-6989586621679999853"><span class="hs-identifier hs-var hs-var">headOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-725"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679999822"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679999822"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999821"><span class="annot"><span class="annottext">out :: TxOut CtxTx
</span><a href="#local-6989586621679999821"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span id="local-6989586621679999820"><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679999820"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOutDatumInTx</span></span><span> </span><span id="local-6989586621679999818"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999818"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-726"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679999820"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; AddressInEra -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679999817"><span class="hs-identifier hs-var">headAddress</span></a></span><span>
</span><span id="line-727"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679999822"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999821"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999818"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(State -&gt; (Word, TxOut CtxTx, ScriptRedeemer, State))
-&gt; Maybe State -&gt; Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe State
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999818"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><span class="annottext">(Word, TxOut CtxTx)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Word, TxOut CtxTx, ScriptRedeemer, State)
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-729"></span><span>
</span><span id="line-730"></span><span>  </span><span id="local-6989586621679999817"><span class="annot"><span class="annottext">headAddress :: AddressInEra
</span><a href="#local-6989586621679999817"><span class="hs-identifier hs-var hs-var">headAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-731"></span><span>    </span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679999865"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">(PlutusScript -&gt; AddressInEra) -&gt; PlutusScript -&gt; AddressInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-732"></span><span>      </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>  </span><span id="local-6989586621679999852"><span class="annot"><span class="annottext">indexedOutputs :: [(Word, TxOut CtxTx)]
</span><a href="#local-6989586621679999852"><span class="hs-identifier hs-var hs-var">indexedOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; [TxOut CtxTx] -&gt; [(Word, TxOut CtxTx)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; [TxOut CtxTx]
forall era. Tx era -&gt; [TxOut CtxTx era]
</span><span class="hs-identifier hs-var">txOuts'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999860"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span>  </span><span id="local-6989586621679999815"><span class="annot"><span class="annottext">initialOutputs :: [(Word, TxOut CtxTx)]
</span><a href="#local-6989586621679999815"><span class="hs-identifier hs-var hs-var">initialOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx) -&gt; Bool)
-&gt; [(Word, TxOut CtxTx)] -&gt; [(Word, TxOut CtxTx)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Bool
</span><a href="#local-6989586621679999814"><span class="hs-identifier hs-var">isInitial</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx -&gt; Bool)
-&gt; ((Word, TxOut CtxTx) -&gt; TxOut CtxTx)
-&gt; (Word, TxOut CtxTx)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Word, TxOut CtxTx) -&gt; TxOut CtxTx
forall a b. (a, b) -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx)]
</span><a href="#local-6989586621679999852"><span class="hs-identifier hs-var">indexedOutputs</span></a></span><span>
</span><span id="line-737"></span><span>
</span><span id="line-738"></span><span>  </span><span id="local-6989586621679999829"><span class="annot"><span class="annottext">initials :: [UTxOWithScript]
</span><a href="#local-6989586621679999829"><span class="hs-identifier hs-var hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-739"></span><span>    </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx) -&gt; Maybe UTxOWithScript)
-&gt; [(Word, TxOut CtxTx)] -&gt; [UTxOWithScript]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span>
</span><span id="line-740"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679999813"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679999813"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999812"><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999812"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-741"></span><span>          </span><span id="local-6989586621679999811"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999811"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe ScriptRedeemer
forall era. TxOut CtxTx era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999812"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-742"></span><span>          </span><span class="annot"><span class="annottext">UTxOWithScript -&gt; Maybe UTxOWithScript
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Word -&gt; TxIn
forall era. Tx era -&gt; Word -&gt; TxIn
</span><span class="hs-identifier hs-var">mkTxIn</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999860"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679999813"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999812"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999811"><span class="hs-identifier hs-var">dat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>      </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx)]
</span><a href="#local-6989586621679999815"><span class="hs-identifier hs-var">initialOutputs</span></a></span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>  </span><span id="local-6989586621679999814"><span class="annot"><span class="annottext">isInitial :: TxOut CtxTx -&gt; Bool
</span><a href="#local-6989586621679999814"><span class="hs-identifier hs-var hs-var">isInitial</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span id="local-6989586621679999809"><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679999809"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679999809"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; AddressInEra -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679999808"><span class="hs-identifier hs-var">initialAddress</span></a></span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span>  </span><span id="local-6989586621679999808"><span class="annot"><span class="annottext">initialAddress :: AddressInEra
</span><a href="#local-6989586621679999808"><span class="hs-identifier hs-var hs-var">initialAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679999865"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999807"><span class="hs-identifier hs-var">initialScript</span></a></span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>  </span><span id="local-6989586621679999807"><span class="annot"><span class="annottext">initialScript :: PlutusScript lang
</span><a href="#local-6989586621679999807"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>  </span><span id="local-6989586621679999832"><span class="annot"><span class="annottext">mintedTokenNames :: PolicyId -&gt; [AssetName]
</span><a href="#local-6989586621679999832"><span class="hs-identifier hs-var hs-var">mintedTokenNames</span></a></span></span><span> </span><span id="local-6989586621679999806"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999806"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-753"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999805"><span class="hs-identifier hs-var">assetName</span></a></span><span>
</span><span id="line-754"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621679999804"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999804"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621679999805"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999805"><span class="hs-identifier hs-var">assetName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999803"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679999803"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [(AssetId, Quantity)]
forall era. Tx era -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">txMintAssets</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999860"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-755"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- NOTE: It is important to check quantity since we want to ensure</span><span>
</span><span id="line-756"></span><span>    </span><span class="hs-comment">-- the tokens are unique.</span><span>
</span><span id="line-757"></span><span>    </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679999803"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999804"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999806"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999805"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span class="hs-keyword">data</span><span> </span><span id="CommitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-var">CommitObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CommitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-var">CommitObservation</span></a></span></span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcommitOutput%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcommitOutput%3ACommitObservation"><span class="hs-identifier hs-var hs-var">commitOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-type">UTxOWithScript</span></a></span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aparty%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; Party
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparty%3ACommitObservation"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Party.html#Party"><span class="hs-identifier hs-type">Party</span></a></span><span>
</span><span id="line-765"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acommitted%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; UTxO' (TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acommitted%3ACommitObservation"><span class="hs-identifier hs-var hs-var">committed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span class="hs-comment">-- | Identify a commit tx by:</span><span>
</span><span id="line-769"></span><span class="hs-comment">--</span><span>
</span><span id="line-770"></span><span class="hs-comment">-- - Find which 'initial' tx input is being consumed,</span><span>
</span><span id="line-771"></span><span class="hs-comment">-- - Find the redeemer corresponding to that 'initial', which contains the tx</span><span>
</span><span id="line-772"></span><span class="hs-comment">--   input of the committed utxo,</span><span>
</span><span id="line-773"></span><span class="hs-comment">-- - Find the outputs which pays to the commit validator,</span><span>
</span><span id="line-774"></span><span class="hs-comment">-- - Using the datum of that output, deserialize the committed output,</span><span>
</span><span id="line-775"></span><span class="hs-comment">-- - Reconstruct the committed UTxO from both values (tx input and output).</span><span>
</span><span id="line-776"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-type">observeCommitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-777"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-comment">-- | Known (remaining) initial tx inputs.</span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-781"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-782"></span><span id="observeCommitTx"><span class="annot"><span class="annottext">observeCommitTx :: NetworkId -&gt; [TxIn] -&gt; Tx -&gt; Maybe CommitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-var hs-var">observeCommitTx</span></a></span></span><span> </span><span id="local-6989586621679999795"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679999795"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621679999794"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679999794"><span class="hs-identifier hs-var">initials</span></a></span></span><span> </span><span id="local-6989586621679999793"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999793"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-783"></span><span>  </span><span id="local-6989586621679999792"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999792"><span class="hs-identifier hs-var">initialTxIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TxIn
</span><a href="#local-6989586621679999791"><span class="hs-identifier hs-var">findInitialTxIn</span></a></span><span>
</span><span id="line-784"></span><span>  </span><span id="local-6989586621679999790"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679999790"><span class="hs-identifier hs-var">committedTxIns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Maybe [TxIn]
</span><a href="#local-6989586621679999789"><span class="hs-identifier hs-var">decodeInitialRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999792"><span class="hs-identifier hs-var">initialTxIn</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999788"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999788"><span class="hs-identifier hs-var">commitIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999787"><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999787"><span class="hs-identifier hs-var">commitOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; Tx -&gt; Maybe (TxIn, TxOut CtxTx)
forall era.
AddressInEra era -&gt; Tx era -&gt; Maybe (TxIn, TxOut CtxTx era)
</span><span class="hs-identifier hs-var">findTxOutByAddress</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679999785"><span class="hs-identifier hs-var">commitAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999793"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-787"></span><span>  </span><span id="local-6989586621679999784"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999784"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; Maybe ScriptRedeemer
forall era. TxOut CtxTx era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999787"><span class="hs-identifier hs-var">commitOut</span></a></span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999783"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679999783"><span class="hs-identifier hs-var">onChainParty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999782"><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621679999782"><span class="hs-identifier hs-var">onChainCommits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999781"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621679999781"><span class="hs-identifier hs-var">_headId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Commit.DatumType</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe DatumType
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999784"><span class="hs-identifier hs-var">dat</span></a></span><span>
</span><span id="line-789"></span><span>  </span><span id="local-6989586621679999780"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679999780"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Party -&gt; Maybe Party
forall (m :: * -&gt; *). MonadFail m =&gt; Party -&gt; m Party
</span><a href="Hydra.Party.html#partyFromChain"><span class="hs-identifier hs-var">partyFromChain</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679999783"><span class="hs-identifier hs-var">onChainParty</span></a></span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span>  </span><span id="local-6989586621679999779"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999779"><span class="hs-identifier hs-var">committed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-792"></span><span>    </span><span class="hs-comment">-- TODO: We could simplify this by just using the datum. However, we would</span><span>
</span><span id="line-793"></span><span>    </span><span class="hs-comment">-- need to ensure the commit is belonging to a head / is rightful. By just</span><span>
</span><span id="line-794"></span><span>    </span><span class="hs-comment">-- looking for some known initials we achieve this (a bit complicated) now.</span><span>
</span><span id="line-795"></span><span>    </span><span id="local-6989586621679999778"><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621679999778"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Commit -&gt; Maybe (TxIn, TxOut CtxUTxO))
-&gt; [Commit] -&gt; Maybe [(TxIn, TxOut CtxUTxO)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network -&gt; Commit -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">Commit.deserializeCommit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; Network
</span><span class="hs-identifier hs-var">networkIdToNetwork</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679999795"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621679999782"><span class="hs-identifier hs-var">onChainCommits</span></a></span><span>
</span><span id="line-796"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe () -&gt; Maybe ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; TxIn)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; [TxIn]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621679999778"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; [TxIn] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679999790"><span class="hs-identifier hs-var">committedTxIns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe () -&gt; Maybe ()) -&gt; Maybe () -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-797"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Maybe ()
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TODO: commit redeemer not matching the serialized commits in commit datum&quot;</span></span><span>
</span><span id="line-798"></span><span>    </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO) -&gt; Maybe (UTxO' (TxOut CtxUTxO))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO' (TxOut CtxUTxO) -&gt; Maybe (UTxO' (TxOut CtxUTxO)))
-&gt; ([(TxIn, TxOut CtxUTxO)] -&gt; UTxO' (TxOut CtxUTxO))
-&gt; [(TxIn, TxOut CtxUTxO)]
-&gt; Maybe (UTxO' (TxOut CtxUTxO))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)] -&gt; UTxO' (TxOut CtxUTxO)
forall out. [(TxIn, out)] -&gt; UTxO' out
</span><span class="hs-identifier hs-var">UTxO.fromPairs</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO)] -&gt; Maybe (UTxO' (TxOut CtxUTxO)))
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; Maybe (UTxO' (TxOut CtxUTxO))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621679999778"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><span class="annottext">CommitObservation -&gt; Maybe CommitObservation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span class="annot"><span class="annottext">CommitObservation :: UTxOWithScript
-&gt; Party -&gt; UTxO' (TxOut CtxUTxO) -&gt; CommitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-802"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:commitOutput:CommitObservation :: UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcommitOutput%3ACommitObservation"><span class="hs-identifier hs-var">commitOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999788"><span class="hs-identifier hs-var">commitIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx -&gt; TxOut CtxUTxO
forall (f :: * -&gt; * -&gt; *) era.
ToUTxOContext f =&gt;
f CtxTx era -&gt; f CtxUTxO era
</span><span class="hs-identifier hs-var">toUTxOContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx
</span><a href="#local-6989586621679999787"><span class="hs-identifier hs-var">commitOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999784"><span class="hs-identifier hs-var">dat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Party
party :: Party
$sel:party:CommitObservation :: Party
</span><a href="#local-6989586621679999780"><span class="hs-identifier hs-var hs-var">party</span></a></span><span>
</span><span id="line-804"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
committed :: UTxO' (TxOut CtxUTxO)
$sel:committed:CommitObservation :: UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999779"><span class="hs-identifier hs-var hs-var">committed</span></a></span><span>
</span><span id="line-805"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-806"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-807"></span><span>  </span><span id="local-6989586621679999791"><span class="annot"><span class="annottext">findInitialTxIn :: Maybe TxIn
</span><a href="#local-6989586621679999791"><span class="hs-identifier hs-var hs-var">findInitialTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; Bool) -&gt; [TxIn] -&gt; [TxIn]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; [TxIn] -&gt; Bool
forall (f :: * -&gt; *) a.
(Foldable f, DisallowElem f, Eq a) =&gt;
a -&gt; f a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679999794"><span class="hs-identifier hs-var">initials</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; [TxIn]
forall era. Tx era -&gt; [TxIn]
</span><span class="hs-identifier hs-var">txIns'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999793"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-809"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621679999771"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999771"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Maybe TxIn
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999771"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-810"></span><span>      </span><span class="annot"><span class="annottext">[TxIn]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TxIn
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span>  </span><span id="local-6989586621679999789"><span class="annot"><span class="annottext">decodeInitialRedeemer :: TxIn -&gt; Maybe [TxIn]
</span><a href="#local-6989586621679999789"><span class="hs-identifier hs-var hs-var">decodeInitialRedeemer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-813"></span><span>    </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe RedeemerType
forall a. FromScriptData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999793"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; Maybe RedeemerType)
-&gt; (RedeemerType -&gt; Maybe [TxIn]) -&gt; TxIn -&gt; Maybe [TxIn]
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-814"></span><span>      </span><span class="annot"><span class="annottext">RedeemerType
</span><span class="hs-identifier hs-var">Initial.ViaAbort</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><span class="annottext">Maybe [TxIn]
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-816"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Initial.ViaCommit</span></span><span class="hs-special">{</span><span id="local-6989586621679999768"><span class="annot"><span class="annottext">[TxOutRef]
committedRefs :: RedeemerType -&gt; [TxOutRef]
committedRefs :: [TxOutRef]
</span><span class="hs-identifier hs-var hs-var">committedRefs</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-817"></span><span>        </span><span class="annot"><span class="annottext">[TxIn] -&gt; Maybe [TxIn]
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; TxIn
</span><span class="hs-identifier hs-var">fromPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; TxIn) -&gt; [TxOutRef] -&gt; [TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679999768"><span class="hs-identifier hs-var">committedRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>  </span><span id="local-6989586621679999785"><span class="annot"><span class="annottext">commitAddress :: AddressInEra
</span><a href="#local-6989586621679999785"><span class="hs-identifier hs-var hs-var">commitAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679999795"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999766"><span class="hs-identifier hs-var">commitScript</span></a></span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>  </span><span id="local-6989586621679999766"><span class="annot"><span class="annottext">commitScript :: PlutusScript lang
</span><a href="#local-6989586621679999766"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="hs-keyword">data</span><span> </span><span id="CollectComObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-var">CollectComObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CollectComObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-var">CollectComObservation</span></a></span></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AthreadOutput%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; OpenThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">threadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span>
</span><span id="line-825"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-826"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AutxoHash%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AutxoHash%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999756"><span id="local-6989586621679999758"><span id="local-6989586621679999760"><span class="annot"><span class="annottext">Int -&gt; CollectComObservation -&gt; ShowS
[CollectComObservation] -&gt; ShowS
CollectComObservation -&gt; String
(Int -&gt; CollectComObservation -&gt; ShowS)
-&gt; (CollectComObservation -&gt; String)
-&gt; ([CollectComObservation] -&gt; ShowS)
-&gt; Show CollectComObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CollectComObservation] -&gt; ShowS
$cshowList :: [CollectComObservation] -&gt; ShowS
show :: CollectComObservation -&gt; String
$cshow :: CollectComObservation -&gt; String
showsPrec :: Int -&gt; CollectComObservation -&gt; ShowS
$cshowsPrec :: Int -&gt; CollectComObservation -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999752"><span id="local-6989586621679999754"><span class="annot"><span class="annottext">CollectComObservation -&gt; CollectComObservation -&gt; Bool
(CollectComObservation -&gt; CollectComObservation -&gt; Bool)
-&gt; (CollectComObservation -&gt; CollectComObservation -&gt; Bool)
-&gt; Eq CollectComObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
$c/= :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
== :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
$c== :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="hs-comment">-- | Identify a collectCom tx by lookup up the input spending the Head output</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- and decoding its redeemer.</span><span>
</span><span id="line-832"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-type">observeCollectComTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span><span>
</span><span id="line-834"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-835"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-836"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-837"></span><span id="observeCollectComTx"><span class="annot"><span class="annottext">observeCollectComTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CollectComObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-var hs-var">observeCollectComTx</span></a></span></span><span> </span><span id="local-6989586621679999750"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999750"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679999749"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999749"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-838"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999748"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999748"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999747"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999747"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999750"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999745"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-839"></span><span>  </span><span id="local-6989586621679999744"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679999744"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromScriptData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999749"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999748"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-840"></span><span>  </span><span id="local-6989586621679999743"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999743"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxOut CtxUTxO -&gt; Maybe ScriptRedeemer
forall era.
(UsesStandardCrypto era, Typeable (ShelleyLedgerEra era)) =&gt;
Tx era -&gt; TxOut CtxUTxO era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">lookupScriptData</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999749"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999747"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-841"></span><span>  </span><span id="local-6989586621679999741"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999741"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe State
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999743"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-842"></span><span>  </span><span id="local-6989586621679999740"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621679999740"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999747"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999741"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679999744"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-844"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Initial</span></span><span class="hs-special">{</span><span id="local-6989586621679999738"><span class="annot"><span class="annottext">[Party]
parties :: [Party]
$sel:parties:Initial :: State -&gt; [Party]
</span><a href="#local-6989586621679999738"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999737"><span class="annot"><span class="annottext">ContestationPeriod
contestationPeriod :: ContestationPeriod
$sel:contestationPeriod:Initial :: State -&gt; ContestationPeriod
</span><a href="#local-6989586621679999737"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.CollectCom</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-845"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679999736"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999736"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999735"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999735"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999749"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999745"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-846"></span><span>      </span><span id="local-6989586621679999733"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999733"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxOut CtxUTxO -&gt; Maybe ScriptRedeemer
forall era.
(UsesStandardCrypto era, Typeable (ShelleyLedgerEra era)) =&gt;
Tx era -&gt; TxOut CtxUTxO era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">lookupScriptData</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999749"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999735"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-847"></span><span>      </span><span id="local-6989586621679999732"><span class="annot"><span class="annottext">UTxOHash
</span><a href="#local-6989586621679999732"><span class="hs-identifier hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; UTxOHash) -&gt; Maybe ByteString -&gt; Maybe UTxOHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe ByteString
</span><a href="#local-6989586621679999731"><span class="hs-identifier hs-var">decodeUtxoHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999733"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-848"></span><span>      </span><span class="annot"><span class="annottext">CollectComObservation -&gt; Maybe CollectComObservation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-849"></span><span>        </span><span class="annot"><span class="annottext">CollectComObservation :: OpenThreadOutput -&gt; HeadId -&gt; UTxOHash -&gt; CollectComObservation
</span><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-850"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:threadOutput:CollectComObservation :: OpenThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACollectComObservation"><span class="hs-identifier hs-var">threadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-851"></span><span>              </span><span class="annot"><span class="annottext">OpenThreadOutput :: UTxOWithScript -&gt; ContestationPeriod -&gt; [Party] -&gt; OpenThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#OpenThreadOutput"><span class="hs-identifier hs-type">OpenThreadOutput</span></a></span><span>
</span><span id="line-852"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:openThreadUTxO:OpenThreadOutput :: UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenThreadUTxO%3AOpenThreadOutput"><span class="hs-identifier hs-var">openThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-853"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999736"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span>
</span><span id="line-854"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999735"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-855"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999733"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-856"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:openParties:OpenThreadOutput :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenParties%3AOpenThreadOutput"><span class="hs-identifier hs-var">openParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999738"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-858"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:openContestationPeriod:OpenThreadOutput :: ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AopenContestationPeriod%3AOpenThreadOutput"><span class="hs-identifier hs-var">openContestationPeriod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679999737"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-859"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-860"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
headId :: HeadId
$sel:headId:CollectComObservation :: HeadId
</span><a href="#local-6989586621679999740"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-861"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxOHash
utxoHash :: UTxOHash
$sel:utxoHash:CollectComObservation :: UTxOHash
</span><a href="#local-6989586621679999732"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span><span>
</span><span id="line-862"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-863"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CollectComObservation
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-864"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-865"></span><span>  </span><span id="local-6989586621679999745"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621679999745"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-866"></span><span>  </span><span id="local-6989586621679999731"><span class="annot"><span class="annottext">decodeUtxoHash :: ScriptRedeemer -&gt; Maybe ByteString
</span><a href="#local-6989586621679999731"><span class="hs-identifier hs-var hs-var">decodeUtxoHash</span></a></span></span><span> </span><span id="local-6989586621679999730"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999730"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe State
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999730"><span class="hs-identifier hs-var">datum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-868"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span class="hs-special">{</span><span id="local-6989586621679999729"><span class="annot"><span class="annottext">BuiltinByteString
utxoHash :: BuiltinByteString
$sel:utxoHash:Initial :: State -&gt; BuiltinByteString
</span><a href="#local-6989586621679999729"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ByteString
forall arep a. FromBuiltin arep a =&gt; arep -&gt; a
</span><span class="hs-identifier hs-var">fromBuiltin</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679999729"><span class="hs-identifier hs-var">utxoHash</span></a></span><span>
</span><span id="line-869"></span><span>      </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span class="hs-keyword">data</span><span> </span><span id="CloseObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-var">CloseObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CloseObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-var">CloseObservation</span></a></span></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AthreadOutput%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; ClosedThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACloseObservation"><span class="hs-identifier hs-var hs-var">threadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACloseObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-874"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseObservation"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier hs-type">SnapshotNumber</span></a></span><span>
</span><span id="line-875"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-876"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999719"><span id="local-6989586621679999721"><span id="local-6989586621679999723"><span class="annot"><span class="annottext">Int -&gt; CloseObservation -&gt; ShowS
[CloseObservation] -&gt; ShowS
CloseObservation -&gt; String
(Int -&gt; CloseObservation -&gt; ShowS)
-&gt; (CloseObservation -&gt; String)
-&gt; ([CloseObservation] -&gt; ShowS)
-&gt; Show CloseObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CloseObservation] -&gt; ShowS
$cshowList :: [CloseObservation] -&gt; ShowS
show :: CloseObservation -&gt; String
$cshow :: CloseObservation -&gt; String
showsPrec :: Int -&gt; CloseObservation -&gt; ShowS
$cshowsPrec :: Int -&gt; CloseObservation -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999715"><span id="local-6989586621679999717"><span class="annot"><span class="annottext">CloseObservation -&gt; CloseObservation -&gt; Bool
(CloseObservation -&gt; CloseObservation -&gt; Bool)
-&gt; (CloseObservation -&gt; CloseObservation -&gt; Bool)
-&gt; Eq CloseObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CloseObservation -&gt; CloseObservation -&gt; Bool
$c/= :: CloseObservation -&gt; CloseObservation -&gt; Bool
== :: CloseObservation -&gt; CloseObservation -&gt; Bool
$c== :: CloseObservation -&gt; CloseObservation -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span class="hs-comment">-- | Identify a close tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-879"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-880"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-type">observeCloseTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span><span>
</span><span id="line-882"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-883"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-884"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-885"></span><span id="observeCloseTx"><span class="annot"><span class="annottext">observeCloseTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe CloseObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-var hs-var">observeCloseTx</span></a></span></span><span> </span><span id="local-6989586621679999713"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999713"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679999712"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999712"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-886"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999711"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999711"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999710"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999710"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999713"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999709"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-887"></span><span>  </span><span id="local-6989586621679999708"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679999708"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromScriptData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999712"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999711"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-888"></span><span>  </span><span id="local-6989586621679999707"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999707"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxOut CtxUTxO -&gt; Maybe ScriptRedeemer
forall era.
(UsesStandardCrypto era, Typeable (ShelleyLedgerEra era)) =&gt;
Tx era -&gt; TxOut CtxUTxO era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">lookupScriptData</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999712"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999710"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-889"></span><span>  </span><span id="local-6989586621679999706"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999706"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe State
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999707"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-890"></span><span>  </span><span id="local-6989586621679999705"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621679999705"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999710"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-891"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999706"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679999708"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-892"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span class="hs-special">{</span><span id="local-6989586621679999704"><span class="annot"><span class="annottext">[Party]
parties :: [Party]
$sel:parties:Initial :: State -&gt; [Party]
</span><a href="#local-6989586621679999704"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Close</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-893"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679999703"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999703"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999702"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999702"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999712"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999709"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-894"></span><span>      </span><span id="local-6989586621679999701"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999701"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxOut CtxUTxO -&gt; Maybe ScriptRedeemer
forall era.
(UsesStandardCrypto era, Typeable (ShelleyLedgerEra era)) =&gt;
Tx era -&gt; TxOut CtxUTxO era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">lookupScriptData</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999712"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999702"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-895"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679999700"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679999700"><span class="hs-identifier hs-var">closeContestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999699"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679999699"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe State
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999701"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-896"></span><span>        </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span class="hs-special">{</span><span id="local-6989586621679999698"><span class="annot"><span class="annottext">POSIXTime
contestationDeadline :: POSIXTime
$sel:contestationDeadline:Initial :: State -&gt; POSIXTime
</span><a href="#local-6989586621679999698"><span class="hs-identifier hs-var hs-var">contestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999697"><span class="annot"><span class="annottext">Integer
snapshotNumber :: Integer
$sel:snapshotNumber:Initial :: State -&gt; Integer
</span><a href="#local-6989586621679999697"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(POSIXTime, Integer) -&gt; Maybe (POSIXTime, Integer)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679999698"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679999697"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>        </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (POSIXTime, Integer)
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-898"></span><span>      </span><span class="annot"><span class="annottext">CloseObservation -&gt; Maybe CloseObservation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-899"></span><span>        </span><span class="annot"><span class="annottext">CloseObservation :: ClosedThreadOutput -&gt; HeadId -&gt; SnapshotNumber -&gt; CloseObservation
</span><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-900"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:threadOutput:CloseObservation :: ClosedThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACloseObservation"><span class="hs-identifier hs-var">threadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-901"></span><span>              </span><span class="annot"><span class="annottext">ClosedThreadOutput :: UTxOWithScript
-&gt; [Party] -&gt; POSIXTime -&gt; [PubKeyHash] -&gt; ClosedThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#ClosedThreadOutput"><span class="hs-identifier hs-type">ClosedThreadOutput</span></a></span><span>
</span><span id="line-902"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:closedThreadUTxO:ClosedThreadOutput :: UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedThreadUTxO%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-903"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999703"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span>
</span><span id="line-904"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999702"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-905"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999701"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-906"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedParties:ClosedThreadOutput :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedParties%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679999704"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-908"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedContestationDeadline:ClosedThreadOutput :: POSIXTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContestationDeadline%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedContestationDeadline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621679999700"><span class="hs-identifier hs-var">closeContestationDeadline</span></a></span><span>
</span><span id="line-909"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedContesters:ClosedThreadOutput :: [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AclosedContesters%3AClosedThreadOutput"><span class="hs-identifier hs-var">closedContesters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-910"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-911"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
headId :: HeadId
$sel:headId:CloseObservation :: HeadId
</span><a href="#local-6989586621679999705"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-912"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:CloseObservation :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseObservation"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotNumber
</span><a href="Hydra.Snapshot.html#fromChainSnapshot"><span class="hs-identifier hs-var">fromChainSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679999699"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span><span>
</span><span id="line-913"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-914"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CloseObservation
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-915"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-916"></span><span>  </span><span id="local-6989586621679999709"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621679999709"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span class="hs-keyword">data</span><span> </span><span id="ContestObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-var">ContestObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ContestObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-var">ContestObservation</span></a></span></span><span>
</span><span id="line-919"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="hs-identifier hs-var hs-var">contestedThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AContestObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3AContestObservation"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Snapshot.html#SnapshotNumber"><span class="hs-identifier hs-type">SnapshotNumber</span></a></span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acontesters%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acontesters%3AContestObservation"><span class="hs-identifier hs-var hs-var">contesters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.PubKeyHash</span></span><span class="hs-special">]</span><span>
</span><span id="line-923"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-924"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679999686"><span id="local-6989586621679999688"><span id="local-6989586621679999690"><span class="annot"><span class="annottext">Int -&gt; ContestObservation -&gt; ShowS
[ContestObservation] -&gt; ShowS
ContestObservation -&gt; String
(Int -&gt; ContestObservation -&gt; ShowS)
-&gt; (ContestObservation -&gt; String)
-&gt; ([ContestObservation] -&gt; ShowS)
-&gt; Show ContestObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ContestObservation] -&gt; ShowS
$cshowList :: [ContestObservation] -&gt; ShowS
show :: ContestObservation -&gt; String
$cshow :: ContestObservation -&gt; String
showsPrec :: Int -&gt; ContestObservation -&gt; ShowS
$cshowsPrec :: Int -&gt; ContestObservation -&gt; ShowS
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999682"><span id="local-6989586621679999684"><span class="annot"><span class="annottext">ContestObservation -&gt; ContestObservation -&gt; Bool
(ContestObservation -&gt; ContestObservation -&gt; Bool)
-&gt; (ContestObservation -&gt; ContestObservation -&gt; Bool)
-&gt; Eq ContestObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ContestObservation -&gt; ContestObservation -&gt; Bool
$c/= :: ContestObservation -&gt; ContestObservation -&gt; Bool
== :: ContestObservation -&gt; ContestObservation -&gt; Bool
$c== :: ContestObservation -&gt; ContestObservation -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span class="hs-comment">-- | Identify a close tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-927"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-928"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-type">observeContestTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-929"></span><span>  </span><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span><span>
</span><span id="line-930"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-931"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-932"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-933"></span><span id="observeContestTx"><span class="annot"><span class="annottext">observeContestTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe ContestObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-var hs-var">observeContestTx</span></a></span></span><span> </span><span id="local-6989586621679999680"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999680"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679999679"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999679"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679999678"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999678"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999677"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999677"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999680"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999676"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-935"></span><span>  </span><span id="local-6989586621679999675"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679999675"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromScriptData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999679"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999678"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-936"></span><span>  </span><span id="local-6989586621679999674"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999674"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxOut CtxUTxO -&gt; Maybe ScriptRedeemer
forall era.
(UsesStandardCrypto era, Typeable (ShelleyLedgerEra era)) =&gt;
Tx era -&gt; TxOut CtxUTxO era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">lookupScriptData</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999679"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999677"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-937"></span><span>  </span><span id="local-6989586621679999673"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999673"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe State
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999674"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-938"></span><span>  </span><span id="local-6989586621679999672"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621679999672"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999677"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-939"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679999673"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679999675"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-940"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span class="hs-special">{</span><span id="local-6989586621679999671"><span class="annot"><span class="annottext">[PubKeyHash]
contesters :: [PubKeyHash]
$sel:contesters:Initial :: State -&gt; [PubKeyHash]
</span><a href="#local-6989586621679999671"><span class="hs-identifier hs-var hs-var">contesters</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Contest</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-941"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679999670"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999670"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999669"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999669"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO' (TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999679"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999676"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-942"></span><span>      </span><span id="local-6989586621679999668"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999668"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxOut CtxUTxO -&gt; Maybe ScriptRedeemer
forall era.
(UsesStandardCrypto era, Typeable (ShelleyLedgerEra era)) =&gt;
Tx era -&gt; TxOut CtxUTxO era -&gt; Maybe ScriptRedeemer
</span><span class="hs-identifier hs-var">lookupScriptData</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999679"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999669"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-943"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679999667"><span class="annot"><span class="annottext">onChainSnapshotNumber :: Integer
</span><a href="#local-6989586621679999667"><span class="hs-identifier hs-var hs-var">onChainSnapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Integer
</span><a href="#local-6989586621679999666"><span class="hs-identifier hs-var">closedSnapshotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999668"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-944"></span><span>      </span><span class="annot"><span class="annottext">ContestObservation -&gt; Maybe ContestObservation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-945"></span><span>        </span><span class="annot"><span class="annottext">ContestObservation :: UTxOWithScript
-&gt; HeadId -&gt; SnapshotNumber -&gt; [PubKeyHash] -&gt; ContestObservation
</span><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-946"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:contestedThreadOutput:ContestObservation :: UTxOWithScript
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="hs-identifier hs-var">contestedThreadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-947"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999670"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span>
</span><span id="line-948"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679999669"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-949"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999668"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-950"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
headId :: HeadId
$sel:headId:ContestObservation :: HeadId
</span><a href="#local-6989586621679999672"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-952"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:ContestObservation :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3AContestObservation"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotNumber
</span><a href="Hydra.Snapshot.html#fromChainSnapshot"><span class="hs-identifier hs-var">fromChainSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679999667"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span><span>
</span><span id="line-953"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
contesters :: [PubKeyHash]
$sel:contesters:ContestObservation :: [PubKeyHash]
</span><a href="#local-6989586621679999671"><span class="hs-identifier hs-var hs-var">contesters</span></a></span><span>
</span><span id="line-954"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-955"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ContestObservation
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-956"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-957"></span><span>  </span><span id="local-6989586621679999676"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621679999676"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span>  </span><span id="local-6989586621679999666"><span class="annot"><span class="annottext">closedSnapshotNumber :: ScriptRedeemer -&gt; Integer
</span><a href="#local-6989586621679999666"><span class="hs-identifier hs-var hs-var">closedSnapshotNumber</span></a></span></span><span> </span><span id="local-6989586621679999665"><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999665"><span class="hs-identifier hs-var">headDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-960"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer -&gt; Maybe State
forall a. FromScriptData a =&gt; ScriptRedeemer -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">ScriptRedeemer
</span><a href="#local-6989586621679999665"><span class="hs-identifier hs-var">headDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-961"></span><span>      </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span class="hs-special">{</span><span id="local-6989586621679999664"><span class="annot"><span class="annottext">Integer
snapshotNumber :: Integer
$sel:snapshotNumber:Initial :: State -&gt; Integer
</span><a href="#local-6989586621679999664"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679999664"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span>
</span><span id="line-962"></span><span>      </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;wrong state in output datum&quot;</span></span><span>
</span><span id="line-963"></span><span>
</span><span id="line-964"></span><span class="hs-keyword">data</span><span> </span><span id="FanoutObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-var">FanoutObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FanoutObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-var">FanoutObservation</span></a></span></span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span class="hs-comment">-- | Identify a fanout tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-967"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-968"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-type">observeFanoutTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-969"></span><span>  </span><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span><span>
</span><span id="line-970"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-971"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-972"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span><span>
</span><span id="line-973"></span><span id="observeFanoutTx"><span class="annot"><span class="annottext">observeFanoutTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe FanoutObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-var hs-var">observeFanoutTx</span></a></span></span><span> </span><span id="local-6989586621679999661"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999661"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679999660"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999660"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-974"></span><span>  </span><span id="local-6989586621679999659"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999659"><span class="hs-identifier hs-var">headInput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; TxIn)
-&gt; Maybe (TxIn, TxOut CtxUTxO) -&gt; Maybe TxIn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999661"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999658"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-975"></span><span>  </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromScriptData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999660"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999659"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-976"></span><span>    </span><span class="annot"><span class="annottext">Maybe Input
-&gt; (Input -&gt; Maybe FanoutObservation) -&gt; Maybe FanoutObservation
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-977"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Fanout</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FanoutObservation -&gt; Maybe FanoutObservation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">FanoutObservation
</span><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-var">FanoutObservation</span></a></span><span>
</span><span id="line-978"></span><span>      </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe FanoutObservation
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-979"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-980"></span><span>  </span><span id="local-6989586621679999658"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621679999658"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span class="hs-keyword">data</span><span> </span><span id="AbortObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AbortObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span class="hs-comment">-- | Identify an abort tx by looking up the input spending the Head output and</span><span>
</span><span id="line-985"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-986"></span><span class="hs-comment">-- FIXME: Add headId to AbortObservation to allow &quot;upper layers&quot; to</span><span>
</span><span id="line-987"></span><span class="hs-comment">-- determine we are seeing an abort of &quot;our head&quot;</span><span>
</span><span id="line-988"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-type">observeAbortTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-989"></span><span>  </span><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span><span>
</span><span id="line-990"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-991"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-992"></span><span>  </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-type">AbortObservation</span></a></span><span>
</span><span id="line-993"></span><span id="observeAbortTx"><span class="annot"><span class="annottext">observeAbortTx :: UTxO' (TxOut CtxUTxO) -&gt; Tx -&gt; Maybe AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-var hs-var">observeAbortTx</span></a></span></span><span> </span><span id="local-6989586621679999655"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999655"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679999654"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999654"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-994"></span><span>  </span><span id="local-6989586621679999653"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999653"><span class="hs-identifier hs-var">headInput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO) -&gt; TxIn)
-&gt; Maybe (TxIn, TxOut CtxUTxO) -&gt; Maybe TxIn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO' (TxOut CtxUTxO)
-&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO)
</span><a href="#local-6989586621679999655"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript
forall lang. PlutusScript lang
</span><a href="#local-6989586621679999652"><span class="hs-identifier hs-var">headScript</span></a></span><span>
</span><span id="line-995"></span><span>  </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromScriptData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679999654"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679999653"><span class="hs-identifier hs-var">headInput</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Input
-&gt; (Input -&gt; Maybe AbortObservation) -&gt; Maybe AbortObservation
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-996"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.Abort</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AbortObservation -&gt; Maybe AbortObservation
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span><span>
</span><span id="line-997"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe AbortObservation
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-998"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-999"></span><span>  </span><span id="local-6989586621679999652"><span class="annot"><span class="annottext">headScript :: PlutusScript lang
</span><a href="#local-6989586621679999652"><span class="hs-identifier hs-var hs-var">headScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SerialisedScript -&gt; PlutusScript lang
forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span class="hs-comment">-- * Helpers</span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-type">mkHeadId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span>
</span><span id="line-1004"></span><span id="mkHeadId"><span class="annot"><span class="annottext">mkHeadId :: PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var hs-var">mkHeadId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1005"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; HeadId
</span><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-var">HeadId</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; HeadId)
-&gt; (PolicyId -&gt; ByteString) -&gt; PolicyId -&gt; HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialiseToRawBytes</span></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-type">headIdToCurrencySymbol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CurrencySymbol</span></span><span>
</span><span id="line-1008"></span><span id="headIdToCurrencySymbol"><span class="annot"><span class="annottext">headIdToCurrencySymbol :: HeadId -&gt; CurrencySymbol
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToCurrencySymbol"><span class="hs-identifier hs-var hs-var">headIdToCurrencySymbol</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span><span> </span><span id="local-6989586621679999650"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679999650"><span class="hs-identifier hs-var">headId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinByteString -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">CurrencySymbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; BuiltinByteString
forall a arep. ToBuiltin a arep =&gt; a -&gt; arep
</span><span class="hs-identifier hs-var">toBuiltin</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679999650"><span class="hs-identifier hs-var">headId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-type">headTokensFromValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PlutusScript</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Quantity</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1011"></span><span id="headTokensFromValue"><span class="annot"><span class="annottext">headTokensFromValue :: PlutusScript -&gt; Value -&gt; [(AssetName, Quantity)]
</span><a href="Hydra.Chain.Direct.Tx.html#headTokensFromValue"><span class="hs-identifier hs-var hs-var">headTokensFromValue</span></a></span></span><span> </span><span id="local-6989586621679999649"><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999649"><span class="hs-identifier hs-var">headTokenScript</span></a></span></span><span> </span><span id="local-6989586621679999648"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679999648"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1012"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999647"><span class="hs-identifier hs-var">assetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679999646"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1013"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621679999645"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999645"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621679999647"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999647"><span class="hs-identifier hs-var">assetName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999646"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679999646"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">valueToList</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679999648"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999645"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Script PlutusScriptV2 -&gt; PolicyId
forall lang. Script lang -&gt; PolicyId
</span><span class="hs-identifier hs-var">scriptPolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PlutusScript -&gt; Script PlutusScriptV2
</span><span class="hs-identifier hs-var">PlutusScript</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript
</span><a href="#local-6989586621679999649"><span class="hs-identifier hs-var">headTokenScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1015"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#assetNameFromVerificationKey"><span class="hs-identifier hs-type">assetNameFromVerificationKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span>
</span><span id="line-1018"></span><span id="assetNameFromVerificationKey"><span class="annot"><span class="annottext">assetNameFromVerificationKey :: VerificationKey PaymentKey -&gt; AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#assetNameFromVerificationKey"><span class="hs-identifier hs-var hs-var">assetNameFromVerificationKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1019"></span><span>  </span><span class="annot"><span class="annottext">ByteString -&gt; AssetName
</span><span class="hs-identifier hs-var">AssetName</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; AssetName)
-&gt; (VerificationKey PaymentKey -&gt; ByteString)
-&gt; VerificationKey PaymentKey
-&gt; AssetName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; ByteString
forall a. SerialiseAsRawBytes a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialiseToRawBytes</span></span><span> </span><span class="annot"><span class="annottext">(Hash PaymentKey -&gt; ByteString)
-&gt; (VerificationKey PaymentKey -&gt; Hash PaymentKey)
-&gt; VerificationKey PaymentKey
-&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span>
</span><span id="line-1020"></span><span>
</span><span id="line-1021"></span><span class="hs-comment">-- | Find first occurrence including a transformation.</span><span>
</span><span id="line-1022"></span><span id="local-6989586621680000435"><span id="local-6989586621680000436"><span id="local-6989586621680000437"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-type">findFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680000437"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680000436"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680000435"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680000437"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680000436"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680000435"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-1023"></span><span id="findFirst"><span class="annot"><span class="annottext">findFirst :: (a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-var hs-var">findFirst</span></a></span></span><span> </span><span id="local-6989586621679999641"><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621679999641"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">First b -&gt; Maybe b
forall a. First a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">getFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(First b -&gt; Maybe b) -&gt; (t a -&gt; First b) -&gt; t a -&gt; Maybe b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; First b) -&gt; t a -&gt; First b
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe b -&gt; First b
forall a. Maybe a -&gt; First a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe b -&gt; First b) -&gt; (a -&gt; Maybe b) -&gt; a -&gt; First b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621679999641"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span id="local-6989586621680000356"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-type">findHeadAssetId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680000356"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1026"></span><span id="findHeadAssetId"><span class="annot"><span class="annottext">findHeadAssetId :: TxOut ctx -&gt; Maybe (PolicyId, AssetName)
</span><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-var hs-var">findHeadAssetId</span></a></span></span><span> </span><span id="local-6989586621679999637"><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621679999637"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1027"></span><span>  </span><span class="annot"><span class="annottext">(((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
 -&gt; [(AssetId, Quantity)] -&gt; Maybe (PolicyId, AssetName))
-&gt; [(AssetId, Quantity)]
-&gt; ((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; Maybe (PolicyId, AssetName)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; [(AssetId, Quantity)] -&gt; Maybe (PolicyId, AssetName)
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><a href="Hydra.Chain.Direct.Tx.html#findFirst"><span class="hs-identifier hs-var">findFirst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">valueToList</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetId, Quantity)]) -&gt; Value -&gt; [(AssetId, Quantity)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621679999637"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
 -&gt; Maybe (PolicyId, AssetName))
-&gt; ((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; Maybe (PolicyId, AssetName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1028"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621679999635"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999635"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621679999634"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999634"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679999633"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679999633"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999634"><span class="hs-identifier hs-var">aname</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="Hydra.Chain.Direct.Tx.html#hydraHeadV1AssetName"><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621679999633"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1030"></span><span>          </span><span class="annot"><span class="annottext">(PolicyId, AssetName) -&gt; Maybe (PolicyId, AssetName)
forall a. a -&gt; Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679999635"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679999634"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1031"></span><span>    </span><span class="annot"><span class="annottext">(AssetId, Quantity)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1032"></span><span>      </span><span class="annot"><span class="annottext">Maybe (PolicyId, AssetName)
forall a. Maybe a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span class="hs-comment">-- | Find (if it exists) the head identifier contained in given `TxOut`.</span><span>
</span><span id="line-1035"></span><span id="local-6989586621680000386"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-type">findStateToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680000386"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.html#HeadId"><span class="hs-identifier hs-type">HeadId</span></a></span></span><span>
</span><span id="line-1036"></span><span id="findStateToken"><span class="annot"><span class="annottext">findStateToken :: TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var hs-var">findStateToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1037"></span><span>  </span><span class="annot"><span class="annottext">((PolicyId, AssetName) -&gt; HeadId)
-&gt; Maybe (PolicyId, AssetName) -&gt; Maybe HeadId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#mkHeadId"><span class="hs-identifier hs-var">mkHeadId</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyId -&gt; HeadId)
-&gt; ((PolicyId, AssetName) -&gt; PolicyId)
-&gt; (PolicyId, AssetName)
-&gt; HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyId, AssetName) -&gt; PolicyId
forall a b. (a, b) -&gt; a
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (PolicyId, AssetName) -&gt; Maybe HeadId)
-&gt; (TxOut ctx -&gt; Maybe (PolicyId, AssetName))
-&gt; TxOut ctx
-&gt; Maybe HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/dfjkypyaw967idcp0h3l5kydwc5ycvlx-ghc-8.10.7-doc/share/doc/ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx -&gt; Maybe (PolicyId, AssetName)
forall ctx. TxOut ctx -&gt; Maybe (PolicyId, AssetName)
</span><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-var">findHeadAssetId</span></a></span><span>
</span><span id="line-1038"></span></pre></body></html>