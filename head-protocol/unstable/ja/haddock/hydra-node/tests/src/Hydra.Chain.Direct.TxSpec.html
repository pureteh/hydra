<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Unit tests for our &quot;hand-rolled&quot; transactions as they are used in the</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- &quot;direct&quot; chain component.</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Chain.Direct.TxSpec</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.Tx</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-keyword">label</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Prelude</span></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Babbage.PParams</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BabbagePParams</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">GHC.Natural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">wordToNatural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">renderTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeadParameters</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Contract.Gen.html"><span class="hs-identifier">Hydra.Chain.Direct.Contract.Gen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.Direct.Contract.Gen.html#genForParty"><span class="hs-identifier">genForParty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.Fixture</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="hs-identifier">epochInfo</span></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-identifier">pparams</span></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><span class="hs-identifier">systemStart</span></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-identifier">testNetworkId</span></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">testPolicyId</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-identifier">testSeedInput</span></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.ScriptRegistry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">genScriptRegistry</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">registryUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.Wallet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ErrCoverFee</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">coverFee_</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UnsafeContestationPeriod</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Commit</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Commit</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadTokens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mkHeadTokenScript</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Initial</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Initial</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger.Cardano</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">adaOnly</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genOneUTxOFor</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">genVerificationKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger.Cardano.Evaluate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EvaluationReport</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maxTxExecutionUnits</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Party</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Cardano.Ledger.Alonzo.Serialisation.Generators</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Property</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">choose</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">counterexample</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elements</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forAll</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getPositive</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-keyword">label</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">property</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">vectorOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withMaxSuccess</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.Instances.Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#spec"><span class="hs-identifier hs-type">spec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec</span></span><span>
</span><span id="line-45"></span><span id="spec"><span class="annot"><span class="annottext">spec :: Spec
</span><a href="Hydra.Chain.Direct.TxSpec.html#spec"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="annottext">forall a. SpecWith a -&gt; SpecWith a
</span><span class="hs-identifier hs-var">parallel</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><span class="hs-identifier hs-var">describe</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;collectComTx&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-48"></span><span>      </span><span class="annot"><span class="annottext">forall prop.
(HasCallStack, Testable prop) =&gt;
String -&gt; prop -&gt; Spec
</span><span class="hs-identifier hs-var">prop</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cover fee correctly handles redeemers&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; Int -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">withMaxSuccess</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679415471"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415471"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span id="local-6989586621679415470"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415470"><span class="hs-identifier hs-var">cperiod</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415469"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415469"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621679415468"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415468"><span class="hs-identifier hs-var">parties</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679415467"><span class="annot"><span class="annottext">Map
  (TxIn StandardCrypto) (BabbageTxOut (BabbageEra StandardCrypto))
</span><a href="#local-6989586621679415467"><span class="hs-identifier hs-var">walletUTxO</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-50"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679415466"><span class="annot"><span class="annottext">allParties :: [Party]
</span><a href="#local-6989586621679415466"><span class="hs-identifier hs-var hs-var">allParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415469"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415468"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-51"></span><span>              </span><span id="local-6989586621679415465"><span class="annot"><span class="annottext">cardanoKeys :: [VerificationKey PaymentKey]
</span><a href="#local-6989586621679415465"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Gen a -&gt; Party -&gt; a
</span><a href="Hydra.Chain.Direct.Contract.Gen.html#genForParty"><span class="hs-identifier hs-var">genForParty</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415466"><span class="hs-identifier hs-var">allParties</span></a></span><span>
</span><span id="line-52"></span><span>          </span><span class="annot"><span class="annottext">forall a prop.
(Show a, Testable prop) =&gt;
Gen a -&gt; (a -&gt; prop) -&gt; Property
</span><span class="hs-identifier hs-var">forAll</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679415465"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679415463"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415463"><span class="hs-identifier hs-var">signer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-53"></span><span>            </span><span class="annot"><span class="annottext">forall a prop.
(Show a, Testable prop) =&gt;
Gen a -&gt; (a -&gt; prop) -&gt; Property
</span><span class="hs-identifier hs-var">forAll</span></span><span> </span><span class="annot"><span class="annottext">Gen ScriptRegistry
</span><span class="hs-identifier hs-var">genScriptRegistry</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679415462"><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679415462"><span class="hs-identifier hs-var">scriptRegistry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-54"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679415461"><span class="annot"><span class="annottext">params :: HeadParameters
</span><a href="#local-6989586621679415461"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; [Party] -&gt; HeadParameters
</span><span class="hs-identifier hs-var">HeadParameters</span></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415470"><span class="hs-identifier hs-var">cperiod</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415466"><span class="hs-identifier hs-var">allParties</span></a></span><span>
</span><span id="line-55"></span><span>                  </span><span id="local-6989586621679415459"><span class="annot"><span class="annottext">tx :: Tx Era
</span><a href="#local-6989586621679415459"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; [VerificationKey PaymentKey] -&gt; HeadParameters -&gt; TxIn -&gt; Tx Era
</span><span class="hs-identifier hs-var">initTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679415465"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span> </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621679415461"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415471"><span class="hs-identifier hs-var">txIn</span></a></span><span>
</span><span id="line-56"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; [VerificationKey PaymentKey]
-&gt; ContestationPeriod
-&gt; Party
-&gt; [Party]
-&gt; Tx Era
-&gt; Either NotAnInitReason InitObservation
</span><span class="hs-identifier hs-var">observeInitTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679415465"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415470"><span class="hs-identifier hs-var">cperiod</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415469"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415468"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415459"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-57"></span><span>                    </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">InitObservation</span></span><span class="hs-special">{</span><span id="local-6989586621679415455"><span class="annot"><span class="annottext">[UTxOWithScript]
$sel:initials:InitObservation :: InitObservation -&gt; [UTxOWithScript]
initials :: [UTxOWithScript]
</span><span class="hs-identifier hs-var hs-var">initials</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415453"><span class="annot"><span class="annottext">InitialThreadOutput
$sel:threadOutput:InitObservation :: InitObservation -&gt; InitialThreadOutput
threadOutput :: InitialThreadOutput
</span><span class="hs-identifier hs-var hs-var">threadOutput</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">InitialThreadOutput</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:initialThreadUTxO:InitialThreadOutput :: InitialThreadOutput -&gt; UTxOWithScript
</span><span class="hs-identifier hs-var">initialThreadUTxO</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415449"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415449"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415448"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415448"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415447"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679415447"><span class="hs-identifier hs-var">headDatum</span></a></span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InitialThreadOutput
</span><a href="#local-6989586621679415453"><span class="hs-identifier hs-var">threadOutput</span></a></span><span>
</span><span id="line-59"></span><span>                          </span><span id="local-6989586621679415446"><span class="annot"><span class="annottext">initials' :: Map TxIn (TxOut CtxUTxO, HashableScriptData)
</span><a href="#local-6989586621679415446"><span class="hs-identifier hs-var hs-var">initials'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415444"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415443"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679415442"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415444"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415444"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415443"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415443"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415442"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679415442"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UTxOWithScript]
</span><a href="#local-6989586621679415455"><span class="hs-identifier hs-var">initials</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-60"></span><span>                          </span><span id="local-6989586621679415441"><span class="annot"><span class="annottext">lookupUTxO :: Map
  (TxIn StandardCrypto) (BabbageTxOut (BabbageEra StandardCrypto))
</span><a href="#local-6989586621679415441"><span class="hs-identifier hs-var hs-var">lookupUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-61"></span><span>                            </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-62"></span><span>                              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415449"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415448"><span class="hs-identifier hs-var">headOutput</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415440"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415439"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415440"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415440"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415439"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415439"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UTxOWithScript]
</span><a href="#local-6989586621679415455"><span class="hs-identifier hs-var">initials</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall out. UTxO' out -&gt; Map TxIn out
</span><span class="hs-identifier hs-var">UTxO.toMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptRegistry -&gt; UTxO
</span><span class="hs-identifier hs-var">registryUTxO</span></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679415462"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>                              </span><span class="hs-special">]</span><span>
</span><span id="line-65"></span><span>                              </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall k2 k1 a. Ord k2 =&gt; (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeys</span></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; TxIn StandardCrypto
</span><span class="hs-identifier hs-var">toLedgerTxIn</span></span><span>
</span><span id="line-66"></span><span>                              </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut (ShelleyLedgerEra Era)
</span><span class="hs-identifier hs-var">toLedgerTxOut</span></span><span>
</span><span id="line-67"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UTxO
-&gt; ScriptRegistry
-&gt; VerificationKey PaymentKey
-&gt; UTxOWithScript
-&gt; PlutusScript
-&gt; Map TxIn (TxOut CtxUTxO, HashableScriptData)
-&gt; Map TxIn (TxOut CtxUTxO, HashableScriptData)
-&gt; Either AbortTxError (Tx Era)
</span><span class="hs-identifier hs-var">abortTx</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptRegistry
</span><a href="#local-6989586621679415462"><span class="hs-identifier hs-var">scriptRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415463"><span class="hs-identifier hs-var">signer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415449"><span class="hs-identifier hs-var">headInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415448"><span class="hs-identifier hs-var">headOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679415447"><span class="hs-identifier hs-var">headDatum</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; PlutusScript
</span><span class="hs-identifier hs-var">mkHeadTokenScript</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier hs-var">testSeedInput</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO, HashableScriptData)
</span><a href="#local-6989586621679415446"><span class="hs-identifier hs-var">initials'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-68"></span><span>                            </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679415431"><span class="annot"><span class="annottext">AbortTxError
</span><a href="#local-6989586621679415431"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-69"></span><span>                              </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AbortTx construction failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">AbortTxError
</span><a href="#local-6989586621679415431"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>                            </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx Era -&gt; Tx (ShelleyLedgerEra Era)
</span><span class="hs-identifier hs-var">toLedgerTx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679415428"><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra Era)
</span><a href="#local-6989586621679415428"><span class="hs-identifier hs-var">txAbort</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>                              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PParams (BabbageEra StandardCrypto)
-&gt; SystemStart
-&gt; EpochInfo (Either Text)
-&gt; Map (TxIn StandardCrypto) TxOut
-&gt; Map (TxIn StandardCrypto) TxOut
-&gt; AlonzoTx (BabbageEra StandardCrypto)
-&gt; Either ErrCoverFee (AlonzoTx (BabbageEra StandardCrypto))
</span><span class="hs-identifier hs-var">coverFee_</span></span><span> </span><span class="annot"><span class="annottext">BabbagePParams (BabbageEra StandardCrypto)
</span><a href="Hydra.Chain.Direct.TxSpec.html#ledgerPParams"><span class="hs-identifier hs-var">ledgerPParams</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><span class="hs-identifier hs-var">systemStart</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; EpochInfo m
</span><span class="hs-identifier hs-var">epochInfo</span></span><span> </span><span class="annot"><span class="annottext">Map
  (TxIn StandardCrypto) (BabbageTxOut (BabbageEra StandardCrypto))
</span><a href="#local-6989586621679415441"><span class="hs-identifier hs-var">lookupUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (TxIn StandardCrypto) (BabbageTxOut (BabbageEra StandardCrypto))
</span><a href="#local-6989586621679415467"><span class="hs-identifier hs-var">walletUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra Era)
</span><a href="#local-6989586621679415428"><span class="hs-identifier hs-var">txAbort</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-72"></span><span>                                </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679415426"><span class="annot"><span class="annottext">ErrCoverFee
</span><a href="#local-6989586621679415426"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-73"></span><span>                                  </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-74"></span><span>                                    </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-keyword hs-var">label</span></span><span>
</span><span id="line-75"></span><span>                                      </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ErrCoverFee
</span><a href="#local-6989586621679415426"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-76"></span><span>                                          </span><span class="annot"><span class="hs-identifier hs-type">ErrNoFuelUTxOFound</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No fuel UTxO found&quot;</span></span><span>
</span><span id="line-77"></span><span>                                          </span><span class="annot"><span class="hs-identifier hs-type">ErrNotEnoughFunds</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not enough funds&quot;</span></span><span>
</span><span id="line-78"></span><span>                                          </span><span class="annot"><span class="hs-identifier hs-type">ErrUnknownInput</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unknown input&quot;</span></span><span>
</span><span id="line-79"></span><span>                                          </span><span class="annot"><span class="hs-identifier hs-type">ErrScriptExecutionFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Script(s) execution failed&quot;</span></span><span>
</span><span id="line-80"></span><span>                                          </span><span class="annot"><span class="hs-identifier hs-type">ErrTranslationError</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Transaction context translation error&quot;</span></span><span>
</span><span id="line-81"></span><span>                                      </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>                                </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra Era) -&gt; Tx Era
</span><span class="hs-identifier hs-var">fromLedgerTx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679415419"><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415419"><span class="hs-identifier hs-var">txAbortWithFees</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>                                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679415418"><span class="annot"><span class="annottext">actualExecutionCost :: Lovelace
</span><a href="#local-6989586621679415418"><span class="hs-identifier hs-var hs-var">actualExecutionCost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams (ShelleyLedgerEra Era) -&gt; Tx Era -&gt; Lovelace
</span><span class="hs-identifier hs-var">totalExecutionCost</span></span><span> </span><span class="annot"><span class="annottext">BabbagePParams (BabbageEra StandardCrypto)
</span><a href="Hydra.Chain.Direct.TxSpec.html#ledgerPParams"><span class="hs-identifier hs-var">ledgerPParams</span></a></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415419"><span class="hs-identifier hs-var">txAbortWithFees</span></a></span><span>
</span><span id="line-84"></span><span>                                      </span><span id="local-6989586621679415416"><span class="annot"><span class="annottext">fee :: Lovelace
</span><a href="#local-6989586621679415416"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall era. HasCallStack =&gt; Tx era -&gt; Lovelace
</span><span class="hs-identifier hs-var">txFee'</span></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415419"><span class="hs-identifier hs-var">txAbortWithFees</span></a></span><span>
</span><span id="line-85"></span><span>                                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679415418"><span class="hs-identifier hs-var">actualExecutionCost</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Lovelace
</span><span class="hs-identifier hs-var">Lovelace</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679415416"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679415418"><span class="hs-identifier hs-var">actualExecutionCost</span></a></span><span>
</span><span id="line-86"></span><span>                                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-keyword hs-var">label</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ok&quot;</span></span><span>
</span><span id="line-87"></span><span>                                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Execution cost: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679415418"><span class="hs-identifier hs-var">actualExecutionCost</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>                                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Fee: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Lovelace
</span><a href="#local-6989586621679415416"><span class="hs-identifier hs-var">fee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>                                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415419"><span class="hs-identifier hs-var">txAbortWithFees</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>                                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Input utxo: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map
  (TxIn StandardCrypto) (BabbageTxOut (BabbageEra StandardCrypto))
</span><a href="#local-6989586621679415467"><span class="hs-identifier hs-var">walletUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (TxIn StandardCrypto) (BabbageTxOut (BabbageEra StandardCrypto))
</span><a href="#local-6989586621679415441"><span class="hs-identifier hs-var">lookupUTxO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>                    </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679415411"><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="#local-6989586621679415411"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-92"></span><span>                      </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-93"></span><span>                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to construct and observe init tx.&quot;</span></span><span>
</span><span id="line-94"></span><span>                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx Era -&gt; String
</span><span class="hs-identifier hs-var">renderTx</span></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415459"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>                        </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="#local-6989586621679415411"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">forall prop.
(HasCallStack, Testable prop) =&gt;
String -&gt; prop -&gt; Spec
</span><span class="hs-identifier hs-var">prop</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ignore InitTx with wrong contestation period&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; Int -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">withMaxSuccess</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679415410"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415410"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span id="local-6989586621679415409"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415409"><span class="hs-identifier hs-var">cperiod</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415408"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415408"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621679415407"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415407"><span class="hs-identifier hs-var">parties</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-99"></span><span>          </span><span id="local-6989586621679415406"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679415406"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Positive a -&gt; a
</span><span class="hs-identifier hs-var">getPositive</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-100"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679415404"><span class="annot"><span class="annottext">params :: HeadParameters
</span><a href="#local-6989586621679415404"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; [Party] -&gt; HeadParameters
</span><span class="hs-identifier hs-var">HeadParameters</span></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415409"><span class="hs-identifier hs-var">cperiod</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415403"><span class="hs-identifier hs-var">allParties</span></a></span><span>
</span><span id="line-101"></span><span>              </span><span id="local-6989586621679415403"><span class="annot"><span class="annottext">allParties :: [Party]
</span><a href="#local-6989586621679415403"><span class="hs-identifier hs-var hs-var">allParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415408"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415407"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-102"></span><span>              </span><span id="local-6989586621679415402"><span class="annot"><span class="annottext">cardanoKeys :: [VerificationKey PaymentKey]
</span><a href="#local-6989586621679415402"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Gen a -&gt; Party -&gt; a
</span><a href="Hydra.Chain.Direct.Contract.Gen.html#genForParty"><span class="hs-identifier hs-var">genForParty</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415403"><span class="hs-identifier hs-var">allParties</span></a></span><span>
</span><span id="line-103"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UnsafeContestationPeriod</span></span><span> </span><span id="local-6989586621679415401"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415401"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415409"><span class="hs-identifier hs-var">cperiod</span></a></span><span>
</span><span id="line-104"></span><span>              </span><span class="hs-comment">-- construct different/wrong CP</span><span>
</span><span id="line-105"></span><span>              </span><span id="local-6989586621679415400"><span class="annot"><span class="annottext">wrongCPeriod :: ContestationPeriod
</span><a href="#local-6989586621679415400"><span class="hs-identifier hs-var hs-var">wrongCPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ContestationPeriod
</span><span class="hs-identifier hs-var">UnsafeContestationPeriod</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415401"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679415406"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-106"></span><span>              </span><span id="local-6989586621679415398"><span class="annot"><span class="annottext">tx :: Tx Era
</span><a href="#local-6989586621679415398"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; [VerificationKey PaymentKey] -&gt; HeadParameters -&gt; TxIn -&gt; Tx Era
</span><span class="hs-identifier hs-var">initTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679415402"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span> </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621679415404"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415410"><span class="hs-identifier hs-var">txIn</span></a></span><span>
</span><span id="line-107"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; [VerificationKey PaymentKey]
-&gt; ContestationPeriod
-&gt; Party
-&gt; [Party]
-&gt; Tx Era
-&gt; Either NotAnInitReason InitObservation
</span><span class="hs-identifier hs-var">observeInitTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679415402"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415400"><span class="hs-identifier hs-var">wrongCPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415408"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415407"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415398"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-108"></span><span>            </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">InitObservation</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>              </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-110"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to ignore init tx with the wrong contestation period.&quot;</span></span><span>
</span><span id="line-111"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx Era -&gt; String
</span><span class="hs-identifier hs-var">renderTx</span></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415398"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>            </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><span class="hs-identifier hs-var">CPMismatch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-113"></span><span>            </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679415396"><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="#local-6989586621679415396"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-114"></span><span>              </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-115"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to ignore init tx for the right reason.&quot;</span></span><span>
</span><span id="line-116"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx Era -&gt; String
</span><span class="hs-identifier hs-var">renderTx</span></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415398"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>                </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="#local-6989586621679415396"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><span class="annottext">forall prop.
(HasCallStack, Testable prop) =&gt;
String -&gt; prop -&gt; Spec
</span><span class="hs-identifier hs-var">prop</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ignore InitTx with wrong cardano keys&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; Int -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">withMaxSuccess</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">60</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679415395"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415395"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span id="local-6989586621679415394"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415394"><span class="hs-identifier hs-var">cperiod</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415393"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415393"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621679415392"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415392"><span class="hs-identifier hs-var">parties</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679415391"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415391"><span class="hs-identifier hs-var">wrongParty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679415390"><span class="annot"><span class="annottext">allParties :: [Party]
</span><a href="#local-6989586621679415390"><span class="hs-identifier hs-var hs-var">allParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415393"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415392"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-122"></span><span>              </span><span id="local-6989586621679415389"><span class="annot"><span class="annottext">cardanoKeys :: [VerificationKey PaymentKey]
</span><a href="#local-6989586621679415389"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Gen a -&gt; Party -&gt; a
</span><a href="Hydra.Chain.Direct.Contract.Gen.html#genForParty"><span class="hs-identifier hs-var">genForParty</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415390"><span class="hs-identifier hs-var">allParties</span></a></span><span>
</span><span id="line-123"></span><span>              </span><span id="local-6989586621679415388"><span class="annot"><span class="annottext">wrongCardanoKeys :: [VerificationKey PaymentKey]
</span><a href="#local-6989586621679415388"><span class="hs-identifier hs-var hs-var">wrongCardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Gen a -&gt; Party -&gt; a
</span><a href="Hydra.Chain.Direct.Contract.Gen.html#genForParty"><span class="hs-identifier hs-var">genForParty</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415391"><span class="hs-identifier hs-var">wrongParty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415392"><span class="hs-identifier hs-var">parties</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>              </span><span id="local-6989586621679415387"><span class="annot"><span class="annottext">params :: HeadParameters
</span><a href="#local-6989586621679415387"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; [Party] -&gt; HeadParameters
</span><span class="hs-identifier hs-var">HeadParameters</span></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415394"><span class="hs-identifier hs-var">cperiod</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415390"><span class="hs-identifier hs-var">allParties</span></a></span><span>
</span><span id="line-125"></span><span>              </span><span id="local-6989586621679415386"><span class="annot"><span class="annottext">tx :: Tx Era
</span><a href="#local-6989586621679415386"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; [VerificationKey PaymentKey] -&gt; HeadParameters -&gt; TxIn -&gt; Tx Era
</span><span class="hs-identifier hs-var">initTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679415389"><span class="hs-identifier hs-var">cardanoKeys</span></a></span><span> </span><span class="annot"><span class="annottext">HeadParameters
</span><a href="#local-6989586621679415387"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415395"><span class="hs-identifier hs-var">txIn</span></a></span><span>
</span><span id="line-126"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; [VerificationKey PaymentKey]
-&gt; ContestationPeriod
-&gt; Party
-&gt; [Party]
-&gt; Tx Era
-&gt; Either NotAnInitReason InitObservation
</span><span class="hs-identifier hs-var">observeInitTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
</span><a href="#local-6989586621679415388"><span class="hs-identifier hs-var">wrongCardanoKeys</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679415394"><span class="hs-identifier hs-var">cperiod</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415393"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415392"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415386"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-127"></span><span>                </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">InitObservation</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>                  </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-129"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to ignore init tx with the wrong cardano keys.&quot;</span></span><span>
</span><span id="line-130"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx Era -&gt; String
</span><span class="hs-identifier hs-var">renderTx</span></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415386"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>                </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><span class="hs-identifier hs-var">PTsNotMintedCorrectly</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-132"></span><span>                </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679415384"><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="#local-6989586621679415384"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>                  </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">property</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-134"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to ignore init tx for the right reason.&quot;</span></span><span>
</span><span id="line-135"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx Era -&gt; String
</span><span class="hs-identifier hs-var">renderTx</span></span><span> </span><span class="annot"><span class="annottext">Tx Era
</span><a href="#local-6989586621679415386"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="#local-6989586621679415384"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#ledgerPParams"><span class="hs-identifier hs-type">ledgerPParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BabbagePParams</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LedgerEra</span></span><span>
</span><span id="line-139"></span><span id="ledgerPParams"><span class="annot"><span class="annottext">ledgerPParams :: BabbagePParams (BabbageEra StandardCrypto)
</span><a href="Hydra.Chain.Direct.TxSpec.html#ledgerPParams"><span class="hs-identifier hs-var hs-var">ledgerPParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall era.
ShelleyBasedEra era
-&gt; ProtocolParameters -&gt; PParams (ShelleyLedgerEra era)
</span><span class="hs-identifier hs-var">toLedgerPParams</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era. IsShelleyBasedEra era =&gt; ShelleyBasedEra era
</span><span class="hs-identifier hs-var">shelleyBasedEra</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Era</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters
</span><span class="hs-identifier hs-var">pparams</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#withinTxExecutionBudget"><span class="hs-identifier hs-type">withinTxExecutionBudget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvaluationReport</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Property</span></span><span>
</span><span id="line-142"></span><span id="withinTxExecutionBudget"><span class="annot"><span class="annottext">withinTxExecutionBudget :: EvaluationReport -&gt; Property
</span><a href="Hydra.Chain.Direct.TxSpec.html#withinTxExecutionBudget"><span class="hs-identifier hs-var hs-var">withinTxExecutionBudget</span></a></span></span><span> </span><span id="local-6989586621679415379"><span class="annot"><span class="annottext">EvaluationReport
</span><a href="#local-6989586621679415379"><span class="hs-identifier hs-var">report</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415378"><span class="hs-identifier hs-var">totalMem</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415376"><span class="hs-identifier hs-var">maxMem</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415375"><span class="hs-identifier hs-var">totalCpu</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415374"><span class="hs-identifier hs-var">maxCpu</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall prop. Testable prop =&gt; String -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">counterexample</span></span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ex. Cost Limits exceeded, mem: &quot;</span></span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415378"><span class="hs-identifier hs-var">totalMem</span></a></span><span>
</span><span id="line-149"></span><span>          </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415376"><span class="hs-identifier hs-var">maxMem</span></a></span><span>
</span><span id="line-151"></span><span>          </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, cpu: &quot;</span></span><span>
</span><span id="line-152"></span><span>          </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415375"><span class="hs-identifier hs-var">totalCpu</span></a></span><span>
</span><span id="line-153"></span><span>          </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;/&quot;</span></span><span>
</span><span id="line-154"></span><span>          </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415374"><span class="hs-identifier hs-var">maxCpu</span></a></span><span>
</span><span id="line-155"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621679415373"><span class="annot"><span class="annottext">budgets :: [ExecutionUnits]
</span><a href="#local-6989586621679415373"><span class="hs-identifier hs-var hs-var">budgets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [Either a b] -&gt; [b]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">rights</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">EvaluationReport
</span><a href="#local-6989586621679415379"><span class="hs-identifier hs-var">report</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679415378"><span class="annot"><span class="annottext">totalMem :: Natural
</span><a href="#local-6989586621679415378"><span class="hs-identifier hs-var hs-var">totalMem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (f :: * -&gt; *). (Foldable f, Num a) =&gt; f a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutionUnits -&gt; Natural
</span><span class="hs-identifier hs-var">executionMemory</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ExecutionUnits]
</span><a href="#local-6989586621679415373"><span class="hs-identifier hs-var">budgets</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679415375"><span class="annot"><span class="annottext">totalCpu :: Natural
</span><a href="#local-6989586621679415375"><span class="hs-identifier hs-var hs-var">totalCpu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (f :: * -&gt; *). (Foldable f, Num a) =&gt; f a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutionUnits -&gt; Natural
</span><span class="hs-identifier hs-var">executionSteps</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ExecutionUnits]
</span><a href="#local-6989586621679415373"><span class="hs-identifier hs-var">budgets</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ExecutionUnits</span></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">executionMemory :: ExecutionUnits -&gt; Natural
</span><span class="hs-identifier hs-var">executionMemory</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679415376"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415376"><span class="hs-identifier hs-var">maxMem</span></a></span></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">executionSteps :: ExecutionUnits -&gt; Natural
</span><span class="hs-identifier hs-var">executionSteps</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679415374"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679415374"><span class="hs-identifier hs-var">maxCpu</span></a></span></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier hs-var">maxTxExecutionUnits</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | Generate a UTXO representing /commit/ outputs for a given list of `Party`.</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- NOTE: Uses 'testPolicyId' for the datum.</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- NOTE: We don't generate empty commits and it is used only at one place so perhaps move it?</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- FIXME: This function is very complicated and it's hard to understand it after a while</span><span>
</span><span id="line-169"></span><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#generateCommitUTxOs"><span class="hs-identifier hs-type">generateCommitUTxOs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span id="generateCommitUTxOs"><span class="annot"><span class="annottext">generateCommitUTxOs :: [Party] -&gt; Gen (Map TxIn (TxOut CtxUTxO, HashableScriptData, UTxO))
</span><a href="Hydra.Chain.Direct.TxSpec.html#generateCommitUTxOs"><span class="hs-identifier hs-var hs-var">generateCommitUTxOs</span></a></span></span><span> </span><span id="local-6989586621679415365"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415365"><span class="hs-identifier hs-var">parties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621679415364"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679415364"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415365"><span class="hs-identifier hs-var">parties</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679415362"><span class="annot"><span class="annottext">vks :: [(VerificationKey PaymentKey, Party)]
</span><a href="#local-6989586621679415362"><span class="hs-identifier hs-var hs-var">vks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679415361"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415361"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">forall a. Gen a -&gt; Party -&gt; a
</span><a href="Hydra.Chain.Direct.Contract.Gen.html#genForParty"><span class="hs-operator hs-var">`genForParty`</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415361"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415361"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415365"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621679415360"><span class="annot"><span class="annottext">[UTxO]
</span><a href="#local-6989586621679415360"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415365"><span class="hs-identifier hs-var">parties</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxUTxO
</span><span class="hs-identifier hs-var">adaOnly</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Gen UTxO
</span><span class="hs-identifier hs-var">genOneUTxOFor</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679415358"><span class="annot"><span class="annottext">commitUTxO :: [(TxIn, (TxOut CtxUTxO, HashableScriptData, UTxO))]
</span><a href="#local-6989586621679415358"><span class="hs-identifier hs-var hs-var">commitUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679415364"><span class="hs-identifier hs-var">txins</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-178"></span><span>          </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey, Party)
-&gt; UTxO -&gt; (TxOut CtxUTxO, HashableScriptData, UTxO)
</span><a href="#local-6989586621679415356"><span class="hs-identifier hs-var">mkCommitUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[(VerificationKey PaymentKey, Party)]
</span><a href="#local-6989586621679415362"><span class="hs-identifier hs-var">vks</span></a></span><span> </span><span class="annot"><span class="annottext">[UTxO]
</span><a href="#local-6989586621679415360"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(TxIn, (TxOut CtxUTxO, HashableScriptData, UTxO))]
</span><a href="#local-6989586621679415358"><span class="hs-identifier hs-var">commitUTxO</span></a></span><span>
</span><span id="line-180"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>  </span><span class="annot"><a href="#local-6989586621679415356"><span class="hs-identifier hs-type">mkCommitUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621679415356"><span class="annot"><span class="annottext">mkCommitUTxO :: (VerificationKey PaymentKey, Party)
-&gt; UTxO -&gt; (TxOut CtxUTxO, HashableScriptData, UTxO)
</span><a href="#local-6989586621679415356"><span class="hs-identifier hs-var hs-var">mkCommitUTxO</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415355"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415355"><span class="hs-identifier hs-var">vk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415354"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415354"><span class="hs-identifier hs-var">party</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679415353"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679415353"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; * -&gt; *) era.
ToUTxOContext f =&gt;
f CtxTx era -&gt; f CtxUTxO era
</span><span class="hs-identifier hs-var">toUTxOContext</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="annottext">forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">forall {lang}. PlutusScript lang
</span><a href="#local-6989586621679415349"><span class="hs-identifier hs-var">commitScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679415348"><span class="hs-identifier hs-var">commitValue</span></a></span><span>
</span><span id="line-187"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679415346"><span class="hs-identifier hs-var">commitDatum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>          </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679415346"><span class="hs-identifier hs-var">commitDatum</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679415353"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679415348"><span class="annot"><span class="annottext">commitValue :: Value
</span><a href="#local-6989586621679415348"><span class="hs-identifier hs-var hs-var">commitValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Value
</span><span class="hs-identifier hs-var">lovelaceToValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Lovelace
</span><span class="hs-identifier hs-var">Lovelace</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2000000</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679415353"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; AssetName
</span><span class="hs-identifier hs-var">assetNameFromVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415355"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621679415349"><span class="annot"><span class="annottext">commitScript :: PlutusScript lang
</span><a href="#local-6989586621679415349"><span class="hs-identifier hs-var hs-var">commitScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Commit.validatorScript</span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621679415346"><span class="annot"><span class="annottext">commitDatum :: Datum
</span><a href="#local-6989586621679415346"><span class="hs-identifier hs-var hs-var">commitDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party -&gt; UTxO -&gt; CurrencySymbol -&gt; Datum
</span><span class="hs-identifier hs-var">mkCommitDatum</span></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415354"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679415353"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">toPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#prettyEvaluationReport"><span class="hs-identifier hs-type">prettyEvaluationReport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvaluationReport</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-207"></span><span id="prettyEvaluationReport"><span class="annot"><span class="annottext">prettyEvaluationReport :: EvaluationReport -&gt; String
</span><a href="Hydra.Chain.Direct.TxSpec.html#prettyEvaluationReport"><span class="hs-identifier hs-var hs-var">prettyEvaluationReport</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679415331"><span class="annot"><span class="annottext">[(ScriptWitnessIndex, Either ScriptExecutionError ExecutionUnits)]
</span><a href="#local-6989586621679415331"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Script Evaluation(s):\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ScriptWitnessIndex, Either ScriptExecutionError ExecutionUnits)
-&gt; String
</span><a href="#local-6989586621679415329"><span class="hs-identifier hs-var">prettyKeyValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(ScriptWitnessIndex, Either ScriptExecutionError ExecutionUnits)]
</span><a href="#local-6989586621679415331"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621679415329"><span class="annot"><span class="annottext">prettyKeyValue :: (ScriptWitnessIndex, Either ScriptExecutionError ExecutionUnits)
-&gt; String
</span><a href="#local-6989586621679415329"><span class="hs-identifier hs-var hs-var">prettyKeyValue</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415328"><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621679415328"><span class="hs-identifier hs-var">ptr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415327"><span class="annot"><span class="annottext">Either ScriptExecutionError ExecutionUnits
</span><a href="#local-6989586621679415327"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">forall a. ToString a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;  - &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessIndex
</span><a href="#local-6989586621679415328"><span class="hs-identifier hs-var">ptr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either ScriptExecutionError ExecutionUnits -&gt; Text
</span><a href="#local-6989586621679415325"><span class="hs-identifier hs-var">prettyResult</span></a></span><span> </span><span class="annot"><span class="annottext">Either ScriptExecutionError ExecutionUnits
</span><a href="#local-6989586621679415327"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621679415325"><span class="annot"><span class="annottext">prettyResult :: Either ScriptExecutionError ExecutionUnits -&gt; Text
</span><a href="#local-6989586621679415325"><span class="hs-identifier hs-var hs-var">prettyResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.replace</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- NOTE: Uses 'testPolicyId' for the datum.</span><span>
</span><span id="line-216"></span><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#genAbortableOutputs"><span class="hs-identifier hs-type">genAbortableOutputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">UTxOWithScript</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span id="genAbortableOutputs"><span class="annot"><span class="annottext">genAbortableOutputs :: [Party]
-&gt; Gen
     ([UTxOWithScript],
      [(TxIn, TxOut CtxUTxO, HashableScriptData, UTxO)])
</span><a href="Hydra.Chain.Direct.TxSpec.html#genAbortableOutputs"><span class="hs-identifier hs-var hs-var">genAbortableOutputs</span></a></span></span><span> </span><span id="local-6989586621679415312"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415312"><span class="hs-identifier hs-var">parties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="annottext">Gen
  ([UTxOWithScript],
   [(TxIn, TxOut CtxUTxO, HashableScriptData, UTxO)])
</span><a href="#local-6989586621679415311"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-219"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>  </span><span id="local-6989586621679415311"><span class="annot"><span class="annottext">go :: Gen
  ([UTxOWithScript],
   [(TxIn, TxOut CtxUTxO, HashableScriptData, UTxO)])
</span><a href="#local-6989586621679415311"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679415310"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415310"><span class="hs-identifier hs-var">initParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415309"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415309"><span class="hs-identifier hs-var">commitParties</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`splitAt`</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415312"><span class="hs-identifier hs-var">parties</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415312"><span class="hs-identifier hs-var">parties</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621679415307"><span class="annot"><span class="annottext">[UTxOWithScript]
</span><a href="#local-6989586621679415307"><span class="hs-identifier hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Gen UTxOWithScript
</span><a href="#local-6989586621679415305"><span class="hs-identifier hs-var">genInitial</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415310"><span class="hs-identifier hs-var">initParties</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679415304"><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO, HashableScriptData, UTxO)]
</span><a href="#local-6989586621679415304"><span class="hs-identifier hs-var">commits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679415303"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415303"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415302"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415302"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415301"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679415301"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415300"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679415300"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415303"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621679415302"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621679415301"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679415300"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Party] -&gt; Gen (Map TxIn (TxOut CtxUTxO, HashableScriptData, UTxO))
</span><a href="Hydra.Chain.Direct.TxSpec.html#generateCommitUTxOs"><span class="hs-identifier hs-var">generateCommitUTxOs</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679415309"><span class="hs-identifier hs-var">commitParties</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UTxOWithScript]
</span><a href="#local-6989586621679415307"><span class="hs-identifier hs-var">initials</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO, HashableScriptData, UTxO)]
</span><a href="#local-6989586621679415304"><span class="hs-identifier hs-var">commits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>  </span><span id="local-6989586621679415305"><span class="annot"><span class="annottext">genInitial :: Party -&gt; Gen UTxOWithScript
</span><a href="#local-6989586621679415305"><span class="hs-identifier hs-var hs-var">genInitial</span></a></span></span><span> </span><span id="local-6989586621679415297"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415297"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; TxIn -&gt; UTxOWithScript
</span><a href="#local-6989586621679415296"><span class="hs-identifier hs-var">mkInitial</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Gen (VerificationKey PaymentKey)
</span><span class="hs-identifier hs-var">genVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">forall a. Gen a -&gt; Party -&gt; a
</span><a href="Hydra.Chain.Direct.Contract.Gen.html#genForParty"><span class="hs-operator hs-var">`genForParty`</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679415297"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>  </span><span class="annot"><a href="#local-6989586621679415296"><span class="hs-identifier hs-type">mkInitial</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">UTxOWithScript</span></span><span>
</span><span id="line-233"></span><span>  </span><span id="local-6989586621679415296"><span class="annot"><span class="annottext">mkInitial :: VerificationKey PaymentKey -&gt; TxIn -&gt; UTxOWithScript
</span><a href="#local-6989586621679415296"><span class="hs-identifier hs-var hs-var">mkInitial</span></a></span></span><span> </span><span id="local-6989586621679415295"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415295"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span id="local-6989586621679415294"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415294"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679415294"><span class="hs-identifier hs-var">txin</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; TxOut CtxUTxO
</span><a href="#local-6989586621679415293"><span class="hs-identifier hs-var">initialTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415295"><span class="hs-identifier hs-var">vk</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. ToScriptData a =&gt; a -&gt; HashableScriptData
</span><span class="hs-identifier hs-var">toScriptData</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679415292"><span class="hs-identifier hs-var">initialDatum</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><a href="#local-6989586621679415293"><span class="hs-identifier hs-type">initialTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621679415293"><span class="annot"><span class="annottext">initialTxOut :: VerificationKey PaymentKey -&gt; TxOut CtxUTxO
</span><a href="#local-6989586621679415293"><span class="hs-identifier hs-var hs-var">initialTxOut</span></a></span></span><span> </span><span id="local-6989586621679415291"><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415291"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; * -&gt; *) era.
ToUTxOContext f =&gt;
f CtxTx era -&gt; f CtxUTxO era
</span><span class="hs-identifier hs-var">toUTxOContext</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">PlutusScriptV2</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">forall {lang}. PlutusScript lang
</span><a href="#local-6989586621679415290"><span class="hs-identifier hs-var">initialScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier hs-var">headValue</span></span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Value
</span><span class="hs-identifier hs-var">valueFromList</span></span><span>
</span><span id="line-246"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; AssetName
</span><span class="hs-identifier hs-var">assetNameFromVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679415291"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era a.
(ToScriptData a, HasScriptData era) =&gt;
a -&gt; TxOutDatum CtxTx era
</span><span class="hs-identifier hs-var">mkTxOutDatum</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679415292"><span class="hs-identifier hs-var">initialDatum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>        </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>  </span><span id="local-6989586621679415290"><span class="annot"><span class="annottext">initialScript :: PlutusScript lang
</span><a href="#local-6989586621679415290"><span class="hs-identifier hs-var hs-var">initialScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall lang. SerialisedScript -&gt; PlutusScript lang
</span><span class="hs-identifier hs-var">fromPlutusScript</span></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><span class="hs-identifier hs-var">Initial.validatorScript</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>  </span><span id="local-6989586621679415292"><span class="annot"><span class="annottext">initialDatum :: Datum
</span><a href="#local-6989586621679415292"><span class="hs-identifier hs-var hs-var">initialDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Datum
</span><span class="hs-identifier hs-var">Initial.datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">toPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><span class="hs-identifier hs-var">testPolicyId</span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span id="local-6989586621679415836"><span id="local-6989586621679415837"><span id="local-6989586621679415838"><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#fst3"><span class="hs-identifier hs-type">fst3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415838"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415837"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415836"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679415838"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-257"></span><span id="fst3"><span class="annot"><span class="annottext">fst3 :: forall a b c. (a, b, c) -&gt; a
</span><a href="Hydra.Chain.Direct.TxSpec.html#fst3"><span class="hs-identifier hs-var hs-var">fst3</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415285"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415285"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415285"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span id="local-6989586621679415830"><span id="local-6989586621679415831"><span id="local-6989586621679415832"><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#third"><span class="hs-identifier hs-type">third</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415832"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415831"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415830"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679415830"><span class="hs-identifier hs-type">c</span></a></span></span></span></span><span>
</span><span id="line-260"></span><span id="third"><span class="annot"><span class="annottext">third :: forall a b c. (a, b, c) -&gt; c
</span><a href="Hydra.Chain.Direct.TxSpec.html#third"><span class="hs-identifier hs-var hs-var">third</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415283"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679415283"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679415283"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span id="local-6989586621679415824"><span id="local-6989586621679415825"><span id="local-6989586621679415826"><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#drop2nd"><span class="hs-identifier hs-type">drop2nd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415826"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415825"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415824"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415826"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415824"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-263"></span><span id="drop2nd"><span class="annot"><span class="annottext">drop2nd :: forall a b c. (a, b, c) -&gt; (a, c)
</span><a href="Hydra.Chain.Direct.TxSpec.html#drop2nd"><span class="hs-identifier hs-var hs-var">drop2nd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415281"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415281"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415280"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679415280"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415281"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679415280"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span id="local-6989586621679415818"><span id="local-6989586621679415819"><span id="local-6989586621679415820"><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#drop3rd"><span class="hs-identifier hs-type">drop3rd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415820"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415819"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415818"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415820"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415819"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-266"></span><span id="drop3rd"><span class="annot"><span class="annottext">drop3rd :: forall a b c. (a, b, c) -&gt; (a, b)
</span><a href="Hydra.Chain.Direct.TxSpec.html#drop3rd"><span class="hs-identifier hs-var hs-var">drop3rd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415278"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415278"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415277"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679415277"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415278"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679415277"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span id="local-6989586621679415812"><span id="local-6989586621679415813"><span id="local-6989586621679415814"><span class="annot"><a href="Hydra.Chain.Direct.TxSpec.html#tripleToPair"><span class="hs-identifier hs-type">tripleToPair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415814"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415813"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415812"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415814"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679415813"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679415812"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-269"></span><span id="tripleToPair"><span class="annot"><span class="annottext">tripleToPair :: forall a b c. (a, b, c) -&gt; (a, (b, c))
</span><a href="Hydra.Chain.Direct.TxSpec.html#tripleToPair"><span class="hs-identifier hs-var hs-var">tripleToPair</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679415275"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415275"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415274"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679415274"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679415273"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679415273"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679415275"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679415274"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679415273"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span></pre></body></html>