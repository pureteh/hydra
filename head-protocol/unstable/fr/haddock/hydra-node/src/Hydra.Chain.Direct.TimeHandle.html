<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Module to deal with time in direct cardano chain layer. Defines the type</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- for a 'PointInTime' and a means to acquire one via a 'TimeHandle' and</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- 'queryTimeHandle'.</span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Chain.Direct.TimeHandle</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Slotting.Slot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Slotting.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SystemStart</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SystemStart</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromRelativeTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toRelativeTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">secondsToNominalDiffTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Clock.POSIX</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">posixSecondsToUTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><span class="hs-identifier">CardanoMode</span></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><span class="hs-identifier">EraHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EraHistory</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><span class="hs-identifier">NetworkId</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api.Prelude</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChainPoint</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChainPoint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ChainPointAtGenesis</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Chain.CardanoClient.html"><span class="hs-identifier">Hydra.Chain.CardanoClient</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Hydra.Chain.CardanoClient.html#QueryPoint"><span class="hs-identifier">QueryPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Chain.CardanoClient.html#QueryTip"><span class="hs-identifier">QueryTip</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Hydra.Chain.CardanoClient.html#queryEraHistory"><span class="hs-identifier">queryEraHistory</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Hydra.Chain.CardanoClient.html#querySystemStart"><span class="hs-identifier">querySystemStart</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Hydra.Chain.CardanoClient.html#queryTip"><span class="hs-identifier">queryTip</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Ledger.Cardano.Evaluate.html"><span class="hs-identifier">Hydra.Ledger.Cardano.Evaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Ledger.Cardano.Evaluate.html#eraHistoryWithHorizonAt"><span class="hs-identifier">eraHistoryWithHorizonAt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Qry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">interpretQuery</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">slotToWallclock</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">wallclockToSlot</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getPositive</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">type</span><span> </span><span id="PointInTime"><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier hs-var">PointInTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">data</span><span> </span><span id="TimeHandle"><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandle"><span class="hs-identifier hs-var">TimeHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TimeHandle"><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandle"><span class="hs-identifier hs-var">TimeHandle</span></a></span></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="currentPointInTime"><span class="annot"><span class="annottext">TimeHandle -&gt; Either Text PointInTime
</span><a href="Hydra.Chain.Direct.TimeHandle.html#currentPointInTime"><span class="hs-identifier hs-var hs-var">currentPointInTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#PointInTime"><span class="hs-identifier hs-type">PointInTime</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-comment">-- ^ Get the current 'PointInTime'</span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="slotFromUTCTime"><span class="annot"><span class="annottext">TimeHandle -&gt; UTCTime -&gt; Either Text SlotNo
</span><a href="Hydra.Chain.Direct.TimeHandle.html#slotFromUTCTime"><span class="hs-identifier hs-var hs-var">slotFromUTCTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-comment">-- ^ Lookup slot number given a 'UTCTime'. This will fail if the time is</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-comment">-- outside the &quot;safe zone&quot;.</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="slotToUTCTime"><span class="annot"><span class="annottext">TimeHandle -&gt; SlotNo -&gt; Either Text UTCTime
</span><a href="Hydra.Chain.Direct.TimeHandle.html#slotToUTCTime"><span class="hs-identifier hs-var hs-var">slotToUTCTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-comment">-- ^ Convert a slot number to a 'UTCTime' using the stored epoch info. This</span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-comment">-- will fail if the slot is outside the &quot;safe zone&quot;.</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">data</span><span> </span><span id="TimeHandleParams"><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandleParams"><span class="hs-identifier hs-var">TimeHandleParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TimeHandleParams"><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandleParams"><span class="hs-identifier hs-var">TimeHandleParams</span></a></span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="systemStart"><span class="annot"><span class="annottext">TimeHandleParams -&gt; SystemStart
</span><a href="Hydra.Chain.Direct.TimeHandle.html#systemStart"><span class="hs-identifier hs-var hs-var">systemStart</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SystemStart</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="eraHistory"><span class="annot"><span class="annottext">TimeHandleParams -&gt; EraHistory CardanoMode
</span><a href="Hydra.Chain.Direct.TimeHandle.html#eraHistory"><span class="hs-identifier hs-var hs-var">eraHistory</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EraHistory</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoMode</span></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="horizonSlot"><span class="annot"><span class="annottext">TimeHandleParams -&gt; SlotNo
</span><a href="Hydra.Chain.Direct.TimeHandle.html#horizonSlot"><span class="hs-identifier hs-var hs-var">horizonSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="currentSlot"><span class="annot"><span class="annottext">TimeHandleParams -&gt; SlotNo
</span><a href="Hydra.Chain.Direct.TimeHandle.html#currentSlot"><span class="hs-identifier hs-var hs-var">currentSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | Generate consistent values for 'SystemStart' and 'EraHistory' which has</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- a horizon at the returned SlotNo as well as some UTCTime before that</span><span>
</span><span id="line-50"></span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#genTimeParams"><span class="hs-identifier hs-type">genTimeParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandleParams"><span class="hs-identifier hs-type">TimeHandleParams</span></a></span><span>
</span><span id="line-51"></span><span id="genTimeParams"><span class="annot"><span class="annottext">genTimeParams :: Gen TimeHandleParams
</span><a href="Hydra.Chain.Direct.TimeHandle.html#genTimeParams"><span class="hs-identifier hs-var hs-var">genTimeParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-52"></span><span>  </span><span id="local-6989586621680066542"><span class="annot"><span class="annottext">Pico
</span><a href="#local-6989586621680066542"><span class="hs-identifier hs-var">startSeconds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Positive a -&gt; a
</span><span class="hs-identifier hs-var">getPositive</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680066539"><span class="annot"><span class="annottext">startTime :: UTCTime
</span><a href="#local-6989586621680066539"><span class="hs-identifier hs-var hs-var">startTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">posixSecondsToUTCTime</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pico -&gt; POSIXTime
</span><span class="hs-identifier hs-var">secondsToNominalDiffTime</span></span><span> </span><span class="annot"><span class="annottext">Pico
</span><a href="#local-6989586621680066542"><span class="hs-identifier hs-var">startSeconds</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621680066538"><span class="annot"><span class="annottext">Pico
</span><a href="#local-6989586621680066538"><span class="hs-identifier hs-var">uptimeSeconds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Positive a -&gt; a
</span><span class="hs-identifier hs-var">getPositive</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-comment">-- it is ok to construct a slot from seconds here since on the devnet slot = 1s</span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680066537"><span class="annot"><span class="annottext">currentSlotNo :: SlotNo
</span><a href="#local-6989586621680066537"><span class="hs-identifier hs-var hs-var">currentSlotNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><span class="hs-identifier hs-var">SlotNo</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">truncate</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pico
</span><a href="#local-6989586621680066538"><span class="hs-identifier hs-var">uptimeSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Pico
</span><a href="#local-6989586621680066542"><span class="hs-identifier hs-var">startSeconds</span></a></span><span>
</span><span id="line-57"></span><span>      </span><span class="hs-comment">-- formula: 3 * k / f where k = securityParam and f = slotLength from the genesis config</span><span>
</span><span id="line-58"></span><span>      </span><span id="local-6989586621680066528"><span class="annot"><span class="annottext">safeZone :: Pico
</span><a href="#local-6989586621680066528"><span class="hs-identifier hs-var hs-var">safeZone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pico
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Pico
</span><span class="hs-number">2160</span></span><span> </span><span class="annot"><span class="annottext">forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">/</span></a></span><span> </span><span class="annot"><span class="annottext">Pico
</span><span class="hs-number">0.05</span></span><span>
</span><span id="line-59"></span><span>      </span><span id="local-6989586621680066525"><span class="annot"><span class="annottext">horizonSlot :: SlotNo
</span><a href="#local-6989586621680066525"><span class="hs-identifier hs-var hs-var">horizonSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><span class="hs-identifier hs-var">SlotNo</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">truncate</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pico
</span><a href="#local-6989586621680066538"><span class="hs-identifier hs-var">uptimeSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Pico
</span><a href="#local-6989586621680066528"><span class="hs-identifier hs-var">safeZone</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandleParams"><span class="hs-identifier hs-type">TimeHandleParams</span></a></span><span>
</span><span id="line-62"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">systemStart :: SystemStart
</span><a href="Hydra.Chain.Direct.TimeHandle.html#systemStart"><span class="hs-identifier hs-var">systemStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; SystemStart
</span><span class="hs-identifier hs-var">SystemStart</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680066539"><span class="hs-identifier hs-var">startTime</span></a></span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">eraHistory :: EraHistory CardanoMode
</span><a href="Hydra.Chain.Direct.TimeHandle.html#eraHistory"><span class="hs-identifier hs-var">eraHistory</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; EraHistory CardanoMode
</span><a href="Hydra.Ledger.Cardano.Evaluate.html#eraHistoryWithHorizonAt"><span class="hs-identifier hs-var">eraHistoryWithHorizonAt</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066525"><span class="hs-identifier hs-var">horizonSlot</span></a></span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">horizonSlot :: SlotNo
</span><a href="Hydra.Chain.Direct.TimeHandle.html#horizonSlot"><span class="hs-identifier hs-var">horizonSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066525"><span class="hs-identifier hs-var">horizonSlot</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentSlot :: SlotNo
</span><a href="Hydra.Chain.Direct.TimeHandle.html#currentSlot"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066537"><span class="hs-identifier hs-var">currentSlotNo</span></a></span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680066522"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandle"><span class="hs-identifier hs-type">TimeHandle</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>  </span><span id="local-6989586621680066516"><span class="annot"><span class="annottext">arbitrary :: Gen TimeHandle
</span><a href="#local-6989586621680066516"><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandleParams"><span class="hs-identifier hs-type">TimeHandleParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680066515"><span class="annot"><span class="annottext">SystemStart
systemStart :: SystemStart
systemStart :: TimeHandleParams -&gt; SystemStart
</span><a href="#local-6989586621680066515"><span class="hs-identifier hs-var hs-var">systemStart</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680066514"><span class="annot"><span class="annottext">EraHistory CardanoMode
eraHistory :: EraHistory CardanoMode
eraHistory :: TimeHandleParams -&gt; EraHistory CardanoMode
</span><a href="#local-6989586621680066514"><span class="hs-identifier hs-var hs-var">eraHistory</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680066513"><span class="annot"><span class="annottext">SlotNo
currentSlot :: SlotNo
currentSlot :: TimeHandleParams -&gt; SlotNo
</span><a href="#local-6989586621680066513"><span class="hs-identifier hs-var hs-var">currentSlot</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen TimeHandleParams
</span><a href="Hydra.Chain.Direct.TimeHandle.html#genTimeParams"><span class="hs-identifier hs-var">genTimeParams</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
SlotNo -&gt; SystemStart -&gt; EraHistory CardanoMode -&gt; TimeHandle
</span><a href="Hydra.Chain.Direct.TimeHandle.html#mkTimeHandle"><span class="hs-identifier hs-var">mkTimeHandle</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066513"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680066515"><span class="hs-identifier hs-var">systemStart</span></a></span><span> </span><span class="annot"><span class="annottext">EraHistory CardanoMode
</span><a href="#local-6989586621680066514"><span class="hs-identifier hs-var">eraHistory</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- | Construct a time handle using current slot and given chain parameters. See</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- 'queryTimeHandle' to create one by querying a cardano-node.</span><span>
</span><span id="line-75"></span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#mkTimeHandle"><span class="hs-identifier hs-type">mkTimeHandle</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SystemStart</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EraHistory</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandle"><span class="hs-identifier hs-type">TimeHandle</span></a></span><span>
</span><span id="line-81"></span><span id="mkTimeHandle"><span class="annot"><span class="annottext">mkTimeHandle :: HasCallStack =&gt;
SlotNo -&gt; SystemStart -&gt; EraHistory CardanoMode -&gt; TimeHandle
</span><a href="Hydra.Chain.Direct.TimeHandle.html#mkTimeHandle"><span class="hs-identifier hs-var hs-var">mkTimeHandle</span></a></span></span><span> </span><span id="local-6989586621680066500"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066500"><span class="hs-identifier hs-var">currentSlotNo</span></a></span></span><span> </span><span id="local-6989586621680066499"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680066499"><span class="hs-identifier hs-var">systemStart</span></a></span></span><span> </span><span id="local-6989586621680066498"><span class="annot"><span class="annottext">EraHistory CardanoMode
</span><a href="#local-6989586621680066498"><span class="hs-identifier hs-var">eraHistory</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandle"><span class="hs-identifier hs-type">TimeHandle</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentPointInTime :: Either Text PointInTime
</span><a href="Hydra.Chain.Direct.TimeHandle.html#currentPointInTime"><span class="hs-identifier hs-var">currentPointInTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>        </span><span id="local-6989586621680066497"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680066497"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; SlotNo -&gt; Either Text UTCTime
</span><a href="#local-6989586621680066496"><span class="hs-identifier hs-var">slotToUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066500"><span class="hs-identifier hs-var">currentSlotNo</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066500"><span class="hs-identifier hs-var">currentSlotNo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680066497"><span class="hs-identifier hs-var">pt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; UTCTime -&gt; Either Text SlotNo
slotFromUTCTime :: HasCallStack =&gt; UTCTime -&gt; Either Text SlotNo
slotFromUTCTime :: UTCTime -&gt; Either Text SlotNo
</span><a href="#local-6989586621680066495"><span class="hs-identifier hs-var hs-var">slotFromUTCTime</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; SlotNo -&gt; Either Text UTCTime
slotToUTCTime :: HasCallStack =&gt; SlotNo -&gt; Either Text UTCTime
slotToUTCTime :: SlotNo -&gt; Either Text UTCTime
</span><a href="#local-6989586621680066496"><span class="hs-identifier hs-var hs-var">slotToUTCTime</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="#local-6989586621680066496"><span class="hs-identifier hs-type">slotToUTCTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621680066496"><span class="annot"><span class="annottext">slotToUTCTime :: HasCallStack =&gt; SlotNo -&gt; Either Text UTCTime
</span><a href="#local-6989586621680066496"><span class="hs-identifier hs-var hs-var">slotToUTCTime</span></a></span></span><span> </span><span id="local-6989586621680066486"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066486"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (xs :: [*]) a.
HasCallStack =&gt;
Interpreter xs -&gt; Qry a -&gt; Either PastHorizonException a
</span><span class="hs-identifier hs-var">interpretQuery</span></span><span> </span><span class="annot"><span class="annottext">Interpreter (CardanoEras StandardCrypto)
</span><a href="#local-6989586621680066485"><span class="hs-identifier hs-var">interpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Qry (RelativeTime, SlotLength)
</span><span class="hs-identifier hs-var">slotToWallclock</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066486"><span class="hs-identifier hs-var">slot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-93"></span><span>      </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680066484"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621680066484"><span class="hs-identifier hs-var">pastHorizonEx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621680066484"><span class="hs-identifier hs-var">pastHorizonEx</span></a></span><span>
</span><span id="line-94"></span><span>      </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680066482"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680066482"><span class="hs-identifier hs-var">relativeTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680066481"><span class="annot"><span class="annottext">SlotLength
</span><a href="#local-6989586621680066481"><span class="hs-identifier hs-var">_slotLength</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart -&gt; RelativeTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">fromRelativeTime</span></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680066499"><span class="hs-identifier hs-var">systemStart</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680066482"><span class="hs-identifier hs-var">relativeTime</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="#local-6989586621680066495"><span class="hs-identifier hs-type">slotFromUTCTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-97"></span><span>  </span><span id="local-6989586621680066495"><span class="annot"><span class="annottext">slotFromUTCTime :: HasCallStack =&gt; UTCTime -&gt; Either Text SlotNo
</span><a href="#local-6989586621680066495"><span class="hs-identifier hs-var hs-var">slotFromUTCTime</span></a></span></span><span> </span><span id="local-6989586621680066474"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680066474"><span class="hs-identifier hs-var">utcTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680066473"><span class="annot"><span class="annottext">relativeTime :: RelativeTime
</span><a href="#local-6989586621680066473"><span class="hs-identifier hs-var hs-var">relativeTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SystemStart -&gt; UTCTime -&gt; RelativeTime
</span><span class="hs-identifier hs-var">toRelativeTime</span></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680066499"><span class="hs-identifier hs-var">systemStart</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621680066474"><span class="hs-identifier hs-var">utcTime</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (xs :: [*]) a.
HasCallStack =&gt;
Interpreter xs -&gt; Qry a -&gt; Either PastHorizonException a
</span><span class="hs-identifier hs-var">interpretQuery</span></span><span> </span><span class="annot"><span class="annottext">Interpreter (CardanoEras StandardCrypto)
</span><a href="#local-6989586621680066485"><span class="hs-identifier hs-var">interpreter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RelativeTime -&gt; Qry (SlotNo, POSIXTime, POSIXTime)
</span><span class="hs-identifier hs-var">wallclockToSlot</span></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680066473"><span class="hs-identifier hs-var">relativeTime</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680066472"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621680066472"><span class="hs-identifier hs-var">pastHorizonEx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621680066472"><span class="hs-identifier hs-var">pastHorizonEx</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680066471"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066471"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680066470"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680066470"><span class="hs-identifier hs-var">_timeSpentInSlot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680066469"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680066469"><span class="hs-identifier hs-var">_timeLeftInSlot</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066471"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraHistory</span></span><span> </span><span class="annot"><span class="annottext">ConsensusMode CardanoMode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680066485"><span class="annot"><span class="annottext">Interpreter xs
Interpreter (CardanoEras StandardCrypto)
</span><a href="#local-6989586621680066485"><span class="hs-identifier hs-var">interpreter</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraHistory CardanoMode
</span><a href="#local-6989586621680066498"><span class="hs-identifier hs-var">eraHistory</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | Query node for system start and era history before constructing a</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- 'TimeHandle' using the slot at the tip of the network.</span><span>
</span><span id="line-107"></span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#queryTimeHandle"><span class="hs-identifier hs-type">queryTimeHandle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.TimeHandle.html#TimeHandle"><span class="hs-identifier hs-type">TimeHandle</span></a></span><span>
</span><span id="line-108"></span><span id="queryTimeHandle"><span class="annot"><span class="annottext">queryTimeHandle :: NetworkId -&gt; FilePath -&gt; IO TimeHandle
</span><a href="Hydra.Chain.Direct.TimeHandle.html#queryTimeHandle"><span class="hs-identifier hs-var hs-var">queryTimeHandle</span></a></span></span><span> </span><span id="local-6989586621680066462"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680066462"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680066461"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680066461"><span class="hs-identifier hs-var">socketPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621680066460"><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621680066460"><span class="hs-identifier hs-var">tip</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; FilePath -&gt; IO ChainPoint
</span><a href="Hydra.Chain.CardanoClient.html#queryTip"><span class="hs-identifier hs-var">queryTip</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680066462"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680066461"><span class="hs-identifier hs-var">socketPath</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span id="local-6989586621680066459"><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680066459"><span class="hs-identifier hs-var">systemStart</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; FilePath -&gt; QueryPoint -&gt; IO SystemStart
</span><a href="Hydra.Chain.CardanoClient.html#querySystemStart"><span class="hs-identifier hs-var">querySystemStart</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680066462"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680066461"><span class="hs-identifier hs-var">socketPath</span></a></span><span> </span><span class="annot"><span class="annottext">QueryPoint
</span><a href="Hydra.Chain.CardanoClient.html#QueryTip"><span class="hs-identifier hs-var">QueryTip</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span id="local-6989586621680066458"><span class="annot"><span class="annottext">EraHistory CardanoMode
</span><a href="#local-6989586621680066458"><span class="hs-identifier hs-var">eraHistory</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; FilePath -&gt; QueryPoint -&gt; IO (EraHistory CardanoMode)
</span><a href="Hydra.Chain.CardanoClient.html#queryEraHistory"><span class="hs-identifier hs-var">queryEraHistory</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680066462"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680066461"><span class="hs-identifier hs-var">socketPath</span></a></span><span> </span><span class="annot"><span class="annottext">QueryPoint
</span><a href="Hydra.Chain.CardanoClient.html#QueryTip"><span class="hs-identifier hs-var">QueryTip</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621680066457"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066457"><span class="hs-identifier hs-var">currentTipSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ChainPoint
</span><a href="#local-6989586621680066460"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">ChainPoint
</span><span class="hs-identifier hs-var">ChainPointAtGenesis</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><span class="hs-identifier hs-var">SlotNo</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ChainPoint</span></span><span> </span><span id="local-6989586621680066456"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066456"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Hash BlockHeader
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066456"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/bsq0l6l46al1xy42xf3gvwwyys8vdbz1-ghc-9.2.7-doc/share/doc/ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
SlotNo -&gt; SystemStart -&gt; EraHistory CardanoMode -&gt; TimeHandle
</span><a href="Hydra.Chain.Direct.TimeHandle.html#mkTimeHandle"><span class="hs-identifier hs-var">mkTimeHandle</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621680066457"><span class="hs-identifier hs-var">currentTipSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680066459"><span class="hs-identifier hs-var">systemStart</span></a></span><span> </span><span class="annot"><span class="annottext">EraHistory CardanoMode
</span><a href="#local-6989586621680066458"><span class="hs-identifier hs-var">eraHistory</span></a></span><span>
</span><span id="line-118"></span></pre></body></html>